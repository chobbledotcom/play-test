<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Play-test3</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.2/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.2/favicon_yellow.png" />
  </head>

  <body data-branch-coverage=true>
    <div id="loading">
      <img src="./assets/0.13.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-07-23T17:48:26+01:00">2025-07-23T17:48:26+01:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="yellow">
  89.87%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         575.41
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>77</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>3328</b> relevant lines,
    <span class="green"><b>2991</b> lines covered</span> and
    <span class="red"><b>337</b> lines missed. </span>
    (<span class="yellow">
  89.87%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>1016</b> total branches, </span>
      <span class="green"><b>776</b> branches covered</span> and
      <span class="red"><b>240</b> branches missed.</span>
      (<span class="red">
  76.38%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbbda50c4c9478d3f954b288c46912383a3d4ce5" class="src_link" title="app/controllers/anchorage_assessments_controller.rb">app/controllers/anchorage_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4f5e14fcaed7302905b3640b70a0edd38572220e" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">71.15 %</td>
            <td class="cell--number">201</td>
            <td class="cell--number">104</td>
            <td class="cell--number">74</td>
            <td class="cell--number">30</td>
            <td class="cell--number">1632.72</td>
            
              <td class="red strong cell--number t-file__branch-coverage">69.77 %</td>
              <td class="cell--number">43</td>
              <td class="cell--number">30</td>
              <td class="cell--number">13</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#57d7821dc6ad5423331405a35326a518492b095b" class="src_link" title="app/controllers/concerns/assessment_controller.rb">app/controllers/concerns/assessment_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.55 %</td>
            <td class="cell--number">126</td>
            <td class="cell--number">62</td>
            <td class="cell--number">58</td>
            <td class="cell--number">4</td>
            <td class="cell--number">32.50</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#94bad543598a92f2fc8c429c0376f386950b138b" class="src_link" title="app/controllers/concerns/inspection_turbo_streams.rb">app/controllers/concerns/inspection_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">64</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">22.65</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2110d777d43e9d5dd521296a1112f5d846eea7b6" class="src_link" title="app/controllers/concerns/public_viewable.rb">app/controllers/concerns/public_viewable.rb</a></td>
            <td class="red strong cell--number t-file__coverage">69.23 %</td>
            <td class="cell--number">68</td>
            <td class="cell--number">26</td>
            <td class="cell--number">18</td>
            <td class="cell--number">8</td>
            <td class="cell--number">38.62</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">5</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#51f688e8c30bf57cf51e0ba36602a28d71a3715e" class="src_link" title="app/controllers/concerns/safety_standards_turbo_streams.rb">app/controllers/concerns/safety_standards_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.09</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ba7157eae0afc73db92cb480454fdc8a4b8be227" class="src_link" title="app/controllers/concerns/unit_turbo_streams.rb">app/controllers/concerns/unit_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.91 %</td>
            <td class="cell--number">40</td>
            <td class="cell--number">11</td>
            <td class="cell--number">10</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.36</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#841fc4c23fdf58ed5188c954374d2d852ba84e16" class="src_link" title="app/controllers/concerns/user_activity_check.rb">app/controllers/concerns/user_activity_check.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1</td>
            <td class="cell--number">51.44</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8997b81e5b59ed6b8386417d7f9fa50189881887" class="src_link" title="app/controllers/concerns/user_turbo_streams.rb">app/controllers/concerns/user_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">40</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.64</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fc6a9d36d07241cb3f1788f03b2e2980de309833" class="src_link" title="app/controllers/enclosed_assessments_controller.rb">app/controllers/enclosed_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8bcae1d3799186ef9ee7216763ec05dd7ab94aa7" class="src_link" title="app/controllers/fan_assessments_controller.rb">app/controllers/fan_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f9464fa3ff97953202e9fc24a8538a63e68eb8e4" class="src_link" title="app/controllers/guides_controller.rb">app/controllers/guides_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">24</td>
            <td class="cell--number">8</td>
            <td class="cell--number">16</td>
            <td class="cell--number">5.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#665419945feb649a1cb3c36323ebff055d9e00dd" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dea9c23e2fa605c4d480805c6428dc674919efe4" class="src_link" title="app/controllers/inspections_controller.rb">app/controllers/inspections_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.98 %</td>
            <td class="cell--number">548</td>
            <td class="cell--number">266</td>
            <td class="cell--number">250</td>
            <td class="cell--number">16</td>
            <td class="cell--number">75.74</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">82.56 %</td>
              <td class="cell--number">86</td>
              <td class="cell--number">71</td>
              <td class="cell--number">15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#470f05818af2e79bb996c2e355a22441a3681be3" class="src_link" title="app/controllers/inspector_companies_controller.rb">app/controllers/inspector_companies_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">100</td>
            <td class="cell--number">42</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9cf46ea01a64c5f9a09940584c8e015ef43d7d8e" class="src_link" title="app/controllers/materials_assessments_controller.rb">app/controllers/materials_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#21828e4f644c269e534dfa23b7f95e7aa1893687" class="src_link" title="app/controllers/safety_standards_controller.rb">app/controllers/safety_standards_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.98 %</td>
            <td class="cell--number">199</td>
            <td class="cell--number">98</td>
            <td class="cell--number">97</td>
            <td class="cell--number">1</td>
            <td class="cell--number">36.40</td>
            
              <td class="green strong cell--number t-file__branch-coverage">91.18 %</td>
              <td class="cell--number">34</td>
              <td class="cell--number">31</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7dc66bd7a04d603b3e720273aca89df3e1b4e97e" class="src_link" title="app/controllers/search_controller.rb">app/controllers/search_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13.50</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#656c79c5b08d5575c21b6239bd3598310540c921" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">19</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">252.21</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2083ad1713b691b7dbcb9d9a107f1601a588a450" class="src_link" title="app/controllers/slide_assessments_controller.rb">app/controllers/slide_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3f27108b7b6a9e9b6994020d9dcfb4e3fa7c558a" class="src_link" title="app/controllers/structure_assessments_controller.rb">app/controllers/structure_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9671e77c7b1e5b8ec2468d9a384363dc64eb1a60" class="src_link" title="app/controllers/units_controller.rb">app/controllers/units_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.92 %</td>
            <td class="cell--number">310</td>
            <td class="cell--number">144</td>
            <td class="cell--number">141</td>
            <td class="cell--number">3</td>
            <td class="cell--number">23.83</td>
            
              <td class="green strong cell--number t-file__branch-coverage">94.74 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">36</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#265592e4d755f45e1cc0e91764718ddb0507b292" class="src_link" title="app/controllers/user_height_assessments_controller.rb">app/controllers/user_height_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#aa86b037e97f78d488b879ecc5582540c62b0581" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.91 %</td>
            <td class="cell--number">236</td>
            <td class="cell--number">115</td>
            <td class="cell--number">108</td>
            <td class="cell--number">7</td>
            <td class="cell--number">10.29</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">85.71 %</td>
              <td class="cell--number">35</td>
              <td class="cell--number">30</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1b9a351aeb1617b0e942d9b70ceae781c2e6f475" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.84 %</td>
            <td class="cell--number">206</td>
            <td class="cell--number">86</td>
            <td class="cell--number">85</td>
            <td class="cell--number">1</td>
            <td class="cell--number">2319.10</td>
            
              <td class="green strong cell--number t-file__branch-coverage">94.74 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">36</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5ede36d5faa42f454c3658fd9a193293123438ec" class="src_link" title="app/helpers/inspections_helper.rb">app/helpers/inspections_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">85</td>
            <td class="cell--number">32</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">359.09</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">84.62 %</td>
              <td class="cell--number">13</td>
              <td class="cell--number">11</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c95b2e04a94cf2e4786f102e5b1bc533fa523c5c" class="src_link" title="app/helpers/sessions_helper.rb">app/helpers/sessions_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">29</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2227.90</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">14</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4d672f89ddff41c8f22f9133fb8783500299a92b" class="src_link" title="app/helpers/units_helper.rb">app/helpers/units_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">54</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">69.92</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#604ab6d410566363484398c4f11f25c4c5184f48" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.78</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#997c8bcf69ded09410b7263fec479df7455f7422" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4e20a5128cd952646a71ca878b943dbe1f2ece3f" class="src_link" title="app/models/assessments/anchorage_assessment.rb">app/models/assessments/anchorage_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.24 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">21</td>
            <td class="cell--number">20</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.62</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8cbca11b5b0e2f37f59374d1311b10cd8558e8a0" class="src_link" title="app/models/assessments/enclosed_assessment.rb">app/models/assessments/enclosed_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e00557590cfd6ee8d101f4c1c3ed0717bae05418" class="src_link" title="app/models/assessments/fan_assessment.rb">app/models/assessments/fan_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f268cf6c73c33f232e9d716926a8416df354ae1c" class="src_link" title="app/models/assessments/materials_assessment.rb">app/models/assessments/materials_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#812275a1016ba54b81d7a19600d8465cea341e1d" class="src_link" title="app/models/assessments/slide_assessment.rb">app/models/assessments/slide_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">52</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.65</td>
            
              <td class="red strong cell--number t-file__branch-coverage">57.14 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">8</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6c0a63263f96a6f354f4051351eef27eb5a5001d" class="src_link" title="app/models/assessments/structure_assessment.rb">app/models/assessments/structure_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4d79c73b76e4dd8bb0718532ea353520b5477d14" class="src_link" title="app/models/assessments/user_height_assessment.rb">app/models/assessments/user_height_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">19</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.00</td>
            
              <td class="red strong cell--number t-file__branch-coverage">60.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#50f5e4ae6c4a83ee17ba708e713beac17353d8d7" class="src_link" title="app/models/calculator_response.rb">app/models/calculator_response.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">72.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#359cf64369a56324806d8087667b97fb771ba23d" class="src_link" title="app/models/concerns/assessment_completion.rb">app/models/concerns/assessment_completion.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">21</td>
            <td class="cell--number">10</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18344.70</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0b46a31d2cea501a6daca42dfb893d46062d31b0" class="src_link" title="app/models/concerns/assessment_logging.rb">app/models/concerns/assessment_logging.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1672.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fadd7321bf3d3f109f9961e4749b219a5ca071cc" class="src_link" title="app/models/concerns/custom_id_generator.rb">app/models/concerns/custom_id_generator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">15</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2592.87</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#92d6f40602eefd92bbad50dab828c3f09bdc4c50" class="src_link" title="app/models/concerns/public_field_filtering.rb">app/models/concerns/public_field_filtering.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.73</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f0efad46d7eb33d4a088463c237a17c4eb67e5aa" class="src_link" title="app/models/event.rb">app/models/event.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">25</td>
            <td class="cell--number">23</td>
            <td class="cell--number">2</td>
            <td class="cell--number">548.96</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">1</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b82cf78cdf6132273a3c14439d06b087bd7cc856" class="src_link" title="app/models/inspection.rb">app/models/inspection.rb</a></td>
            <td class="green strong cell--number t-file__coverage">91.58 %</td>
            <td class="cell--number">446</td>
            <td class="cell--number">190</td>
            <td class="cell--number">174</td>
            <td class="cell--number">16</td>
            <td class="cell--number">1439.26</td>
            
              <td class="red strong cell--number t-file__branch-coverage">72.37 %</td>
              <td class="cell--number">76</td>
              <td class="cell--number">55</td>
              <td class="cell--number">21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#70a5831225bd608a9387978d5f44c242eba33b4b" class="src_link" title="app/models/inspector_company.rb">app/models/inspector_company.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">95</td>
            <td class="cell--number">46</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">90.15</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">85.71 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">12</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0f23dae70a6b92ac2c1b330c66617f30ba35b26a" class="src_link" title="app/models/unit.rb">app/models/unit.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">86.30 %</td>
            <td class="cell--number">153</td>
            <td class="cell--number">73</td>
            <td class="cell--number">63</td>
            <td class="cell--number">10</td>
            <td class="cell--number">56.19</td>
            
              <td class="red strong cell--number t-file__branch-coverage">73.33 %</td>
              <td class="cell--number">30</td>
              <td class="cell--number">22</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a8de2fd5d1e4076b8b8a18a5e619dbaecb324a3e" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.13 %</td>
            <td class="cell--number">172</td>
            <td class="cell--number">89</td>
            <td class="cell--number">82</td>
            <td class="cell--number">7</td>
            <td class="cell--number">640.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">65.63 %</td>
              <td class="cell--number">32</td>
              <td class="cell--number">21</td>
              <td class="cell--number">11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b22584013992bc5757858e5647e3edf2b4f1ada1" class="src_link" title="app/services/image_processor_service.rb">app/services/image_processor_service.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">89.66 %</td>
            <td class="cell--number">67</td>
            <td class="cell--number">29</td>
            <td class="cell--number">26</td>
            <td class="cell--number">3</td>
            <td class="cell--number">6.93</td>
            
              <td class="red strong cell--number t-file__branch-coverage">70.59 %</td>
              <td class="cell--number">17</td>
              <td class="cell--number">12</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a24adb581826e989c761bcdc2a5430687d71a94d" class="src_link" title="app/services/inspection_creation_service.rb">app/services/inspection_creation_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">37</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15.51</td>
            
              <td class="green strong cell--number t-file__branch-coverage">93.75 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">15</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f0e125eb76c1fd9b174f84f25323607ed6336b49" class="src_link" title="app/services/inspection_csv_export_service.rb">app/services/inspection_csv_export_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">48</td>
            <td class="cell--number">30</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27.03</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">88.00 %</td>
              <td class="cell--number">25</td>
              <td class="cell--number">22</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8f076ba221aee0a5c4b2ec1f6c9006efd03eee28" class="src_link" title="app/services/json_serializer_service.rb">app/services/json_serializer_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">113</td>
            <td class="cell--number">50</td>
            <td class="cell--number">50</td>
            <td class="cell--number">0</td>
            <td class="cell--number">436.52</td>
            
              <td class="red strong cell--number t-file__branch-coverage">71.43 %</td>
              <td class="cell--number">28</td>
              <td class="cell--number">20</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#833b3bdd941a28c296c4e4017998935dc62189fe" class="src_link" title="app/services/ntfy_service.rb">app/services/ntfy_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">66.67 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">21</td>
            <td class="cell--number">14</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5.86</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f04bd6a5175b7a67a12634a2ce7d0a55bdab3e9e" class="src_link" title="app/services/pdf_generator_service.rb">app/services/pdf_generator_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">91.89 %</td>
            <td class="cell--number">150</td>
            <td class="cell--number">74</td>
            <td class="cell--number">68</td>
            <td class="cell--number">6</td>
            <td class="cell--number">48.70</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">85.71 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">12</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0362eba099c60f94cabc89c4097ae57bccb9f291" class="src_link" title="app/services/pdf_generator_service/assessment_renderer.rb">app/services/pdf_generator_service/assessment_renderer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.13 %</td>
            <td class="cell--number">196</td>
            <td class="cell--number">115</td>
            <td class="cell--number">114</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1523.01</td>
            
              <td class="red strong cell--number t-file__branch-coverage">80.00 %</td>
              <td class="cell--number">40</td>
              <td class="cell--number">32</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fd6fb10c579b55dade9859adfb49fc9c70872ae2" class="src_link" title="app/services/pdf_generator_service/configuration.rb">app/services/pdf_generator_service/configuration.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">84</td>
            <td class="cell--number">51</td>
            <td class="cell--number">51</td>
            <td class="cell--number">0</td>
            <td class="cell--number">21.18</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#840cf6ad9593096c87f1e41467114585e586efe4" class="src_link" title="app/services/pdf_generator_service/debug_info_renderer.rb">app/services/pdf_generator_service/debug_info_renderer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">58</td>
            <td class="cell--number">27</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.11</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3e5148bd8bf37599768889d24ffd3045268ef40b" class="src_link" title="app/services/pdf_generator_service/header_generator.rb">app/services/pdf_generator_service/header_generator.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.72 %</td>
            <td class="cell--number">139</td>
            <td class="cell--number">72</td>
            <td class="cell--number">61</td>
            <td class="cell--number">11</td>
            <td class="cell--number">29.81</td>
            
              <td class="red strong cell--number t-file__branch-coverage">63.64 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">14</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9527a4daec2ab239f019b3f52dbc311d3914f70d" class="src_link" title="app/services/pdf_generator_service/image_orientation_processor.rb">app/services/pdf_generator_service/image_orientation_processor.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.15</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9cdbc1b55897061ede249f42bf31afc895eb4788" class="src_link" title="app/services/pdf_generator_service/image_processor.rb">app/services/pdf_generator_service/image_processor.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">76</td>
            <td class="cell--number">37</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0</td>
            <td class="cell--number">49.46</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">10</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#368ed9e9bade823b5080a332bb1f0fc20812f43b" class="src_link" title="app/services/pdf_generator_service/position_calculator.rb">app/services/pdf_generator_service/position_calculator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">85</td>
            <td class="cell--number">39</td>
            <td class="cell--number">39</td>
            <td class="cell--number">0</td>
            <td class="cell--number">21.46</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">10</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3d98c406fa7ebc25db769ceef09467c2481ec671" class="src_link" title="app/services/pdf_generator_service/table_builder.rb">app/services/pdf_generator_service/table_builder.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.25 %</td>
            <td class="cell--number">269</td>
            <td class="cell--number">133</td>
            <td class="cell--number">132</td>
            <td class="cell--number">1</td>
            <td class="cell--number">34.65</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">89.66 %</td>
              <td class="cell--number">58</td>
              <td class="cell--number">52</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#03069e536259f908b86d88f3ee878333004d07e8" class="src_link" title="app/services/pdf_generator_service/utilities.rb">app/services/pdf_generator_service/utilities.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">63</td>
            <td class="cell--number">31</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">71.61</td>
            
              <td class="green strong cell--number t-file__branch-coverage">92.31 %</td>
              <td class="cell--number">13</td>
              <td class="cell--number">12</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#be35116fa6f11728960efcfa8d4680b8089c9e54" class="src_link" title="app/services/photo_processing_service.rb">app/services/photo_processing_service.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">89.47 %</td>
            <td class="cell--number">78</td>
            <td class="cell--number">38</td>
            <td class="cell--number">34</td>
            <td class="cell--number">4</td>
            <td class="cell--number">8.82</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">5</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b99c89d084682299a2423f98e4c9b8438a28f358" class="src_link" title="app/services/qr_code_service.rb">app/services/qr_code_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">52.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#003799499abcf9975f340e86cc1d162e20a02ee3" class="src_link" title="app/services/rpii_verification_service.rb">app/services/rpii_verification_service.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">81.82 %</td>
            <td class="cell--number">95</td>
            <td class="cell--number">44</td>
            <td class="cell--number">36</td>
            <td class="cell--number">8</td>
            <td class="cell--number">7.09</td>
            
              <td class="red strong cell--number t-file__branch-coverage">44.44 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">8</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a5d82b78a360dd19e2ea5de249e4b9ea59f20bd3" class="src_link" title="app/services/safety_standard.rb">app/services/safety_standard.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.94 %</td>
            <td class="cell--number">401</td>
            <td class="cell--number">132</td>
            <td class="cell--number">124</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1668.35</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">39</td>
              <td class="cell--number">26</td>
              <td class="cell--number">13</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f28e57e0679481baea2d8be9e1c8731539f3af36" class="src_link" title="app/services/safety_standards/anchor_calculator.rb">app/services/safety_standards/anchor_calculator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">160</td>
            <td class="cell--number">38</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0</td>
            <td class="cell--number">101.05</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#33e62f8e30997ea6bb4d0fc30a55fbeb4b572efd" class="src_link" title="app/services/safety_standards/material_validator.rb">app/services/safety_standards/material_validator.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.24 %</td>
            <td class="cell--number">80</td>
            <td class="cell--number">17</td>
            <td class="cell--number">15</td>
            <td class="cell--number">2</td>
            <td class="cell--number">11.65</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4888081ecc2918ebfb2191d07c870c8ed9978729" class="src_link" title="app/services/safety_standards/slide_calculator.rb">app/services/safety_standards/slide_calculator.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">86.54 %</td>
            <td class="cell--number">403</td>
            <td class="cell--number">104</td>
            <td class="cell--number">90</td>
            <td class="cell--number">14</td>
            <td class="cell--number">65.01</td>
            
              <td class="red strong cell--number t-file__branch-coverage">77.78 %</td>
              <td class="cell--number">36</td>
              <td class="cell--number">28</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5db4793978e1a59328dcc0fd1c29df4c3fe3d294" class="src_link" title="app/services/safety_standards/user_capacity_calculator.rb">app/services/safety_standards/user_capacity_calculator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">104</td>
            <td class="cell--number">49</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0</td>
            <td class="cell--number">152.63</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#488f758360b2e391ff12af6b78151188b8529dbc" class="src_link" title="app/services/seed_data_service.rb">app/services/seed_data_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.09 %</td>
            <td class="cell--number">263</td>
            <td class="cell--number">103</td>
            <td class="cell--number">100</td>
            <td class="cell--number">3</td>
            <td class="cell--number">655.63</td>
            
              <td class="red strong cell--number t-file__branch-coverage">76.92 %</td>
              <td class="cell--number">39</td>
              <td class="cell--number">30</td>
              <td class="cell--number">9</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#492d2f494b91f2dc7a7779b0eeeb15f8ff935212" class="src_link" title="app/services/unit_creation_from_inspection_service.rb">app/services/unit_creation_from_inspection_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">48</td>
            <td class="cell--number">28</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7.68</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3039bdd650f5bad63c330a4968faa679cd8bf294" class="src_link" title="app/services/unit_csv_export_service.rb">app/services/unit_csv_export_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5965243db248679089be6c583c183dc73badfc08" class="src_link" title="lib/code_standards_checker.rb">lib/code_standards_checker.rb</a></td>
            <td class="red strong cell--number t-file__coverage">24.11 %</td>
            <td class="cell--number">297</td>
            <td class="cell--number">141</td>
            <td class="cell--number">34</td>
            <td class="cell--number">107</td>
            <td class="cell--number">4.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">34</td>
              <td class="cell--number">0</td>
              <td class="cell--number">34</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7943239b8ded17eed3b052ef34630d03948bbd84" class="src_link" title="lib/i18n_usage_tracker.rb">lib/i18n_usage_tracker.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.95 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">74</td>
            <td class="cell--number">71</td>
            <td class="cell--number">3</td>
            <td class="cell--number">4214.27</td>
            
              <td class="red strong cell--number t-file__branch-coverage">70.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">17</td>
              <td class="cell--number">7</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9dae34e93e4b5b2eefdf7753d77b1bba8c1a3fc8" class="src_link" title="lib/rubocop/cop/custom/ternary_line_breaks.rb">lib/rubocop/cop/custom/ternary_line_breaks.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">60</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a2706e0ee5f35697bb27488d115c741f3f2d5712" class="src_link" title="lib/test_data_helpers.rb">lib/test_data_helpers.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">42</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">244.22</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="green">
  91.16%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         211.67
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>24</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>984</b> relevant lines,
    <span class="green"><b>897</b> lines covered</span> and
    <span class="red"><b>87</b> lines missed. </span>
    (<span class="green">
  91.16%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>266</b> total branches, </span>
      <span class="green"><b>218</b> branches covered</span> and
      <span class="red"><b>48</b> branches missed.</span>
      (<span class="yellow">
  81.95%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cbbda50c4c9478d3f954b288c46912383a3d4ce5" class="src_link" title="app/controllers/anchorage_assessments_controller.rb">app/controllers/anchorage_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4f5e14fcaed7302905b3640b70a0edd38572220e" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">71.15 %</td>
            <td class="cell--number">201</td>
            <td class="cell--number">104</td>
            <td class="cell--number">74</td>
            <td class="cell--number">30</td>
            <td class="cell--number">1632.72</td>
            
              <td class="red strong cell--number t-file__branch-coverage">69.77 %</td>
              <td class="cell--number">43</td>
              <td class="cell--number">30</td>
              <td class="cell--number">13</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#57d7821dc6ad5423331405a35326a518492b095b" class="src_link" title="app/controllers/concerns/assessment_controller.rb">app/controllers/concerns/assessment_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.55 %</td>
            <td class="cell--number">126</td>
            <td class="cell--number">62</td>
            <td class="cell--number">58</td>
            <td class="cell--number">4</td>
            <td class="cell--number">32.50</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#94bad543598a92f2fc8c429c0376f386950b138b" class="src_link" title="app/controllers/concerns/inspection_turbo_streams.rb">app/controllers/concerns/inspection_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">64</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">22.65</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2110d777d43e9d5dd521296a1112f5d846eea7b6" class="src_link" title="app/controllers/concerns/public_viewable.rb">app/controllers/concerns/public_viewable.rb</a></td>
            <td class="red strong cell--number t-file__coverage">69.23 %</td>
            <td class="cell--number">68</td>
            <td class="cell--number">26</td>
            <td class="cell--number">18</td>
            <td class="cell--number">8</td>
            <td class="cell--number">38.62</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">5</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#51f688e8c30bf57cf51e0ba36602a28d71a3715e" class="src_link" title="app/controllers/concerns/safety_standards_turbo_streams.rb">app/controllers/concerns/safety_standards_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.09</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ba7157eae0afc73db92cb480454fdc8a4b8be227" class="src_link" title="app/controllers/concerns/unit_turbo_streams.rb">app/controllers/concerns/unit_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">90.91 %</td>
            <td class="cell--number">40</td>
            <td class="cell--number">11</td>
            <td class="cell--number">10</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.36</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#841fc4c23fdf58ed5188c954374d2d852ba84e16" class="src_link" title="app/controllers/concerns/user_activity_check.rb">app/controllers/concerns/user_activity_check.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1</td>
            <td class="cell--number">51.44</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8997b81e5b59ed6b8386417d7f9fa50189881887" class="src_link" title="app/controllers/concerns/user_turbo_streams.rb">app/controllers/concerns/user_turbo_streams.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">40</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.64</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fc6a9d36d07241cb3f1788f03b2e2980de309833" class="src_link" title="app/controllers/enclosed_assessments_controller.rb">app/controllers/enclosed_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8bcae1d3799186ef9ee7216763ec05dd7ab94aa7" class="src_link" title="app/controllers/fan_assessments_controller.rb">app/controllers/fan_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f9464fa3ff97953202e9fc24a8538a63e68eb8e4" class="src_link" title="app/controllers/guides_controller.rb">app/controllers/guides_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">33.33 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">24</td>
            <td class="cell--number">8</td>
            <td class="cell--number">16</td>
            <td class="cell--number">5.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#665419945feb649a1cb3c36323ebff055d9e00dd" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">9</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dea9c23e2fa605c4d480805c6428dc674919efe4" class="src_link" title="app/controllers/inspections_controller.rb">app/controllers/inspections_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.98 %</td>
            <td class="cell--number">548</td>
            <td class="cell--number">266</td>
            <td class="cell--number">250</td>
            <td class="cell--number">16</td>
            <td class="cell--number">75.74</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">82.56 %</td>
              <td class="cell--number">86</td>
              <td class="cell--number">71</td>
              <td class="cell--number">15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#470f05818af2e79bb996c2e355a22441a3681be3" class="src_link" title="app/controllers/inspector_companies_controller.rb">app/controllers/inspector_companies_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">100</td>
            <td class="cell--number">42</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9cf46ea01a64c5f9a09940584c8e015ef43d7d8e" class="src_link" title="app/controllers/materials_assessments_controller.rb">app/controllers/materials_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#21828e4f644c269e534dfa23b7f95e7aa1893687" class="src_link" title="app/controllers/safety_standards_controller.rb">app/controllers/safety_standards_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.98 %</td>
            <td class="cell--number">199</td>
            <td class="cell--number">98</td>
            <td class="cell--number">97</td>
            <td class="cell--number">1</td>
            <td class="cell--number">36.40</td>
            
              <td class="green strong cell--number t-file__branch-coverage">91.18 %</td>
              <td class="cell--number">34</td>
              <td class="cell--number">31</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7dc66bd7a04d603b3e720273aca89df3e1b4e97e" class="src_link" title="app/controllers/search_controller.rb">app/controllers/search_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">13.50</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#656c79c5b08d5575c21b6239bd3598310540c921" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">30</td>
            <td class="cell--number">19</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">252.21</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2083ad1713b691b7dbcb9d9a107f1601a588a450" class="src_link" title="app/controllers/slide_assessments_controller.rb">app/controllers/slide_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3f27108b7b6a9e9b6994020d9dcfb4e3fa7c558a" class="src_link" title="app/controllers/structure_assessments_controller.rb">app/controllers/structure_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9671e77c7b1e5b8ec2468d9a384363dc64eb1a60" class="src_link" title="app/controllers/units_controller.rb">app/controllers/units_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.92 %</td>
            <td class="cell--number">310</td>
            <td class="cell--number">144</td>
            <td class="cell--number">141</td>
            <td class="cell--number">3</td>
            <td class="cell--number">23.83</td>
            
              <td class="green strong cell--number t-file__branch-coverage">94.74 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">36</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#265592e4d755f45e1cc0e91764718ddb0507b292" class="src_link" title="app/controllers/user_height_assessments_controller.rb">app/controllers/user_height_assessments_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">4</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#aa86b037e97f78d488b879ecc5582540c62b0581" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.91 %</td>
            <td class="cell--number">236</td>
            <td class="cell--number">115</td>
            <td class="cell--number">108</td>
            <td class="cell--number">7</td>
            <td class="cell--number">10.29</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">85.71 %</td>
              <td class="cell--number">35</td>
              <td class="cell--number">30</td>
              <td class="cell--number">5</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="green">
  93.66%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1038.65
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>18</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>568</b> relevant lines,
    <span class="green"><b>532</b> lines covered</span> and
    <span class="red"><b>36</b> lines missed. </span>
    (<span class="green">
  93.66%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>188</b> total branches, </span>
      <span class="green"><b>133</b> branches covered</span> and
      <span class="red"><b>55</b> branches missed.</span>
      (<span class="red">
  70.74%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#997c8bcf69ded09410b7263fec479df7455f7422" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4e20a5128cd952646a71ca878b943dbe1f2ece3f" class="src_link" title="app/models/assessments/anchorage_assessment.rb">app/models/assessments/anchorage_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.24 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">21</td>
            <td class="cell--number">20</td>
            <td class="cell--number">1</td>
            <td class="cell--number">11.62</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8cbca11b5b0e2f37f59374d1311b10cd8558e8a0" class="src_link" title="app/models/assessments/enclosed_assessment.rb">app/models/assessments/enclosed_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e00557590cfd6ee8d101f4c1c3ed0717bae05418" class="src_link" title="app/models/assessments/fan_assessment.rb">app/models/assessments/fan_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">11</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f268cf6c73c33f232e9d716926a8416df354ae1c" class="src_link" title="app/models/assessments/materials_assessment.rb">app/models/assessments/materials_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#812275a1016ba54b81d7a19600d8465cea341e1d" class="src_link" title="app/models/assessments/slide_assessment.rb">app/models/assessments/slide_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">52</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.65</td>
            
              <td class="red strong cell--number t-file__branch-coverage">57.14 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">8</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6c0a63263f96a6f354f4051351eef27eb5a5001d" class="src_link" title="app/models/assessments/structure_assessment.rb">app/models/assessments/structure_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">23</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4d79c73b76e4dd8bb0718532ea353520b5477d14" class="src_link" title="app/models/assessments/user_height_assessment.rb">app/models/assessments/user_height_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">19</td>
            <td class="cell--number">19</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.00</td>
            
              <td class="red strong cell--number t-file__branch-coverage">60.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#50f5e4ae6c4a83ee17ba708e713beac17353d8d7" class="src_link" title="app/models/calculator_response.rb">app/models/calculator_response.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">6</td>
            <td class="cell--number">6</td>
            <td class="cell--number">0</td>
            <td class="cell--number">72.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#359cf64369a56324806d8087667b97fb771ba23d" class="src_link" title="app/models/concerns/assessment_completion.rb">app/models/concerns/assessment_completion.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">21</td>
            <td class="cell--number">10</td>
            <td class="cell--number">10</td>
            <td class="cell--number">0</td>
            <td class="cell--number">18344.70</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0b46a31d2cea501a6daca42dfb893d46062d31b0" class="src_link" title="app/models/concerns/assessment_logging.rb">app/models/concerns/assessment_logging.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">18</td>
            <td class="cell--number">8</td>
            <td class="cell--number">8</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1672.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fadd7321bf3d3f109f9961e4749b219a5ca071cc" class="src_link" title="app/models/concerns/custom_id_generator.rb">app/models/concerns/custom_id_generator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">27</td>
            <td class="cell--number">15</td>
            <td class="cell--number">15</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2592.87</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#92d6f40602eefd92bbad50dab828c3f09bdc4c50" class="src_link" title="app/models/concerns/public_field_filtering.rb">app/models/concerns/public_field_filtering.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">44</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.73</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f0efad46d7eb33d4a088463c237a17c4eb67e5aa" class="src_link" title="app/models/event.rb">app/models/event.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">25</td>
            <td class="cell--number">23</td>
            <td class="cell--number">2</td>
            <td class="cell--number">548.96</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">1</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b82cf78cdf6132273a3c14439d06b087bd7cc856" class="src_link" title="app/models/inspection.rb">app/models/inspection.rb</a></td>
            <td class="green strong cell--number t-file__coverage">91.58 %</td>
            <td class="cell--number">446</td>
            <td class="cell--number">190</td>
            <td class="cell--number">174</td>
            <td class="cell--number">16</td>
            <td class="cell--number">1439.26</td>
            
              <td class="red strong cell--number t-file__branch-coverage">72.37 %</td>
              <td class="cell--number">76</td>
              <td class="cell--number">55</td>
              <td class="cell--number">21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#70a5831225bd608a9387978d5f44c242eba33b4b" class="src_link" title="app/models/inspector_company.rb">app/models/inspector_company.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">95</td>
            <td class="cell--number">46</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">90.15</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">85.71 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">12</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0f23dae70a6b92ac2c1b330c66617f30ba35b26a" class="src_link" title="app/models/unit.rb">app/models/unit.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">86.30 %</td>
            <td class="cell--number">153</td>
            <td class="cell--number">73</td>
            <td class="cell--number">63</td>
            <td class="cell--number">10</td>
            <td class="cell--number">56.19</td>
            
              <td class="red strong cell--number t-file__branch-coverage">73.33 %</td>
              <td class="cell--number">30</td>
              <td class="cell--number">22</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a8de2fd5d1e4076b8b8a18a5e619dbaecb324a3e" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.13 %</td>
            <td class="cell--number">172</td>
            <td class="cell--number">89</td>
            <td class="cell--number">82</td>
            <td class="cell--number">7</td>
            <td class="cell--number">640.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">65.63 %</td>
              <td class="cell--number">32</td>
              <td class="cell--number">21</td>
              <td class="cell--number">11</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="green">
  99.41%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1636.28
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>169</b> relevant lines,
    <span class="green"><b>168</b> lines covered</span> and
    <span class="red"><b>1</b> lines missed. </span>
    (<span class="green">
  99.41%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>75</b> total branches, </span>
      <span class="green"><b>71</b> branches covered</span> and
      <span class="red"><b>4</b> branches missed.</span>
      (<span class="green">
  94.67%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1b9a351aeb1617b0e942d9b70ceae781c2e6f475" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.84 %</td>
            <td class="cell--number">206</td>
            <td class="cell--number">86</td>
            <td class="cell--number">85</td>
            <td class="cell--number">1</td>
            <td class="cell--number">2319.10</td>
            
              <td class="green strong cell--number t-file__branch-coverage">94.74 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">36</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5ede36d5faa42f454c3658fd9a193293123438ec" class="src_link" title="app/helpers/inspections_helper.rb">app/helpers/inspections_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">85</td>
            <td class="cell--number">32</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">359.09</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">84.62 %</td>
              <td class="cell--number">13</td>
              <td class="cell--number">11</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c95b2e04a94cf2e4786f102e5b1bc533fa523c5c" class="src_link" title="app/helpers/sessions_helper.rb">app/helpers/sessions_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">29</td>
            <td class="cell--number">29</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2227.90</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">14</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4d672f89ddff41c8f22f9133fb8783500299a92b" class="src_link" title="app/helpers/units_helper.rb">app/helpers/units_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">54</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">69.92</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#604ab6d410566363484398c4f11f25c4c5184f48" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.78</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="red">
  45.9%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1182.2
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>268</b> relevant lines,
    <span class="green"><b>123</b> lines covered</span> and
    <span class="red"><b>145</b> lines missed. </span>
    (<span class="red">
  45.9%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>58</b> total branches, </span>
      <span class="green"><b>17</b> branches covered</span> and
      <span class="red"><b>41</b> branches missed.</span>
      (<span class="red">
  29.31%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5965243db248679089be6c583c183dc73badfc08" class="src_link" title="lib/code_standards_checker.rb">lib/code_standards_checker.rb</a></td>
            <td class="red strong cell--number t-file__coverage">24.11 %</td>
            <td class="cell--number">297</td>
            <td class="cell--number">141</td>
            <td class="cell--number">34</td>
            <td class="cell--number">107</td>
            <td class="cell--number">4.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">34</td>
              <td class="cell--number">0</td>
              <td class="cell--number">34</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7943239b8ded17eed3b052ef34630d03948bbd84" class="src_link" title="lib/i18n_usage_tracker.rb">lib/i18n_usage_tracker.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.95 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">74</td>
            <td class="cell--number">71</td>
            <td class="cell--number">3</td>
            <td class="cell--number">4214.27</td>
            
              <td class="red strong cell--number t-file__branch-coverage">70.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">17</td>
              <td class="cell--number">7</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9dae34e93e4b5b2eefdf7753d77b1bba8c1a3fc8" class="src_link" title="lib/rubocop/cop/custom/ternary_line_breaks.rb">lib/rubocop/cop/custom/ternary_line_breaks.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">60</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a2706e0ee5f35697bb27488d115c741f3f2d5712" class="src_link" title="lib/test_data_helpers.rb">lib/test_data_helpers.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">42</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">244.22</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="green">
  94.92%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         390.86
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>26</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1339</b> relevant lines,
    <span class="green"><b>1271</b> lines covered</span> and
    <span class="red"><b>68</b> lines missed. </span>
    (<span class="green">
  94.92%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>429</b> total branches, </span>
      <span class="green"><b>337</b> branches covered</span> and
      <span class="red"><b>92</b> branches missed.</span>
      (<span class="red">
  78.55%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b22584013992bc5757858e5647e3edf2b4f1ada1" class="src_link" title="app/services/image_processor_service.rb">app/services/image_processor_service.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">89.66 %</td>
            <td class="cell--number">67</td>
            <td class="cell--number">29</td>
            <td class="cell--number">26</td>
            <td class="cell--number">3</td>
            <td class="cell--number">6.93</td>
            
              <td class="red strong cell--number t-file__branch-coverage">70.59 %</td>
              <td class="cell--number">17</td>
              <td class="cell--number">12</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a24adb581826e989c761bcdc2a5430687d71a94d" class="src_link" title="app/services/inspection_creation_service.rb">app/services/inspection_creation_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">37</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15.51</td>
            
              <td class="green strong cell--number t-file__branch-coverage">93.75 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">15</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f0e125eb76c1fd9b174f84f25323607ed6336b49" class="src_link" title="app/services/inspection_csv_export_service.rb">app/services/inspection_csv_export_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">48</td>
            <td class="cell--number">30</td>
            <td class="cell--number">30</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27.03</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">88.00 %</td>
              <td class="cell--number">25</td>
              <td class="cell--number">22</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8f076ba221aee0a5c4b2ec1f6c9006efd03eee28" class="src_link" title="app/services/json_serializer_service.rb">app/services/json_serializer_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">113</td>
            <td class="cell--number">50</td>
            <td class="cell--number">50</td>
            <td class="cell--number">0</td>
            <td class="cell--number">436.52</td>
            
              <td class="red strong cell--number t-file__branch-coverage">71.43 %</td>
              <td class="cell--number">28</td>
              <td class="cell--number">20</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#833b3bdd941a28c296c4e4017998935dc62189fe" class="src_link" title="app/services/ntfy_service.rb">app/services/ntfy_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">66.67 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">21</td>
            <td class="cell--number">14</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5.86</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f04bd6a5175b7a67a12634a2ce7d0a55bdab3e9e" class="src_link" title="app/services/pdf_generator_service.rb">app/services/pdf_generator_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">91.89 %</td>
            <td class="cell--number">150</td>
            <td class="cell--number">74</td>
            <td class="cell--number">68</td>
            <td class="cell--number">6</td>
            <td class="cell--number">48.70</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">85.71 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">12</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0362eba099c60f94cabc89c4097ae57bccb9f291" class="src_link" title="app/services/pdf_generator_service/assessment_renderer.rb">app/services/pdf_generator_service/assessment_renderer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.13 %</td>
            <td class="cell--number">196</td>
            <td class="cell--number">115</td>
            <td class="cell--number">114</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1523.01</td>
            
              <td class="red strong cell--number t-file__branch-coverage">80.00 %</td>
              <td class="cell--number">40</td>
              <td class="cell--number">32</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fd6fb10c579b55dade9859adfb49fc9c70872ae2" class="src_link" title="app/services/pdf_generator_service/configuration.rb">app/services/pdf_generator_service/configuration.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">84</td>
            <td class="cell--number">51</td>
            <td class="cell--number">51</td>
            <td class="cell--number">0</td>
            <td class="cell--number">21.18</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#840cf6ad9593096c87f1e41467114585e586efe4" class="src_link" title="app/services/pdf_generator_service/debug_info_renderer.rb">app/services/pdf_generator_service/debug_info_renderer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">58</td>
            <td class="cell--number">27</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.11</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3e5148bd8bf37599768889d24ffd3045268ef40b" class="src_link" title="app/services/pdf_generator_service/header_generator.rb">app/services/pdf_generator_service/header_generator.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.72 %</td>
            <td class="cell--number">139</td>
            <td class="cell--number">72</td>
            <td class="cell--number">61</td>
            <td class="cell--number">11</td>
            <td class="cell--number">29.81</td>
            
              <td class="red strong cell--number t-file__branch-coverage">63.64 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">14</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9527a4daec2ab239f019b3f52dbc311d3914f70d" class="src_link" title="app/services/pdf_generator_service/image_orientation_processor.rb">app/services/pdf_generator_service/image_orientation_processor.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">25</td>
            <td class="cell--number">13</td>
            <td class="cell--number">13</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.15</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9cdbc1b55897061ede249f42bf31afc895eb4788" class="src_link" title="app/services/pdf_generator_service/image_processor.rb">app/services/pdf_generator_service/image_processor.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">76</td>
            <td class="cell--number">37</td>
            <td class="cell--number">37</td>
            <td class="cell--number">0</td>
            <td class="cell--number">49.46</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">10</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#368ed9e9bade823b5080a332bb1f0fc20812f43b" class="src_link" title="app/services/pdf_generator_service/position_calculator.rb">app/services/pdf_generator_service/position_calculator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">85</td>
            <td class="cell--number">39</td>
            <td class="cell--number">39</td>
            <td class="cell--number">0</td>
            <td class="cell--number">21.46</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">10</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3d98c406fa7ebc25db769ceef09467c2481ec671" class="src_link" title="app/services/pdf_generator_service/table_builder.rb">app/services/pdf_generator_service/table_builder.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.25 %</td>
            <td class="cell--number">269</td>
            <td class="cell--number">133</td>
            <td class="cell--number">132</td>
            <td class="cell--number">1</td>
            <td class="cell--number">34.65</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">89.66 %</td>
              <td class="cell--number">58</td>
              <td class="cell--number">52</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#03069e536259f908b86d88f3ee878333004d07e8" class="src_link" title="app/services/pdf_generator_service/utilities.rb">app/services/pdf_generator_service/utilities.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">63</td>
            <td class="cell--number">31</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">71.61</td>
            
              <td class="green strong cell--number t-file__branch-coverage">92.31 %</td>
              <td class="cell--number">13</td>
              <td class="cell--number">12</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#be35116fa6f11728960efcfa8d4680b8089c9e54" class="src_link" title="app/services/photo_processing_service.rb">app/services/photo_processing_service.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">89.47 %</td>
            <td class="cell--number">78</td>
            <td class="cell--number">38</td>
            <td class="cell--number">34</td>
            <td class="cell--number">4</td>
            <td class="cell--number">8.82</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">5</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b99c89d084682299a2423f98e4c9b8438a28f358" class="src_link" title="app/services/qr_code_service.rb">app/services/qr_code_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">52.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#003799499abcf9975f340e86cc1d162e20a02ee3" class="src_link" title="app/services/rpii_verification_service.rb">app/services/rpii_verification_service.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">81.82 %</td>
            <td class="cell--number">95</td>
            <td class="cell--number">44</td>
            <td class="cell--number">36</td>
            <td class="cell--number">8</td>
            <td class="cell--number">7.09</td>
            
              <td class="red strong cell--number t-file__branch-coverage">44.44 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">8</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a5d82b78a360dd19e2ea5de249e4b9ea59f20bd3" class="src_link" title="app/services/safety_standard.rb">app/services/safety_standard.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.94 %</td>
            <td class="cell--number">401</td>
            <td class="cell--number">132</td>
            <td class="cell--number">124</td>
            <td class="cell--number">8</td>
            <td class="cell--number">1668.35</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">39</td>
              <td class="cell--number">26</td>
              <td class="cell--number">13</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f28e57e0679481baea2d8be9e1c8731539f3af36" class="src_link" title="app/services/safety_standards/anchor_calculator.rb">app/services/safety_standards/anchor_calculator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">160</td>
            <td class="cell--number">38</td>
            <td class="cell--number">38</td>
            <td class="cell--number">0</td>
            <td class="cell--number">101.05</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#33e62f8e30997ea6bb4d0fc30a55fbeb4b572efd" class="src_link" title="app/services/safety_standards/material_validator.rb">app/services/safety_standards/material_validator.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.24 %</td>
            <td class="cell--number">80</td>
            <td class="cell--number">17</td>
            <td class="cell--number">15</td>
            <td class="cell--number">2</td>
            <td class="cell--number">11.65</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4888081ecc2918ebfb2191d07c870c8ed9978729" class="src_link" title="app/services/safety_standards/slide_calculator.rb">app/services/safety_standards/slide_calculator.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">86.54 %</td>
            <td class="cell--number">403</td>
            <td class="cell--number">104</td>
            <td class="cell--number">90</td>
            <td class="cell--number">14</td>
            <td class="cell--number">65.01</td>
            
              <td class="red strong cell--number t-file__branch-coverage">77.78 %</td>
              <td class="cell--number">36</td>
              <td class="cell--number">28</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5db4793978e1a59328dcc0fd1c29df4c3fe3d294" class="src_link" title="app/services/safety_standards/user_capacity_calculator.rb">app/services/safety_standards/user_capacity_calculator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">104</td>
            <td class="cell--number">49</td>
            <td class="cell--number">49</td>
            <td class="cell--number">0</td>
            <td class="cell--number">152.63</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#488f758360b2e391ff12af6b78151188b8529dbc" class="src_link" title="app/services/seed_data_service.rb">app/services/seed_data_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.09 %</td>
            <td class="cell--number">263</td>
            <td class="cell--number">103</td>
            <td class="cell--number">100</td>
            <td class="cell--number">3</td>
            <td class="cell--number">655.63</td>
            
              <td class="red strong cell--number t-file__branch-coverage">76.92 %</td>
              <td class="cell--number">39</td>
              <td class="cell--number">30</td>
              <td class="cell--number">9</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#492d2f494b91f2dc7a7779b0eeeb15f8ff935212" class="src_link" title="app/services/unit_creation_from_inspection_service.rb">app/services/unit_creation_from_inspection_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">48</td>
            <td class="cell--number">28</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7.68</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3039bdd650f5bad63c330a4968faa679cd8bf294" class="src_link" title="app/services/unit_csv_export_service.rb">app/services/unit_csv_export_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">17</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.2<br/>
        using RSpec, RSpec-, RSpec-10, RSpec-11, RSpec-12, RSpec-13, RSpec-14, RSpec-15, RSpec-16, RSpec-2, RSpec-3, RSpec-4, RSpec-5, RSpec-6, RSpec-7, RSpec-8, RSpec-9
      </div>

      <div class="source_files">
      
        <div class="source_table" id="cbbda50c4c9478d3f954b288c46912383a3d4ce5">
  <div class="header">
    <h3>app/controllers/anchorage_assessments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class AnchorageAssessmentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include SafetyStandardsTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4f5e14fcaed7302905b3640b70a0edd38572220e">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="red">
  71.15%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  69.77%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>104</b> relevant lines.
      <span class="green"><b>74</b> lines covered</span> and
      <span class="red"><b>30</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>43</b> total branches, </span>
          <span class="green"><b>30</b> branches covered</span> and
          <span class="red"><b>13</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include SessionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :update_last_active_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # Performance tracking for debug info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :start_debug_timer, if: :admin_debug_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_action :check_query_limit, if: :should_check_query_limit?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_action :cleanup_debug_subscription, if: :admin_debug_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  rescue_from StandardError do |exception|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="13">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">    if Rails.env.production?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="14">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      user_email = current_user&amp;.email || app_i18n(:errors, :not_logged_in)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">      user_label = app_i18n(:errors, :user_label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">      user_info = &quot;#{user_label}: #{user_email}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">      controller_label = app_i18n(:errors, :controller_label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">      path_label = app_i18n(:errors, :path_label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">      method_label = app_i18n(:errors, :method_label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">      ip_label = app_i18n(:errors, :ip_label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">      backtrace_label = app_i18n(:errors, :backtrace_label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">      error_subject = app_i18n(:errors, :production_error_subject)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      message = &lt;&lt;~MESSAGE</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">        #{error_subject}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        #{exception.class}: #{exception.message}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        #{user_info}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        #{controller_label}: #{controller_name}##{action_name}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        #{path_label}: #{request.fullpath}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">        #{method_label}: #{request.request_method}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        #{ip_label}: #{request.remote_ip}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        #{backtrace_label}:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        #{exception.backtrace.first(5).join(&quot;\n&quot;)}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      MESSAGE</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">      NtfyService.notify(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="43">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    raise exception</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="46">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="48">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def app_i18n(table, key, **args)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">    I18n.t(&quot;application.#{table}.#{key}&quot;, **args)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="52">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def form_i18n(form, key, **args)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="53">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    I18n.t(&quot;forms.#{form}.#{key}&quot;, **args)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="56">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1174" data-linenumber="57">
            
              <span class="hits">1174</span>
            

            
              
                <span class="hits" title="else branch hit 1150 times">
                  else: 1150
                </span>
              
                <span class="hits" title="then branch hit 24 times">
                  then: 24
                </span>
              
            

            <code class="ruby">    unless logged_in?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="58">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = form_i18n(:session_new, &quot;status.login_required&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="59">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      redirect_to login_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="63">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def require_logged_out</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="976" data-linenumber="64">
            
              <span class="hits">976</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 975 times">
                  else: 975
                </span>
              
            

            <code class="ruby">    if logged_in?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = form_i18n(:session_new, &quot;status.already_logged_in&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to inspections_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_last_active_at</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2729" data-linenumber="71">
            
              <span class="hits">2729</span>
            

            
              
                <span class="hits" title="then branch hit 1443 times">
                  then: 1443
                </span>
              
                <span class="hits" title="else branch hit 1286 times">
                  else: 1286
                </span>
              
                <span class="hits" title="then branch hit 1443 times">
                  then: 1443
                </span>
              
                <span class="hits" title="else branch hit 1286 times">
                  else: 1286
                </span>
              
            

            <code class="ruby">    if current_user&amp;.is_a?(User)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1443" data-linenumber="72">
            
              <span class="hits">1443</span>
            

            
              
            

            <code class="ruby">      current_user.update(last_active_at: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="76">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def require_admin</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="172" data-linenumber="77">
            
              <span class="hits">172</span>
            

            
              
                <span class="hits" title="then branch hit 172 times">
                  then: 172
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 145 times">
                  else: 145
                </span>
              
                <span class="hits" title="then branch hit 27 times">
                  then: 27
                </span>
              
            

            <code class="ruby">    unless current_user&amp;.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="78">
            
              <span class="hits">27</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;forms.session_new.status.admin_required&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="79">
            
              <span class="hits">27</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="83">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def admin_debug_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9668" data-linenumber="84">
            
              <span class="hits">9668</span>
            

            
              
                <span class="hits" title="then branch hit 6414 times">
                  then: 6414
                </span>
              
                <span class="hits" title="else branch hit 3232 times">
                  else: 3232
                </span>
              
            

            <code class="ruby">    Rails.env.development? || current_user&amp;.admin? || impersonating?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="87">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def should_check_query_limit?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2640" data-linenumber="88">
            
              <span class="hits">2640</span>
            

            
              
            

            <code class="ruby">    admin_debug_enabled? &amp;&amp; !seed_data_action?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="91">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def seed_data_action?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="336" data-linenumber="92">
            
              <span class="hits">336</span>
            

            
              
            

            <code class="ruby">    seed_actions = %w[add_seeds delete_seeds]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="336" data-linenumber="93">
            
              <span class="hits">336</span>
            

            
              
            

            <code class="ruby">    controller_name == &quot;users&quot; &amp;&amp; seed_actions.include?(action_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="96">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def impersonating?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8753" data-linenumber="97">
            
              <span class="hits">8753</span>
            

            
              
            

            <code class="ruby">    session[:original_admin_id].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="100">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def start_debug_timer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="101">
            
              <span class="hits">243</span>
            

            
              
            

            <code class="ruby">    @debug_start_time = Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="102">
            
              <span class="hits">243</span>
            

            
              
            

            <code class="ruby">    @debug_sql_queries = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="243" data-linenumber="104">
            
              <span class="hits">243</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 243 times">
                  else: 243
                </span>
              
            

            <code class="ruby">    if @debug_subscription</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            

            
              
            

            <code class="ruby">      ActiveSupport::Notifications.unsubscribe(@debug_subscription)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="243" data-linenumber="108">
            
              <span class="hits">243</span>
            

            
              
            

            <code class="ruby">    @debug_subscription = ActiveSupport::Notifications</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">      .subscribe(&quot;sql.active_record&quot;) do |name, start, finish, id, payload|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44272" data-linenumber="110">
            
              <span class="hits">44272</span>
            

            
              
                <span class="hits" title="else branch hit 110 times">
                  else: 110
                </span>
              
                <span class="hits" title="then branch hit 44162 times">
                  then: 44162
                </span>
              
            

            <code class="ruby">      unless payload[:name] == &quot;SCHEMA&quot; || payload[:sql] =~ /^PRAGMA/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44162" data-linenumber="111">
            
              <span class="hits">44162</span>
            

            
              
            

            <code class="ruby">        @debug_sql_queries &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">          sql: payload[:sql],</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44162" data-linenumber="113">
            
              <span class="hits">44162</span>
            

            
              
            

            <code class="ruby">          duration: ((finish - start) * 1000).round(2),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">          name: payload[:name]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">  # Make debug data available to views</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="121">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  helper_method :admin_debug_enabled?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    :impersonating?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">    :debug_render_time,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">    :debug_sql_queries</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="126">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def debug_render_time</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="174" data-linenumber="127">
            
              <span class="hits">174</span>
            

            
              
                <span class="hits" title="then branch hit 174 times">
                  then: 174
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if @debug_start_time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="174" data-linenumber="128">
            
              <span class="hits">174</span>
            

            
              
            

            <code class="ruby">      ((Time.current - @debug_start_time) * 1000).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="132">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def debug_sql_queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="894" data-linenumber="133">
            
              <span class="hits">894</span>
            

            
              
            

            <code class="ruby">    @debug_sql_queries || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="136">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_query_limit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="329" data-linenumber="137">
            
              <span class="hits">329</span>
            

            
              
            

            <code class="ruby">    table_query_counts = count_queries_by_table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="329" data-linenumber="139">
            
              <span class="hits">329</span>
            

            
              
            

            <code class="ruby">    table_query_counts.each do |table, count|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="570" data-linenumber="140">
            
              <span class="hits">570</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 570 times">
                  else: 570
                </span>
              
            

            <code class="ruby">      if count &gt; 5</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            

            
              
            

            <code class="ruby">        log_n_plus_one_queries(table, count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">        # Only raise exception in development and test environments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">        # Skip if we&#39;re processing images (which legitimately needs multiple blob queries)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="144">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if Rails.env.local? &amp;&amp; !processing_image_upload?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            

            
              
            

            <code class="ruby">          message = app_i18n(:debug, :n_plus_one_with_limit, table: table, count: count, limit: 5)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            

            
              
            

            <code class="ruby">          raise message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="152">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def processing_image_upload?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            

            
              
            

            <code class="ruby">    case controller_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="154">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="155">
            

            
              
            

            <code class="ruby">      action_name == &quot;update_settings&quot; &amp;&amp; params.dig(:user, :logo).present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="156">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;units&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            

            
              
            

            <code class="ruby">      %w[create update].include?(action_name) &amp;&amp; params.dig(:unit, :photo).present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="158">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            

            
              
            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="163">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_n_plus_one_queries(table, count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            

            
              
            

            <code class="ruby">    error_message = app_i18n(:debug, :n_plus_one_detected, table: table, count: count)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            

            
              
            

            <code class="ruby">    Rails.logger.error error_message</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            

            
              
            

            <code class="ruby">    Rails.logger.error app_i18n(:debug, :queries_for_table, table: table)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="167">
            

            
              
            

            <code class="ruby">    table_queries = debug_sql_queries.select { |q|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            

            
              
            

            <code class="ruby">      table_from_query(q[:sql]) == table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="170">
            

            
              
            

            <code class="ruby">    table_queries.each_with_index do |query, i|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="171">
            

            
              
            

            <code class="ruby">      query_log = app_i18n(:debug, :query_log_entry, name: query[:name], sql: query[:sql])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;  #{i + 1}. #{query_log}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="176">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def count_queries_by_table</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="329" data-linenumber="177">
            
              <span class="hits">329</span>
            

            
              
            

            <code class="ruby">    debug_sql_queries.each_with_object(Hash.new(0)) do |query, counts|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="879" data-linenumber="178">
            
              <span class="hits">879</span>
            

            
              
            

            <code class="ruby">      table = table_from_query(query[:sql])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="879" data-linenumber="179">
            
              <span class="hits">879</span>
            

            
              
                <span class="hits" title="then branch hit 788 times">
                  then: 788
                </span>
              
                <span class="hits" title="else branch hit 91 times">
                  else: 91
                </span>
              
            

            <code class="ruby">      counts[table] += 1 if table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="183">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def table_from_query(sql)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="879" data-linenumber="184">
            
              <span class="hits">879</span>
            

            
              
                <span class="hits" title="then branch hit 743 times">
                  then: 743
                </span>
              
            

            <code class="ruby">    if sql =~ /FROM\s+[&quot;&#39;]?(\w+)[&quot;&#39;]?/i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="743" data-linenumber="185">
            
              <span class="hits">743</span>
            

            
              
                <span class="hits" title="else branch hit 136 times">
                  else: 136
                </span>
              
            

            <code class="ruby">      $1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="136" data-linenumber="186">
            
              <span class="hits">136</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">    elsif sql =~ /INSERT\s+INTO\s+[&quot;&#39;]?(\w+)[&quot;&#39;]?/i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="187">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="else branch hit 119 times">
                  else: 119
                </span>
              
            

            <code class="ruby">      $1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="188">
            
              <span class="hits">119</span>
            

            
              
                <span class="hits" title="then branch hit 28 times">
                  then: 28
                </span>
              
            

            <code class="ruby">    elsif sql =~ /UPDATE\s+[&quot;&#39;]?(\w+)[&quot;&#39;]?/i</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="189">
            
              <span class="hits">28</span>
            

            
              
                <span class="hits" title="else branch hit 91 times">
                  else: 91
                </span>
              
            

            <code class="ruby">      $1</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="91" data-linenumber="190">
            
              <span class="hits">91</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 91 times">
                  else: 91
                </span>
              
            

            <code class="ruby">    elsif sql =~ /DELETE\s+FROM\s+[&quot;&#39;]?(\w+)[&quot;&#39;]?/i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="191">
            

            
              
            

            <code class="ruby">      $1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="195">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def cleanup_debug_subscription</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="336" data-linenumber="196">
            
              <span class="hits">336</span>
            

            
              
                <span class="hits" title="else branch hit 232 times">
                  else: 232
                </span>
              
                <span class="hits" title="then branch hit 104 times">
                  then: 104
                </span>
              
            

            <code class="ruby">    return unless @debug_subscription</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="232" data-linenumber="198">
            
              <span class="hits">232</span>
            

            
              
            

            <code class="ruby">    ActiveSupport::Notifications.unsubscribe(@debug_subscription)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="232" data-linenumber="199">
            
              <span class="hits">232</span>
            

            
              
            

            <code class="ruby">    @debug_subscription = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="57d7821dc6ad5423331405a35326a518492b095b">
  <div class="header">
    <h3>app/controllers/concerns/assessment_controller.rb</h3>
    <h4>
      <span class="green">
  93.55%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  66.67%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>62</b> relevant lines.
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include UserActivityCheck</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include InspectionTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  included do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="7">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    before_action :set_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="8">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    before_action :check_inspection_owner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="9">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    before_action :require_user_active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="10">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    before_action :set_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="11">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    before_action :set_previous_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="15">
            
              <span class="hits">52</span>
            

            
              
                <span class="hits" title="then branch hit 51 times">
                  then: 51
                </span>
              
            

            <code class="ruby">    if @assessment.update(assessment_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="16">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      @assessment.reload  # Ensure we have fresh data for turbo streams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="17">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      handle_successful_update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      handle_failed_update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_successful_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="26">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="27">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="28">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">        flash[:notice] = I18n.t(&quot;inspections.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="29">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">        redirect_to @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="31">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        success_response = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">          status: I18n.t(&quot;shared.api.success&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">          inspection: @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">        render json: success_response</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="38">
            
              <span class="hits">68</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream { render turbo_stream: success_turbo_streams }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_failed_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      format.html { render_edit_with_errors }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">        render json: {errors: @assessment.errors}, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream { render turbo_stream: error_turbo_streams }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="52">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def render_edit_with_errors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    params[:tab] = assessment_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @inspection.association(assessment_association).target = @assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    load_inspection_locations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    render &quot;inspections/edit&quot;, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="59">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="60">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    @inspection = Inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      .includes(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        :user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        :inspector_company,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        :unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">        *Inspection::ALL_ASSESSMENT_TYPES.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      .find(params[:inspection_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_inspection_owner</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="52" data-linenumber="71">
            
              <span class="hits">52</span>
            

            
              
                <span class="hits" title="else branch hit 52 times">
                  else: 52
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    head :not_found unless @inspection.user == current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="74">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="75">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    @assessment = @inspection.send(assessment_association)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  # Default implementation that permits all attributes except sensitive ones</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">  # Can be overridden in including controllers if needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="80">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="81">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    params.require(param_key).permit(permitted_attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="84">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def param_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">    # e.g. &quot;FanAssessmentsController&quot; -&gt; :assessments_fan_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="86">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    :&quot;assessments_#{controller_name.singularize}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="89">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def permitted_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    # Get all attributes except sensitive ones</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="91">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    excluded_attrs = %w[id inspection_id created_at updated_at]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="92">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    assessment_class.attribute_names - excluded_attrs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  # Automatically derive from controller name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="96">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_association</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">    # e.g. &quot;MaterialsAssessmentsController&quot; -&gt; &quot;materials_assessment&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="98">
            
              <span class="hits">53</span>
            

            
              
            

            <code class="ruby">    controller_name.singularize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">  # Automatically derive from controller name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="102">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    # e.g. &quot;MaterialsAssessmentsController&quot; -&gt; &quot;materials&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="104">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    controller_name.singularize.sub(/_assessment$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  # Automatically derive from controller name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="108">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_class</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    # e.g. &quot;MaterialsAssessmentsController&quot; -&gt; Assessments::MaterialsAssessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="110">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    &quot;Assessments::#{controller_name.singularize.camelize}&quot;.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="113">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def load_inspection_locations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @inspection_locations = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="117">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_previous_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="52" data-linenumber="118">
            
              <span class="hits">52</span>
            

            
              
                <span class="hits" title="else branch hit 52 times">
                  else: 52
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless @inspection.unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="120">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    @previous_inspection = @inspection.unit.last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="123">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_inactive_user_redirect</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            

            
              
            

            <code class="ruby">    redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="94bad543598a92f2fc8c429c0376f386950b138b">
  <div class="header">
    <h3>app/controllers/concerns/inspection_turbo_streams.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>17</b> relevant lines.
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module InspectionTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def success_turbo_streams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="8">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">      mark_complete_section_stream,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      save_message_stream(success: true),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      assessment_save_message_stream(success: true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def error_turbo_streams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      mark_complete_section_stream,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      save_message_stream(success: false),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      assessment_save_message_stream(success: false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def mark_complete_section_stream</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="23">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    turbo_stream.replace(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      &quot;mark_complete_section_#{@inspection.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      partial: &quot;inspections/mark_complete_section&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      locals: {inspection: @inspection}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def save_message_stream(success:)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="31">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    turbo_stream.replace(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      &quot;inspection_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      locals: save_message_locals(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        success: success,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        dom_id: &quot;inspection_save_message&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="41">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_save_message_stream(success:)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="42">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    turbo_stream.replace(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      &quot;form_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      locals: save_message_locals(success: success, dom_id: &quot;form_save_message&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def save_message_locals(success:, dom_id:)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="50">
            
              <span class="hits">58</span>
            

            
              
                <span class="hits" title="then branch hit 56 times">
                  then: 56
                </span>
              
            

            <code class="ruby">    if success</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="52">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">        dom_id: dom_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        success: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">        message: t(&quot;inspections.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="58">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        dom_id: dom_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">        errors: @inspection.errors.full_messages,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">        message: t(&quot;shared.messages.save_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2110d777d43e9d5dd521296a1112f5d846eea7b6">
  <div class="header">
    <h3>app/controllers/concerns/public_viewable.rb</h3>
    <h4>
      <span class="red">
  69.23%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  50.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>10</b> total branches, </span>
          <span class="green"><b>5</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module PublicViewable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  included do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="5">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    before_action :check_resource_access, only: %i[show]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    # Implemented by including controllers, but we call render_show_html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # for HTML format</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="11">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if request.format.html?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">      render_show_html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  # Access Rules:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  # 1. PDF/JSON/PNG formats: Always allowed for everyone (logged in or not)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  # 2. HTML format:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  #    - Not logged in: Allowed, shows minimal PDF viewer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  #    - Logged in as owner: Allowed, shows full application view</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  #    - Logged in as non-owner: Allowed, shows minimal PDF viewer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  # 3. All other actions/formats: Require ownership</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_resource_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    # Rule 1: Always allow PDF/JSON/PNG access for everyone</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="320" data-linenumber="27">
            
              <span class="hits">320</span>
            

            
              
                <span class="hits" title="then branch hit 117 times">
                  then: 117
                </span>
              
                <span class="hits" title="else branch hit 203 times">
                  else: 203
                </span>
              
            

            <code class="ruby">    return if request.format.pdf? || request.format.json? || request.format.png?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    # Rule 2: Always allow HTML access (show action decides the view)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="203" data-linenumber="30">
            
              <span class="hits">203</span>
            

            
              
                <span class="hits" title="then branch hit 203 times">
                  then: 203
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return if request.format.html? &amp;&amp; action_name == &quot;show&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    # Rule 3: Always allow HEAD requests for federation</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="33">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return if request.head?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    # Rule 4: All other cases require ownership</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">    check_resource_owner</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  # To be implemented by including controllers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_resource_owner</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">    raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  # Determine if current user owns the resource</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="45">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def owns_resource?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">    raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  # Render appropriate view for show action</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def render_show_html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="188" data-linenumber="51">
            
              <span class="hits">188</span>
            

            
              
                <span class="hits" title="else branch hit 164 times">
                  else: 164
                </span>
              
            

            <code class="ruby">    if !logged_in? || !owns_resource?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
                <span class="hits" title="then branch hit 24 times">
                  then: 24
                </span>
              
            

            <code class="ruby">      # Show minimal PDF viewer for public access or non-owners</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="53">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      @pdf_title = pdf_filename</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="54">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      @pdf_url = resource_pdf_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="55">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      render layout: &quot;pdf_viewer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    # Otherwise render normal view for owners (no explicit render needed)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  # To be implemented by including controllers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def pdf_filename</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            

            
              
            

            <code class="ruby">    raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def resource_pdf_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">    raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="51f688e8c30bf57cf51e0ba36602a28d71a3715e">
  <div class="header">
    <h3>app/controllers/concerns/safety_standards_turbo_streams.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SafetyStandardsTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def success_turbo_streams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="7">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    super + safety_standards_turbo_streams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_standards_turbo_streams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="11">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    [turbo_stream.replace(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      safety_results_frame_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      partial: safety_results_partial</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    )]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_results_frame_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="18">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    &quot;#{assessment_type}_safety_results&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_results_partial</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="22">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    &quot;assessments/#{assessment_type}_safety_results&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ba7157eae0afc73db92cb480454fdc8a4b8be227">
  <div class="header">
    <h3>app/controllers/concerns/unit_turbo_streams.rb</h3>
    <h4>
      <span class="green">
  90.91%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module UnitTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def render_unit_update_success_stream</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    render turbo_stream: build_unit_turbo_streams(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      success: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      message: t(&quot;units.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def render_unit_update_error_stream</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">    render turbo_stream: build_unit_turbo_streams(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      success: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      message: t(&quot;shared.messages.save_failed&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      errors: @unit.errors.full_messages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_unit_turbo_streams(success:, message:, errors: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="23">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      build_save_message_stream(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        success: success,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        message: message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        errors: errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      # Don&#39;t replace the file field - it stays as is after save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_save_message_stream(success:, message:, errors: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    turbo_stream.replace(&quot;form_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        message: message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        errors: errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="841fc4c23fdf58ed5188c954374d2d852ba84e16">
  <div class="header">
    <h3>app/controllers/concerns/user_activity_check.rb</h3>
    <h4>
      <span class="yellow">
  88.89%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module UserActivityCheck</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def require_user_active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="354" data-linenumber="7">
            
              <span class="hits">354</span>
            

            
              
                <span class="hits" title="then branch hit 342 times">
                  then: 342
                </span>
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">    return if current_user.is_active?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="9">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    flash[:alert] = current_user.inactive_user_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="10">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    handle_inactive_user_redirect</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  # Override this method in controllers to provide custom redirect logic</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_inactive_user_redirect</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">    raise NotImplementedError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8997b81e5b59ed6b8386417d7f9fa50189881887">
  <div class="header">
    <h3>app/controllers/concerns/user_turbo_streams.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module UserTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def render_user_update_success_stream</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="7">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    render turbo_stream: build_user_turbo_streams(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      success: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      message: t(&quot;users.messages.settings_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def render_user_update_error_stream</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    render turbo_stream: build_user_turbo_streams(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      success: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      message: t(&quot;shared.messages.save_failed&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      errors: @user.errors.full_messages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_user_turbo_streams(success:, message:, errors: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="23">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      build_save_message_stream(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        success: success,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        message: message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        errors: errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      # Don&#39;t replace the file field - it stays as is after save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_save_message_stream(success:, message:, errors: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="33">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    turbo_stream.replace(&quot;form_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        message: message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        errors: errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fc6a9d36d07241cb3f1788f03b2e2980de309833">
  <div class="header">
    <h3>app/controllers/enclosed_assessments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class EnclosedAssessmentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8bcae1d3799186ef9ee7216763ec05dd7ab94aa7">
  <div class="header">
    <h3>app/controllers/fan_assessments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class FanAssessmentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f9464fa3ff97953202e9fc24a8538a63e68eb8e4">
  <div class="header">
    <h3>app/controllers/guides_controller.rb</h3>
    <h4>
      <span class="red">
  33.33%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>24</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class GuidesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">    @guides = collect_guides</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    guide_path = params[:path]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">    metadata_file = guide_screenshots_root.join(guide_path, &quot;metadata.json&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="12">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if metadata_file.exist?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">      @guide_data = JSON.parse(metadata_file.read)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">      @guide_path = guide_path</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">      @guide_title = humanize_guide_title(guide_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="16">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">      redirect_to guides_path, alert: I18n.t(&quot;guides.messages.not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def guide_screenshots_root</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">    Rails.public_path.join(&quot;guide_screenshots&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def collect_guides</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">    guides = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    # Find all metadata.json files</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">    Dir.glob(guide_screenshots_root.join(&quot;**&quot;, &quot;metadata.json&quot;)).each do |metadata_path|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">      relative_path = Pathname.new(metadata_path).relative_path_from(guide_screenshots_root).dirname.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">      metadata = JSON.parse(File.read(metadata_path))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">      guides &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        path: relative_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        title: humanize_guide_title(relative_path),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        screenshot_count: metadata[&quot;screenshots&quot;].size,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">        updated_at: metadata[&quot;updated_at&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">        first_screenshot: metadata[&quot;screenshots&quot;].first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">    guides.sort_by { |g| g[:title] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def humanize_guide_title(path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    # Convert spec/features/inspections/inspection_creation_workflow_spec to &quot;Inspection Creation Workflow&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">    path.split(&quot;/&quot;).last.gsub(/_spec$/, &quot;&quot;).humanize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="665419945feb649a1cb3c36323ebff055d9e00dd">
  <div class="header">
    <h3>app/controllers/home_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class HomeController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def about</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dea9c23e2fa605c4d480805c6428dc674919efe4">
  <div class="header">
    <h3>app/controllers/inspections_controller.rb</h3>
    <h4>
      <span class="green">
  93.98%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  82.56%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>266</b> relevant lines.
      <span class="green"><b>250</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>86</b> total branches, </span>
          <span class="green"><b>71</b> branches covered</span> and
          <span class="red"><b>15</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class InspectionsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include InspectionTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include PublicViewable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include UserActivityCheck</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: %i[show]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :set_inspection, except: %i[create index]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :check_inspection_owner, except: %i[create index show]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :validate_unit_ownership, only: %i[update]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :redirect_if_complete,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    except: %i[create index destroy mark_draft show log]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_user_active, only: %i[create edit update]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :validate_inspection_completability, only: %i[show edit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :no_index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="17">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    all_inspections = filtered_inspections_query_without_order.to_a</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="18">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    partition_inspections(all_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="20">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    @title = build_index_title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="21">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    @has_any_inspections = all_inspections.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="22">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    load_inspection_locations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="24">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="25">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="26">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">      format.csv do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="27">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        log_inspection_event(&quot;exported&quot;, nil, &quot;Exported #{@complete_inspections.count} inspections to CSV&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="28">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        send_inspections_csv</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    # Handle federation HEAD requests</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="35">
            
              <span class="hits">178</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 177 times">
                  else: 177
                </span>
              
            

            <code class="ruby">    return head :ok if request.head?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="37">
            
              <span class="hits">177</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="290" data-linenumber="38">
            
              <span class="hits">290</span>
            

            
              
            

            <code class="ruby">      format.html { render_show_html }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="217" data-linenumber="39">
            
              <span class="hits">217</span>
            

            
              
            

            <code class="ruby">      format.pdf { send_inspection_pdf }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="184" data-linenumber="40">
            
              <span class="hits">184</span>
            

            
              
            

            <code class="ruby">      format.png { send_inspection_qr_code }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="177" data-linenumber="41">
            
              <span class="hits">177</span>
            

            
              
            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">        render json: JsonSerializerService.serialize_inspection(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="48">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    unit_id = params[:unit_id] || params.dig(:inspection, :unit_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="49">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    result = InspectionCreationService.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      unit_id: unit_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    ).create</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="54">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 20 times">
                  then: 20
                </span>
              
            

            <code class="ruby">    if result[:success]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="55">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      log_inspection_event(&quot;created&quot;, result[:inspection])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="56">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = result[:message]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="57">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_inspection_path(result[:inspection])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="59">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = result[:message]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="60">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to result[:redirect_path]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="64">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="65">
            
              <span class="hits">181</span>
            

            
              
            

            <code class="ruby">    validate_tab_parameter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="66">
            
              <span class="hits">181</span>
            

            
              
            

            <code class="ruby">    load_inspection_locations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="67">
            
              <span class="hits">181</span>
            

            
              
            

            <code class="ruby">    set_previous_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="71">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">    previous_attributes = @inspection.attributes.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="72">
            
              <span class="hits">42</span>
            

            
              
                <span class="hits" title="then branch hit 39 times">
                  then: 39
                </span>
              
            

            <code class="ruby">    if @inspection.update(inspection_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="73">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      changed_data = calculate_changes(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">        previous_attributes,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        @inspection.attributes,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        inspection_params.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="78">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      log_inspection_event(&quot;updated&quot;, @inspection, nil, changed_data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="79">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      handle_successful_update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="81">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      handle_failed_update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="86">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    if @inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="87">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      alert_message = I18n.t(&quot;inspections.messages.delete_complete_denied&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="88">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to inspection_path(@inspection), alert: alert_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="89">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">    # Capture inspection details before deletion for the audit log</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    inspection_details = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="94">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      unique_report_number: @inspection.unique_report_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      inspection_date: @inspection.inspection_date,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="96">
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      unit_serial: @inspection.unit&amp;.serial,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="97">
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      unit_name: @inspection.unit&amp;.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      complete_date: @inspection.complete_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="101">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @inspection.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    # Log the deletion with the inspection details in metadata</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="103">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    Event.log(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      user: current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      action: &quot;deleted&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      resource: @inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      details: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      metadata: inspection_details</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="110">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    redirect_to inspections_path, notice: I18n.t(&quot;inspections.messages.deleted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="113">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def select_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="114">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @units = current_user.units</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      .includes(photo_attachment: :blob)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      .search(params[:search])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      .by_manufacturer(params[:manufacturer])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      .order(:name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="119">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @title = t(&quot;inspections.titles.select_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="121">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    render :select_unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="124">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="125">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    unit = current_user.units.find_by(id: params[:unit_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="127">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    unless unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="128">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.errors.invalid_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="129">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to select_unit_inspection_path(@inspection) and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="132">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @inspection.unit = unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="134">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    if @inspection.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="135">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      handle_successful_unit_update(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="136">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            

            
              
            

            <code class="ruby">      handle_failed_unit_update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="141">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_successful_unit_update(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="142">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    log_inspection_event(&quot;unit_changed&quot;, @inspection, &quot;Unit changed to #{unit.name}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="143">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = t(&quot;inspections.messages.unit_changed&quot;, unit_name: unit.name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="144">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="147">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_failed_unit_update</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            

            
              
            

            <code class="ruby">    error_messages = @inspection.errors.full_messages.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            

            
              
            

            <code class="ruby">    flash[:alert] = t(&quot;inspections.messages.unit_change_failed&quot;, errors: error_messages)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            

            
              
            

            <code class="ruby">    redirect_to select_unit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="153">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="154">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    validation_errors = @inspection.validate_completeness</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="156">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">    if validation_errors.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="157">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      error_list = validation_errors.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="158">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] =</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">        t(&quot;inspections.messages.cannot_complete&quot;, errors: error_list)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="160">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="164">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    @inspection.complete!(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="165">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    log_inspection_event(&quot;completed&quot;, @inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="166">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = t(&quot;inspections.messages.marked_complete&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="167">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    redirect_to @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="170">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def mark_draft</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="171">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">    if @inspection.update(complete_date: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="172">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      log_inspection_event(&quot;marked_draft&quot;, @inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="173">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = t(&quot;inspections.messages.marked_in_progress&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="175">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      error_messages = @inspection.errors.full_messages.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="176">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.messages.mark_in_progress_failed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">        errors: error_messages)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="179">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="182">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="183">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @events = Event.for_resource(@inspection).recent.includes(:user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="184">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @title = I18n.t(&quot;inspections.titles.log&quot;, inspection: @inspection.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="187">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="188">
            
              <span class="hits">127</span>
            

            
              
            

            <code class="ruby">    base_params = build_base_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="189">
            
              <span class="hits">127</span>
            

            
              
            

            <code class="ruby">    add_assessment_params(base_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="190">
            
              <span class="hits">127</span>
            

            
              
            

            <code class="ruby">    base_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="193">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="195">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def partition_inspections(all_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="196">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    @draft_inspections = all_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="125" data-linenumber="197">
            
              <span class="hits">125</span>
            

            
              
            

            <code class="ruby">      .select { it.complete_date.nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">      .sort_by(&amp;:created_at)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="200">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    @complete_inspections = all_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="125" data-linenumber="201">
            
              <span class="hits">125</span>
            

            
              
            

            <code class="ruby">      .select { it.complete_date.present? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="202">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      .sort_by { -it.created_at.to_i }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="205">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def send_inspections_csv</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="206">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    csv_data = InspectionCsvExportService.new(@complete_inspections).generate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="207">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    filename = I18n.t(&quot;inspections.export.csv_filename&quot;, date: Time.zone.today)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="208">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    send_data csv_data, filename: filename</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="211">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_tab_parameter</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="212">
            
              <span class="hits">181</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 57 times">
                  else: 57
                </span>
              
            

            <code class="ruby">    return if params[:tab].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="57" data-linenumber="214">
            
              <span class="hits">57</span>
            

            
              
            

            <code class="ruby">    valid_tabs = helpers.inspection_tabs(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="57" data-linenumber="215">
            
              <span class="hits">57</span>
            

            
              
                <span class="hits" title="else branch hit 57 times">
                  else: 57
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    unless valid_tabs.include?(params[:tab])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="216">
            

            
              
            

            <code class="ruby">      redirect_to edit_inspection_path(@inspection),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">        alert: I18n.t(&quot;inspections.messages.invalid_tab&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="221">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_inspection_completability</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="361" data-linenumber="222">
            
              <span class="hits">361</span>
            

            
              
                <span class="hits" title="else branch hit 97 times">
                  else: 97
                </span>
              
                <span class="hits" title="then branch hit 264 times">
                  then: 264
                </span>
              
            

            <code class="ruby">    return unless @inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="223">
            
              <span class="hits">97</span>
            

            
              
                <span class="hits" title="then branch hit 95 times">
                  then: 95
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return if @inspection.can_mark_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="225">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    error_message = I18n.t(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">      &quot;inspections.errors.invalid_completion_state&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">      errors: @inspection.completion_errors.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="230">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    inspection_errors = @inspection.completion_errors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="231">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    Rails.logger.error &quot;Inspection #{@inspection.id} is marked complete &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">                      &quot;but has errors: #{inspection_errors}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">    # Only raise error in development/test environments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="235">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if Rails.env.local?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="236">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      test_message = &quot;In tests, use create(:inspection, :completed) to avoid this.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="237">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      raise StandardError, &quot;DATA INTEGRITY ERROR: #{error_message}. #{test_message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="239">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      # In production, log the error but continue</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="240">
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;DATA INTEGRITY ERROR: #{error_message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">  ASSESSMENT_SYSTEM_ATTRIBUTES = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="245">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    inspection_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby">    created_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">    updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">  # Build safe mappings from Inspection::ALL_ASSESSMENT_TYPES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">  # This ensures mappings stay in sync with the model definition</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="252">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ASSESSMENT_TAB_MAPPING = Inspection::ALL_ASSESSMENT_TYPES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">    .each_with_object({}) do |(method_name, _), hash|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">      # Convert :user_height_assessment to &quot;user_height&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="255">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">      tab_name = method_name.to_s.gsub(/_assessment$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="256">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">      hash[tab_name] = method_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">    end.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="259">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ASSESSMENT_CLASS_MAPPING = Inspection::ALL_ASSESSMENT_TYPES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">    .each_with_object({}) do |(method_name, klass), hash|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">      # Convert :user_height_assessment to &quot;user_height&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="262">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">      tab_name = method_name.to_s.gsub(/_assessment$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="263">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">      hash[tab_name] = klass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">    end.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="266">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_base_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="267">
            
              <span class="hits">127</span>
            

            
              
            

            <code class="ruby">    params.require(:inspection).permit(*Inspection::USER_EDITABLE_PARAMS)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="270">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def add_assessment_params(base_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="271">
            
              <span class="hits">127</span>
            

            
              
            

            <code class="ruby">    Inspection::ALL_ASSESSMENT_TYPES.each do |ass_type, _ass_class|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="889" data-linenumber="272">
            
              <span class="hits">889</span>
            

            
              
            

            <code class="ruby">      ass_key = &quot;#{ass_type}_attributes&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="889" data-linenumber="273">
            
              <span class="hits">889</span>
            

            
              
                <span class="hits" title="then branch hit 889 times">
                  then: 889
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      next if params[:inspection][ass_key].blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="275">
            

            
              
            

            <code class="ruby">      ass_params = params[:inspection][ass_key]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="276">
            

            
              
            

            <code class="ruby">      permitted_ass_params = assessment_permitted_attributes(ass_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="277">
            

            
              
            

            <code class="ruby">      base_params[ass_key] = ass_params.permit(*permitted_ass_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="281">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_permitted_attributes(assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="282">
            

            
              
            

            <code class="ruby">    model_class = &quot;Assessments::#{assessment_type.to_s.camelize}&quot;.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="283">
            

            
              
            

            <code class="ruby">    all_attributes = model_class.column_names</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="284">
            

            
              
            

            <code class="ruby">    (all_attributes - ASSESSMENT_SYSTEM_ATTRIBUTES).map { it.to_sym }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="287">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def filtered_inspections_query_without_order = current_user.inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">    .includes(:inspector_company, unit: {photo_attachment: :blob})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby">    .search(params[:query])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">    .filter_by_result(params[:result])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">    .filter_by_unit(params[:unit_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">    .filter_by_owner(params[:owner])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">    .filter_by_inspection_location(params[:inspection_location])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="295">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def no_index = response.set_header(&quot;X-Robots-Tag&quot;, &quot;noindex,nofollow&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="297">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="486" data-linenumber="298">
            
              <span class="hits">486</span>
            

            
              
            

            <code class="ruby">    @inspection = Inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby">      .includes(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby">        :user, :inspector_company,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby">        *Inspection::ALL_ASSESSMENT_TYPES.keys,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            
              
            

            <code class="ruby">        unit: {photo_attachment: :blob}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="304">
            

            
              
                <span class="hits" title="then branch hit 486 times">
                  then: 486
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      .find_by(id: params[:id]&amp;.upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="486" data-linenumber="306">
            
              <span class="hits">486</span>
            

            
              
                <span class="hits" title="else branch hit 473 times">
                  else: 473
                </span>
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
            

            <code class="ruby">    head :not_found unless @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="309">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_inspection_owner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="293" data-linenumber="310">
            
              <span class="hits">293</span>
            

            
              
                <span class="hits" title="then branch hit 284 times">
                  then: 284
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    return if current_user &amp;&amp; @inspection.user_id == current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="312">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    head :not_found</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="315">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def redirect_if_complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="268" data-linenumber="316">
            
              <span class="hits">268</span>
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 258 times">
                  then: 258
                </span>
              
            

            <code class="ruby">    return unless @inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="318">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;inspections.messages.cannot_edit_complete&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="319">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    redirect_to @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="322">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_index_title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="323">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">    title = I18n.t(&quot;inspections.titles.index&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="324">
            
              <span class="hits">424</span>
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 414 times">
                  then: 414
                </span>
              
            

            <code class="ruby">    return title unless params[:result]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="326">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="in branch hit 8 times">
                  in: 8
                </span>
              
            

            <code class="ruby">    status = case params[:result]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="327">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="in branch hit 2 times">
                  in: 2
                </span>
              
            

            <code class="ruby">    in &quot;passed&quot; then I18n.t(&quot;inspections.status.passed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="328">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    in &quot;failed&quot; then I18n.t(&quot;inspections.status.failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="329">
            

            
              
            

            <code class="ruby">    else params[:result]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="331">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    &quot;#{title} - #{status}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="334">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_unit_ownership</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="335">
            
              <span class="hits">45</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 44 times">
                  then: 44
                </span>
              
            

            <code class="ruby">    return unless inspection_params[:unit_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="337">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    unit = current_user.units.find_by(id: inspection_params[:unit_id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="338">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return if unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            
              
            

            <code class="ruby">    # Unit ID not found or doesn&#39;t belong to user - security issue</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="341">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    flash[:alert] = I18n.t(&quot;inspections.errors.invalid_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="342">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    render :edit, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="345">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_successful_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="346">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="347">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="348">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">        flash[:notice] = I18n.t(&quot;inspections.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="349">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">        redirect_to @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="351">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="352">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        render json: {status: I18n.t(&quot;shared.api.success&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            

            
              
            

            <code class="ruby">                      inspection: @inspection}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="355">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream { render turbo_stream: success_turbo_streams }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="358">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="359">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_failed_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="360">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="361">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="362">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      format.json { render json: {status: I18n.t(&quot;shared.api.error&quot;), errors: @inspection.errors.full_messages} }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="363">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream { render turbo_stream: error_turbo_streams }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="364">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="367">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def send_inspection_pdf</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="368">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    pdf_data = PdfGeneratorService.generate_inspection_report(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            

            
              
            

            <code class="ruby">      @inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="370">
            

            
              
            

            <code class="ruby">      debug_enabled: admin_debug_enabled?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            
              
            

            <code class="ruby">      debug_queries: debug_sql_queries</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="373">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    @inspection.update(pdf_last_accessed_at: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="374">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="375">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    send_data pdf_data.render,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            

            
              
            

            <code class="ruby">      filename: pdf_filename,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            

            
              
            

            <code class="ruby">      type: &quot;application/pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="378">
            

            
              
            

            <code class="ruby">      disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="381">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def send_inspection_qr_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="382">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    qr_code_png = QrCodeService.generate_qr_code(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="383">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="384">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    send_data qr_code_png,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            
              
            

            <code class="ruby">      filename: qr_code_filename,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="386">
            

            
              
            

            <code class="ruby">      type: &quot;image/png&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="387">
            

            
              
            

            <code class="ruby">      disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            
              
            

            <code class="ruby">  # PublicViewable implementation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="391">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_resource_owner</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="392">
            

            
              
            

            <code class="ruby">    check_inspection_owner</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="395">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def owns_resource?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="396">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    @inspection &amp;&amp; current_user &amp;&amp; @inspection.user_id == current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="397">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="399">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def pdf_filename</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="54" data-linenumber="400">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 54 times">
                  then: 54
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    identifier = @inspection.unit&amp;.serial || @inspection.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="401">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    I18n.t(&quot;inspections.export.pdf_filename&quot;, identifier: identifier)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="402">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="404">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def qr_code_filename</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="405">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    identifier = @inspection.unit&amp;.serial || @inspection.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="406">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    I18n.t(&quot;inspections.export.qr_filename&quot;, identifier: identifier)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="407">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="408">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="409">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def resource_pdf_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="410">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    inspection_path(@inspection, format: :pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="411">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="412">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="413">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def load_inspection_locations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="605" data-linenumber="414">
            
              <span class="hits">605</span>
            

            
              
            

            <code class="ruby">    @inspection_locations = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="415">
            

            
              
            

            <code class="ruby">      .inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="416">
            

            
              
            

            <code class="ruby">      .pluck(:inspection_location)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="417">
            

            
              
            

            <code class="ruby">      .uniq</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="418">
            

            
              
            

            <code class="ruby">      .compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="419">
            

            
              
            

            <code class="ruby">      .sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="421">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="422">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_inactive_user_redirect</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="423">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    if action_name == &quot;create&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="424">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      unit_id = params[:unit_id] || params.dig(:inspection, :unit_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="425">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">      if unit_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="426">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        unit = current_user.units.find_by(id: unit_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="427">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        redirect_to unit ? unit_path(unit) : inspections_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="428">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="429">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        redirect_to inspections_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="430">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="431">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    elsif action_name.in?(%w[edit update]) &amp;&amp; @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="432">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="433">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="434">
            

            
              
            

            <code class="ruby">      redirect_to inspections_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="435">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="436">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="437">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="438">
            

            
              
            

            <code class="ruby">  NOT_COPIED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="439">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    complete_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="440">
            

            
              
            

            <code class="ruby">    created_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="441">
            

            
              
            

            <code class="ruby">    id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="442">
            

            
              
            

            <code class="ruby">    inspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="443">
            

            
              
            

            <code class="ruby">    inspection_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            

            
              
            

            <code class="ruby">    inspector_company_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="445">
            

            
              
            

            <code class="ruby">    is_seed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="446">
            

            
              
            

            <code class="ruby">    passed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="447">
            

            
              
            

            <code class="ruby">    pdf_last_accessed_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="448">
            

            
              
            

            <code class="ruby">    unique_report_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="449">
            

            
              
            

            <code class="ruby">    unit_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="450">
            

            
              
            

            <code class="ruby">    updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="451">
            

            
              
            

            <code class="ruby">    user_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="452">
            

            
              
            

            <code class="ruby">  ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="453">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="454">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_previous_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="455">
            
              <span class="hits">181</span>
            

            
              
                <span class="hits" title="then branch hit 177 times">
                  then: 177
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    @previous_inspection = @inspection.unit&amp;.last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="456">
            
              <span class="hits">181</span>
            

            
              
                <span class="hits" title="then branch hit 156 times">
                  then: 156
                </span>
              
                <span class="hits" title="else branch hit 25 times">
                  else: 25
                </span>
              
            

            <code class="ruby">    return if !@previous_inspection || @previous_inspection.id == @inspection.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="457">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="458">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @prefilled_fields = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="459">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    current_object, previous_object, column_names = get_prefill_objects</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="460">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="461">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    column_names.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="542" data-linenumber="462">
            
              <span class="hits">542</span>
            

            
              
                <span class="hits" title="then branch hit 183 times">
                  then: 183
                </span>
              
                <span class="hits" title="else branch hit 359 times">
                  else: 359
                </span>
              
            

            <code class="ruby">      next if NOT_COPIED_FIELDS.include?(field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="359" data-linenumber="463">
            
              <span class="hits">359</span>
            

            
              
                <span class="hits" title="then branch hit 359 times">
                  then: 359
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 57 times">
                  then: 57
                </span>
              
                <span class="hits" title="else branch hit 302 times">
                  else: 302
                </span>
              
            

            <code class="ruby">      next if previous_object&amp;.send(field).nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="302" data-linenumber="464">
            
              <span class="hits">302</span>
            

            
              
                <span class="hits" title="else branch hit 200 times">
                  else: 200
                </span>
              
                <span class="hits" title="then branch hit 102 times">
                  then: 102
                </span>
              
            

            <code class="ruby">      next unless current_object.send(field).nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="465">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="466">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">      @prefilled_fields &lt;&lt; translate_field_name(field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="467">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="468">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="469">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="470">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def get_prefill_objects</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="471">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    case params[:tab]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="472">
            

            
              
                <span class="hits" title="when branch hit 13 times">
                  when: 13
                </span>
              
            

            <code class="ruby">    when &quot;inspection&quot;, &quot;&quot;, nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="473">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      [@inspection, @previous_inspection, Inspection.column_names]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="474">
            

            
              
            

            <code class="ruby">    when &quot;results&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="475">
            

            
              
            

            <code class="ruby">      # Results tab uses inspection fields directly, not an assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="476">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">      # Only risk_assessment should be prefilled, not passed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="477">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      [@inspection, @previous_inspection, [&quot;risk_assessment&quot;]]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="478">
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="479">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      assessment_method = ASSESSMENT_TAB_MAPPING[params[:tab]]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="480">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      assessment_class = ASSESSMENT_CLASS_MAPPING[params[:tab]]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="481">
            

            
              
            

            <code class="ruby">      [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="482">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        @inspection.public_send(assessment_method),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="483">
            

            
              
            

            <code class="ruby">        @previous_inspection.public_send(assessment_method),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="484">
            

            
              
            

            <code class="ruby">        assessment_class.column_names</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="485">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="486">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="487">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="488">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="489">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def translate_field_name(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="490">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">    is_comment = field.end_with?(&quot;_comment&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="491">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">    is_pass = field.end_with?(&quot;_pass&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="492">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">    field_base = field.gsub(/_(comment|pass)$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="493">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">    i18n_base = &quot;forms.#{params[:tab]}.fields&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="494">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="495">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">    translated = I18n.t(&quot;#{i18n_base}.#{field_base}&quot;, default: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="496">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">    translated ||= I18n.t(&quot;#{i18n_base}.#{field}&quot;, default: field.humanize)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="497">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="498">
            
              <span class="hits">200</span>
            

            
              
                <span class="hits" title="then branch hit 77 times">
                  then: 77
                </span>
              
            

            <code class="ruby">    if is_comment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="499">
            
              <span class="hits">77</span>
            

            
              
                <span class="hits" title="else branch hit 123 times">
                  else: 123
                </span>
              
            

            <code class="ruby">      translated += &quot; (#{I18n.t(&quot;shared.comment&quot;)})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="123" data-linenumber="500">
            
              <span class="hits">123</span>
            

            
              
                <span class="hits" title="then branch hit 65 times">
                  then: 65
                </span>
              
                <span class="hits" title="else branch hit 58 times">
                  else: 58
                </span>
              
            

            <code class="ruby">    elsif is_pass</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="501">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">      translated += &quot; (#{I18n.t(&quot;shared.pass&quot;)}/#{I18n.t(&quot;shared.fail&quot;)})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="502">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="503">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="504">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">    translated</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="505">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="506">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="507">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_inspection_event(action, inspection, details = nil, changed_data = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="84" data-linenumber="508">
            
              <span class="hits">84</span>
            

            
              
                <span class="hits" title="else branch hit 84 times">
                  else: 84
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="509">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="84" data-linenumber="510">
            
              <span class="hits">84</span>
            

            
              
                <span class="hits" title="then branch hit 75 times">
                  then: 75
                </span>
              
            

            <code class="ruby">    if inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="75" data-linenumber="511">
            
              <span class="hits">75</span>
            

            
              
            

            <code class="ruby">      Event.log(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="512">
            

            
              
            

            <code class="ruby">        user: current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="513">
            

            
              
            

            <code class="ruby">        action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="514">
            

            
              
            

            <code class="ruby">        resource: inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="515">
            

            
              
            

            <code class="ruby">        details: details,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="516">
            

            
              
            

            <code class="ruby">        changed_data: changed_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="517">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="518">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="519">
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">      # For events without a specific inspection (like CSV export)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="520">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      Event.log_system_event(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="521">
            

            
              
            

            <code class="ruby">        user: current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="522">
            

            
              
            

            <code class="ruby">        action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="523">
            

            
              
            

            <code class="ruby">        details: details,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="524">
            

            
              
            

            <code class="ruby">        metadata: {resource_type: &quot;Inspection&quot;}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="525">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="526">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="527">
            

            
              
            

            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="528">
            

            
              
            

            <code class="ruby">    Rails.logger.error &quot;Failed to log inspection event: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="529">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="530">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="531">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def calculate_changes(previous_attributes, current_attributes, changed_keys)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="532">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    changes = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="533">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="534">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    changed_keys.map(&amp;:to_s).each do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="196" data-linenumber="535">
            
              <span class="hits">196</span>
            

            
              
            

            <code class="ruby">      previous_value = previous_attributes[key]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="196" data-linenumber="536">
            
              <span class="hits">196</span>
            

            
              
            

            <code class="ruby">      current_value = current_attributes[key]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="537">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="196" data-linenumber="538">
            
              <span class="hits">196</span>
            

            
              
                <span class="hits" title="then branch hit 68 times">
                  then: 68
                </span>
              
                <span class="hits" title="else branch hit 128 times">
                  else: 128
                </span>
              
            

            <code class="ruby">      if previous_value != current_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="539">
            
              <span class="hits">68</span>
            

            
              
            

            <code class="ruby">        changes[key] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="540">
            

            
              
            

            <code class="ruby">          &quot;from&quot; =&gt; previous_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="541">
            

            
              
            

            <code class="ruby">          &quot;to&quot; =&gt; current_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="542">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="543">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="544">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="545">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="546">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    changes.presence</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="547">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="548">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="470f05818af2e79bb996c2e355a22441a3681be3">
  <div class="header">
    <h3>app/controllers/inspector_companies_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>42</b> relevant lines.
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class InspectorCompaniesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :set_inspector_company, only: %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">    show edit update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_admin, except: [:show]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="9">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    @inspector_companies = InspectorCompany</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      .with_attached_logo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      .by_status(params[:active])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      .search_by_term(params[:search])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      .order(:name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="17">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    @company_stats = @inspector_company.company_statistics</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="18">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    @recent_inspections = @inspector_company.recent_inspections(5)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="22">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    @inspector_company = InspectorCompany.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="23">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    @inspector_company.country = &quot;UK&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="27">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @inspector_company = InspectorCompany.new(inspector_company_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="29">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
            

            <code class="ruby">    if @inspector_company.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="30">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = t(&quot;inspector_companies.messages.created&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="31">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      redirect_to @inspector_company</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="33">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="37">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="41">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
            

            <code class="ruby">    if @inspector_company.update(inspector_company_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="42">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      handle_successful_update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="44">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      handle_failed_update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="48">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_successful_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="51">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="52">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="53">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        flash[:notice] = t(&quot;inspector_companies.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="54">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        redirect_to @inspector_company</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="56">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        render turbo_stream: save_message_turbo_stream(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">          t(&quot;inspector_companies.messages.updated&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">          &quot;success&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_failed_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="66">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="67">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="68">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        render turbo_stream: save_message_turbo_stream(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">          t(&quot;shared.messages.save_failed&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">          &quot;error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="77">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def save_message_turbo_stream(message, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="79">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      turbo_stream.replace(&quot;form_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">          element_id: &quot;form_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">          message: message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">          type: type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="89">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_inspector_company</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="90">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    @inspector_company = InspectorCompany.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="93">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspector_company_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="94">
            
              <span class="hits">27</span>
            

            
              
            

            <code class="ruby">    params.require(:inspector_company).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      :name, :email, :phone, :address,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      :city, :postal_code, :country,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      :active, :notes, :logo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9cf46ea01a64c5f9a09940584c8e015ef43d7d8e">
  <div class="header">
    <h3>app/controllers/materials_assessments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class MaterialsAssessmentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="21828e4f644c269e534dfa23b7f95e7aa1893687">
  <div class="header">
    <h3>app/controllers/safety_standards_controller.rb</h3>
    <h4>
      <span class="green">
  98.98%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  91.18%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>98</b> relevant lines.
      <span class="green"><b>97</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>34</b> total branches, </span>
          <span class="green"><b>31</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class SafetyStandardsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :verify_authenticity_token, only: [:index]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  CALCULATION_TYPES = %w[anchors slide_runout wall_height user_capacity].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="149" data-linenumber="8">
            
              <span class="hits">149</span>
            

            
              
            

            <code class="ruby">    @calculation_metadata = SafetyStandard.calculation_metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="149" data-linenumber="10">
            
              <span class="hits">149</span>
            

            
              
                <span class="hits" title="then branch hit 87 times">
                  then: 87
                </span>
              
            

            <code class="ruby">    if post_request_with_calculation?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="87" data-linenumber="11">
            
              <span class="hits">87</span>
            

            
              
            

            <code class="ruby">      handle_calculation_post</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
                <span class="hits" title="else branch hit 62 times">
                  else: 62
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="13">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">      handle_calculation_get</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def post_request_with_calculation?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="149" data-linenumber="20">
            
              <span class="hits">149</span>
            

            
              
            

            <code class="ruby">    request.post? &amp;&amp; params[:calculation].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_calculation_post</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="87" data-linenumber="24">
            
              <span class="hits">87</span>
            

            
              
            

            <code class="ruby">    calculate_safety_standard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="87" data-linenumber="25">
            
              <span class="hits">87</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="87" data-linenumber="26">
            
              <span class="hits">87</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="127" data-linenumber="27">
            
              <span class="hits">127</span>
            

            
              
            

            <code class="ruby">      format.json { render json: build_json_response }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110" data-linenumber="28">
            
              <span class="hits">110</span>
            

            
              
            

            <code class="ruby">      format.html { redirect_with_calculation_params }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_calculation_get</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="33">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 24 times">
                  then: 24
                </span>
              
                <span class="hits" title="else branch hit 38 times">
                  else: 38
                </span>
              
            

            <code class="ruby">    calculate_safety_standard if params[:calculation].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="34">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="35">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="39">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def redirect_with_calculation_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="40">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">    redirect_to safety_standards_path(calculation: params[:calculation].to_unsafe_h)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def calculate_safety_standard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="141" data-linenumber="44">
            
              <span class="hits">141</span>
            

            
              
            

            <code class="ruby">    type = params[:calculation][:type]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="141" data-linenumber="45">
            
              <span class="hits">141</span>
            

            
              
                <span class="hits" title="then branch hit 130 times">
                  then: 130
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    send(&quot;calculate_#{type}&quot;) if CALCULATION_TYPES.include?(type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="48">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def calculate_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="49">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    dimensions = extract_dimensions(:length, :width, :height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="51">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 47 times">
                  then: 47
                </span>
              
            

            <code class="ruby">    if dimensions.values.all?(&amp;:positive?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="52">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">      @anchor_result = SafetyStandards::AnchorCalculator.calculate(**dimensions)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="54">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      set_error(:anchor, :invalid_dimensions)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="58">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def calculate_slide_runout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="59">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    height = param_to_float(:platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="60">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    has_stop_wall = params[:calculation][:has_stop_wall] == &quot;1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="62">
            
              <span class="hits">31</span>
            

            
              
                <span class="hits" title="then branch hit 26 times">
                  then: 26
                </span>
              
            

            <code class="ruby">    if height.positive?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="63">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      @runout_result = build_runout_result(height, has_stop_wall)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="65">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      set_error(:runout, :invalid_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="69">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def calculate_wall_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="70">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    platform_height = param_to_float(:platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="71">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    user_height = param_to_float(:user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="73">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
            

            <code class="ruby">    if platform_height.positive? &amp;&amp; user_height.positive?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="74">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      @wall_height_result = build_wall_height_result(platform_height, user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="76">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      set_error(:wall_height, :invalid_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="80">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def calculate_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="81">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    length = param_to_float(:length)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="82">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    width = param_to_float(:width)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="83">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    max_user_height = param_to_float(:max_user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="84">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    max_user_height = nil if max_user_height.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="85">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    negative_adjustment_area = param_to_float(:negative_adjustment_area)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="87">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
            

            <code class="ruby">    if length.positive? &amp;&amp; width.positive?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="88">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      @capacity_result = SafetyStandards::UserCapacityCalculator.calculate(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">        length, width, max_user_height, negative_adjustment_area</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="92">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      @capacity_result = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="93">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      @capacity_error = t(&quot;safety_standards.errors.invalid_dimensions&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def extract_dimensions(*keys)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="248" data-linenumber="98">
            
              <span class="hits">248</span>
            

            
              
            

            <code class="ruby">    keys.index_with { |key| param_to_float(key) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="101">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def param_to_float(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="331" data-linenumber="102">
            
              <span class="hits">331</span>
            

            
              
            

            <code class="ruby">    params[:calculation][key].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="105">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_error(type, error_key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="106">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    instance_variable_set(&quot;@#{type}_error&quot;, t(&quot;safety_standards.errors.#{error_key}&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="109">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_runout_result(platform_height, has_stop_wall)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="110">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    SafetyStandards::SlideCalculator.calculate_required_runout(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      platform_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      has_stop_wall: has_stop_wall</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="116">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_wall_height_result(platform_height, user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="117">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    SafetyStandards::SlideCalculator.calculate_wall_height_requirements(platform_height, user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="120">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_json_response</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="121">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    type = params[:calculation][:type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="123">
            
              <span class="hits">40</span>
            

            
              
                <span class="hits" title="else branch hit 30 times">
                  else: 30
                </span>
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
            

            <code class="ruby">    unless CALCULATION_TYPES.include?(type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="124">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      return {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">        passed: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">        status: &quot;Invalid calculation type: #{type || &quot;none provided&quot;}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">        result: nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="131">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    build_typed_json_response(type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      passed: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      status: &quot;Calculation failed: #{e.message}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      result: nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="140">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_typed_json_response(type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">    # Ensure calculation is performed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="142">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    calculate_safety_standard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="30" data-linenumber="144">
            
              <span class="hits">30</span>
            

            
              
                <span class="hits" title="when branch hit 12 times">
                  when: 12
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    result_var = case type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="145">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">    when &quot;anchors&quot; then &quot;@anchor_result&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="146">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">    when &quot;slide_runout&quot; then &quot;@runout_result&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="147">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">    when &quot;wall_height&quot; then &quot;@wall_height_result&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="148">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    when &quot;user_capacity&quot; then &quot;@capacity_result&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="30" data-linenumber="151">
            
              <span class="hits">30</span>
            

            
              
                <span class="hits" title="when branch hit 12 times">
                  when: 12
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    error_var = case type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="152">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">    when &quot;anchors&quot; then &quot;@anchor_error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="153">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">    when &quot;slide_runout&quot; then &quot;@runout_error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="154">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">    when &quot;wall_height&quot; then &quot;@wall_height_error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="155">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    when &quot;user_capacity&quot; then &quot;@capacity_error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="158">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    result = instance_variable_get(result_var)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="159">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    error = instance_variable_get(error_var)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="161">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    if result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
            

            <code class="ruby">      # For user capacity, we need to extract the capacities from the CalculatorResponse</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="163">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">      if type == &quot;user_capacity&quot; &amp;&amp; result.is_a?(CalculatorResponse)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="164">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        capacities = result.value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">        # Extract input parameters for backwards compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="166">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        length = param_to_float(:length)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="167">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        width = param_to_float(:width)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="168">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        max_user_height = param_to_float(:max_user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="169">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">        max_user_height = nil if max_user_height.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="170">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        negative_adjustment_area = param_to_float(:negative_adjustment_area)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">        json_result = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="173">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">          length: length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">          width: width,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="175">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">          area: (length * width).round(2),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">          negative_adjustment_area: negative_adjustment_area,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="177">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">          usable_area: [(length * width) - negative_adjustment_area, 0].max.round(2),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">          max_user_height: max_user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">          capacities: capacities,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">          breakdown: result.breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="183">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">        json_result = result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="186">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">        passed: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">        status: &quot;Calculation completed successfully&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">        result: json_result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="192">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">        passed: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">        status: error || &quot;Calculation failed with unknown error&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">        result: nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7dc66bd7a04d603b3e720273aca89df3e1b4e97e">
  <div class="header">
    <h3>app/controllers/search_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class SearchController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="5">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @federated_sites = Federation.sites(request.host, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="656c79c5b08d5575c21b6239bd3598310540c921">
  <div class="header">
    <h3>app/controllers/sessions_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>19</b> relevant lines.
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>3</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class SessionsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: [:new, :create, :destroy]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_logged_out, only: [:new, :create]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="580" data-linenumber="9">
            
              <span class="hits">580</span>
            

            
              
                <span class="hits" title="else branch hit 580 times">
                  else: 580
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    sleep(rand(0.5..1.0)) unless Rails.env.test?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="580" data-linenumber="11">
            
              <span class="hits">580</span>
            

            
              
            

            <code class="ruby">    email = params.dig(:session, :email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="580" data-linenumber="12">
            
              <span class="hits">580</span>
            

            
              
            

            <code class="ruby">    password = params.dig(:session, :password)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="580" data-linenumber="14">
            
              <span class="hits">580</span>
            

            
              
                <span class="hits" title="then branch hit 569 times">
                  then: 569
                </span>
              
            

            <code class="ruby">    if (user = authenticate_user(email, password))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="569" data-linenumber="15">
            
              <span class="hits">569</span>
            

            
              
            

            <code class="ruby">      should_remember = params.dig(:session, :remember_me) == &quot;1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="569" data-linenumber="16">
            
              <span class="hits">569</span>
            

            
              
            

            <code class="ruby">      create_user_session(user, should_remember)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="569" data-linenumber="17">
            
              <span class="hits">569</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;session.login.success&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="569" data-linenumber="18">
            
              <span class="hits">569</span>
            

            
              
            

            <code class="ruby">      redirect_to inspections_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="20">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      flash.now[:alert] = I18n.t(&quot;session.login.error&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="21">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="26">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    log_out</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="27">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;session.logout.success&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="28">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2083ad1713b691b7dbcb9d9a107f1601a588a450">
  <div class="header">
    <h3>app/controllers/slide_assessments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class SlideAssessmentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include SafetyStandardsTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3f27108b7b6a9e9b6994020d9dcfb4e3fa7c558a">
  <div class="header">
    <h3>app/controllers/structure_assessments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class StructureAssessmentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9671e77c7b1e5b8ec2468d9a384363dc64eb1a60">
  <div class="header">
    <h3>app/controllers/units_controller.rb</h3>
    <h4>
      <span class="green">
  97.92%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  94.74%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>144</b> relevant lines.
      <span class="green"><b>141</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>38</b> total branches, </span>
          <span class="green"><b>36</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class UnitsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include UnitTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include PublicViewable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include UserActivityCheck</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: %i[show]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :set_unit, only: %i[destroy edit log show update]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :check_unit_owner, only: %i[destroy edit update]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :check_log_access, only: %i[log]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_user_active, only: %i[create new edit update]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :no_index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="14">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    @units = filtered_units_query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="15">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    @title = build_index_title</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="17">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="18">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="19">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">      format.csv do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="20">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        log_unit_event(&quot;exported&quot;, nil, &quot;Exported #{@units.count} units to CSV&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="21">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        csv_data = UnitCsvExportService.new(@units).generate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        send_data csv_data, filename: &quot;units-#{Time.zone.today}.csv&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    # Handle federation HEAD requests</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="29">
            
              <span class="hits">118</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 117 times">
                  else: 117
                </span>
              
            

            <code class="ruby">    return head :ok if request.head?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="31">
            
              <span class="hits">117</span>
            

            
              
            

            <code class="ruby">    @inspections = @unit.inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      .includes(inspector_company: {logo_attachment: :blob})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      .order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="35">
            
              <span class="hits">117</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="192" data-linenumber="36">
            
              <span class="hits">192</span>
            

            
              
            

            <code class="ruby">      format.html { render_show_html }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="139" data-linenumber="37">
            
              <span class="hits">139</span>
            

            
              
            

            <code class="ruby">      format.pdf { send_unit_pdf }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="121" data-linenumber="38">
            
              <span class="hits">121</span>
            

            
              
            

            <code class="ruby">      format.png { send_unit_qr_code }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="39">
            
              <span class="hits">117</span>
            

            
              
            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="40">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">        render json: JsonSerializerService.serialize_unit(@unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="45">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def new = @unit = Unit.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="48">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    @unit = current_user.units.build(unit_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="50">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
            

            <code class="ruby">    if @unit.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="51">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      log_unit_event(&quot;created&quot;, @unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="52">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;units.messages.created&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="53">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      redirect_to @unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="55">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="59">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def edit = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    # Capture the changes before update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="63">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    previous_attributes = @unit.attributes.dup</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="65">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    if @unit.update(unit_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">      # Calculate what changed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="67">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      changed_data = calculate_changes(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">        previous_attributes,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">        @unit.attributes,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">        unit_params.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="73">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      log_unit_event(&quot;updated&quot;, @unit, nil, changed_data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="74">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="75">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="76">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          flash[:notice] = I18n.t(&quot;units.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="77">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          redirect_to @unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="79">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render_unit_update_success_stream }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="83">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="84">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            

            
              
            

            <code class="ruby">          render json: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">            status: I18n.t(&quot;shared.api.error&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">            errors: @unit.errors.full_messages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render_unit_update_error_stream }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="95">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    # Capture unit details before deletion for the audit log</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">    unit_details = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="98">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      name: @unit.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">      serial: @unit.serial,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      owner: @unit.owner,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      manufacturer: @unit.manufacturer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="104">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    if @unit.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">      # Log the deletion with the unit details in metadata</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="106">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      Event.log(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">        user: current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">        action: &quot;deleted&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">        resource: @unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">        details: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">        metadata: unit_details</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="113">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;units.messages.deleted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="114">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      redirect_to units_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      error_message =</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        @unit.errors.full_messages.first ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;units.messages.delete_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="119">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = error_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="120">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to @unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="124">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="125">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @events = Event.for_resource(@unit).recent.includes(:user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="126">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @title = I18n.t(&quot;units.titles.log&quot;, unit: @unit.name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="129">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def new_from_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="130">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @inspection = current_user.inspections.find_by(id: params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="132">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="133">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.errors.inspection_not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="134">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="137">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    if @inspection.unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.errors.inspection_has_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to inspection_path(@inspection) and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="142">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @unit = Unit.new(user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="145">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create_from_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="146">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    service = UnitCreationFromInspectionService.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">      user: current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">      inspection_id: params[:id],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">      unit_params: unit_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="152">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if service.create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="153">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      log_unit_event(&quot;created&quot;, service.unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="154">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;units.messages.created_from_inspection&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="155">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      redirect_to inspection_path(service.inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="156">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    elsif service.error_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="157">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = service.error_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="158">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      redirect_path = service.inspection ?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="159">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">        inspection_path(service.inspection) :</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="160">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        root_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="161">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to redirect_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="163">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @unit = service.unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="164">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @inspection = service.inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="165">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :new_from_inspection, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="169">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="171">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_unit_event(action, unit, details = nil, changed_data = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="16" data-linenumber="172">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="174">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
            

            <code class="ruby">    if unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="175">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      Event.log(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">        user: current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">        action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">        resource: unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">        details: details,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">        changed_data: changed_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      # For events without a specific unit (like CSV export)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="184">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      Event.log_system_event(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">        user: current_user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">        action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">        details: details,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">        metadata: {resource_type: &quot;Unit&quot;}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            

            
              
            

            <code class="ruby">    Rails.logger.error I18n.t(&quot;units.errors.log_failed&quot;, message: e.message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="195">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def calculate_changes(previous_attributes, current_attributes, changed_keys)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="196">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    changes = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="198">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    changed_keys.map(&amp;:to_s).each do |key|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="199">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      previous_value = previous_attributes[key]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="200">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      current_value = current_attributes[key]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="202">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 19 times">
                  else: 19
                </span>
              
            

            <code class="ruby">      if previous_value != current_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="203">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        changes[key] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">          &quot;from&quot; =&gt; previous_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">          &quot;to&quot; =&gt; current_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="210">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    changes.presence</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="213">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def unit_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="214">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    params.require(:unit).permit(*%i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">      description</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">      manufacture_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">      manufacturer</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">      model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">      name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">      owner</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">      photo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">      serial</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">      unit_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">    ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="227">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def no_index = response.set_header(&quot;X-Robots-Tag&quot;, &quot;noindex,nofollow&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="229">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="157" data-linenumber="230">
            
              <span class="hits">157</span>
            

            
              
            

            <code class="ruby">    @unit = Unit.includes(photo_attachment: :blob)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">      .find_by(id: params[:id].upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="157" data-linenumber="233">
            
              <span class="hits">157</span>
            

            
              
                <span class="hits" title="else branch hit 148 times">
                  else: 148
                </span>
              
            

            <code class="ruby">    unless @unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
            

            <code class="ruby">      # Always return 404 for non-existent resources regardless of login status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="235">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      head :not_found</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="239">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_unit_owner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="240">
            
              <span class="hits">28</span>
            

            
              
                <span class="hits" title="else branch hit 25 times">
                  else: 25
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    head :not_found unless owns_resource?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="243">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_log_access</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">    # Only unit owners can view logs</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="245">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    head :not_found unless owns_resource?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="248">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def send_unit_pdf</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">    # Unit already has photo loaded from set_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="250">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    pdf_data = PdfGeneratorService.generate_unit_report(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">      @unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">      debug_enabled: admin_debug_enabled?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">      debug_queries: debug_sql_queries</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="256">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    send_data pdf_data.render,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">      filename: &quot;#{@unit.serial}.pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">      type: &quot;application/pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">      disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="262">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def send_unit_qr_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="263">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    qr_code_png = QrCodeService.generate_qr_code(@unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="265">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    send_data qr_code_png,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">      filename: &quot;#{@unit.serial}_QR.png&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">      type: &quot;image/png&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">      disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">  # PublicViewable implementation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="272">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_resource_owner</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="273">
            

            
              
            

            <code class="ruby">    check_unit_owner</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="276">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def owns_resource?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="277">
            
              <span class="hits">98</span>
            

            
              
            

            <code class="ruby">    @unit &amp;&amp; current_user &amp;&amp; @unit.user_id == current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="280">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def pdf_filename</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="281">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    &quot;#{@unit.serial}.pdf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="284">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def resource_pdf_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="285">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    unit_path(@unit, format: :pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="288">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def filtered_units_query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="289">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    units = current_user.units.includes(photo_attachment: :blob)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="290">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    units = units.search(params[:query])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="291">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 59 times">
                  else: 59
                </span>
              
            

            <code class="ruby">    units = units.overdue if params[:status] == &quot;overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="292">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    units = units.by_manufacturer(params[:manufacturer])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="293">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    units = units.by_owner(params[:owner])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="294">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    units.order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="297">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_index_title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="298">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    title_parts = [I18n.t(&quot;units.titles.index&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="299">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 59 times">
                  else: 59
                </span>
              
            

            <code class="ruby">    if params[:status] == &quot;overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="300">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      title_parts &lt;&lt; I18n.t(&quot;units.status.overdue&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="302">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 55 times">
                  else: 55
                </span>
              
            

            <code class="ruby">    title_parts &lt;&lt; params[:manufacturer] if params[:manufacturer].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="303">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 57 times">
                  else: 57
                </span>
              
            

            <code class="ruby">    title_parts &lt;&lt; params[:owner] if params[:owner].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="304">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    title_parts.join(&quot; - &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="307">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_inactive_user_redirect</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="308">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    redirect_to units_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="265592e4d755f45e1cc0e91764718ddb0507b292">
  <div class="header">
    <h3>app/controllers/user_height_assessments_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class UserHeightAssessmentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include SafetyStandardsTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="aa86b037e97f78d488b879ecc5582540c62b0581">
  <div class="header">
    <h3>app/controllers/users_controller.rb</h3>
    <h4>
      <span class="green">
  93.91%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  85.71%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>115</b> relevant lines.
      <span class="green"><b>108</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>35</b> total branches, </span>
          <span class="green"><b>30</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class UsersController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include UserTurboStreams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  NON_ADMIN_PATHS = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    change_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    change_password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    update_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    update_password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  LOGGED_OUT_PATHS = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    create</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: LOGGED_OUT_PATHS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  skip_before_action :update_last_active_at, only: [:update_settings]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :set_user, except: %i[index new create]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_admin, except: NON_ADMIN_PATHS + LOGGED_OUT_PATHS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_action :require_correct_user, only: NON_ADMIN_PATHS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="23">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    @users = User.all</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="24">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    @inspection_counts = Inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      .where(user_id: @users.pluck(:id))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      .group(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      .count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="31">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    @user = User.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="34">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="35">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    @user = User.new(user_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="36">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
            

            <code class="ruby">    if @user.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="37">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">      if Rails.env.production?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        NtfyService.notify(&quot;new user: #{@user.email}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="41">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      log_in @user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="42">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;users.messages.account_created&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="43">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="52">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    # Convert empty string to nil for inspection_company_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="54">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">    if params[:user][:inspection_company_id] == &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="55">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      params[:user][:inspection_company_id] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="58">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 11 times">
                  then: 11
                </span>
              
            

            <code class="ruby">    if @user.update(user_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="59">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="60">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="61">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">          flash[:notice] = I18n.t(&quot;users.messages.user_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="62">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">          redirect_to users_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="64">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;form_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">                message: I18n.t(&quot;users.messages.user_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">              })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="76">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="77">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;form_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">                errors: @user.errors.full_messages,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">                message: t(&quot;shared.messages.save_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">              })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="91">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @user.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;users.messages.user_deleted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to users_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def change_password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="100">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="101">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if @user.authenticate(params[:user][:current_password])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="102">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      if @user.update(password_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        flash[:notice] = I18n.t(&quot;users.messages.password_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        render :change_password, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @user.errors.add(:current_password, I18n.t(&quot;users.errors.wrong_password&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="110">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :change_password, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="114">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def impersonate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">    # Store original admin user ID before impersonating</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="116">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    session[:original_admin_id] = current_user.id if current_user.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="117">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    log_in @user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="118">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;users.messages.impersonating&quot;, email: @user.email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="119">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="122">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def change_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="125">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_settings</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="126">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
            

            <code class="ruby">    if @user.update(settings_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="127">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="128">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">        format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="129">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">          flash[:notice] = I18n.t(&quot;users.messages.settings_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="130">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">          redirect_to change_settings_user_path(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="132">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render_user_update_success_stream }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="135">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="136">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        format.html { render :change_settings, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="137">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render_user_update_error_stream }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="142">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def verify_rpii</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="143">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    result = @user.verify_rpii_inspector_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="145">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="146">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="147">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">        if result[:valid]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="148">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">          flash[:notice] = I18n.t(&quot;users.messages.rpii_verified&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="150">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">          flash[:alert] = get_rpii_error_message(result)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="152">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        redirect_to edit_user_path(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="155">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            
              
            

            <code class="ruby">        render turbo_stream: turbo_stream.replace(&quot;rpii_verification_result&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">          partial: &quot;users/rpii_verification_result&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">          locals: {result: result, user: @user})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="163">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def add_seeds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="164">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @user.has_seed_data?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="165">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;users.messages.seeds_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="167">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      SeedDataService.add_seeds_for_user(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="168">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;users.messages.seeds_added&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="170">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    redirect_to edit_user_path(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="173">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def delete_seeds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="174">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    SeedDataService.delete_seeds_for_user(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="175">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;users.messages.seeds_deleted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="176">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    redirect_to edit_user_path(@user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="179">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="181">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def get_rpii_error_message(result)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="182">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    case result[:error]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="183">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when :blank_number</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            

            
              
            

            <code class="ruby">      I18n.t(&quot;users.messages.rpii_blank_number&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="185">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when :blank_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            

            
              
            

            <code class="ruby">      I18n.t(&quot;users.messages.rpii_blank_name&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when :name_mismatch</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="188">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      inspector = result[:inspector]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="189">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      I18n.t(&quot;users.messages.rpii_name_mismatch&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">        user_name: @user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">        inspector_name: inspector[:name])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when :not_found</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="193">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      I18n.t(&quot;users.messages.rpii_not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="194">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            

            
              
            

            <code class="ruby">      I18n.t(&quot;users.messages.rpii_verification_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="199">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="200">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">    @user = User.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="203">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def user_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="204">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
            

            <code class="ruby">    if current_user&amp;.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="205">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      admin_permitted_params = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">        active_until email inspection_company_id name password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">        password_confirmation rpii_inspector_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="209">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">      params.require(:user).permit(admin_permitted_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="210">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
            

            <code class="ruby">    elsif action_name == &quot;create&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="211">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      params.require(:user).permit(:email, :name, :rpii_inspector_number, :password, :password_confirmation)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="212">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="213">
            

            
              
            

            <code class="ruby">      params.require(:user).permit(:email, :password, :password_confirmation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="217">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def require_correct_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="218">
            
              <span class="hits">37</span>
            

            
              
                <span class="hits" title="else branch hit 34 times">
                  else: 34
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    unless current_user == @user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="219">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      action = action_name.include?(&quot;password&quot;) ? &quot;password&quot; : &quot;settings&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="220">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;users.messages.own_action_only&quot;, action: action)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="221">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="225">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def password_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="226">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    params.require(:user).permit(:password, :password_confirmation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="229">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def settings_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="230">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    settings_fields = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">      address country default_inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">      logo phone postal_code signature theme</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="234">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    params.require(:user).permit(settings_fields)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1b9a351aeb1617b0e942d9b70ceae781c2e6f475">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  98.84%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  94.74%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>86</b> relevant lines.
      <span class="green"><b>85</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>38</b> total branches, </span>
          <span class="green"><b>36</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include ActionView::Helpers::NumberHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 333 times">
                  then: 333
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">  def render_time(datetime) = datetime&amp;.strftime(&quot;%b %d, %Y&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">  def date_for_form(datetime) = datetime&amp;.to_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def scrollable_table(html_options = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="9">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    content_tag(:div, class: &quot;table-container&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="10">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      content_tag(:table, html_options, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ALLOWED_LOCAL_ASSIGNS = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    accept</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    min</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    number_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    required</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    rows</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def nav_link_to(name, path, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6668" data-linenumber="28">
            
              <span class="hits">6668</span>
            

            
              
                <span class="hits" title="then branch hit 1106 times">
                  then: 1106
                </span>
              
            

            <code class="ruby">    css_class = if current_page?(path) || controller_matches?(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1106" data-linenumber="29">
            
              <span class="hits">1106</span>
            

            
              
            

            <code class="ruby">      &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
                <span class="hits" title="else branch hit 5562 times">
                  else: 5562
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5562" data-linenumber="31">
            
              <span class="hits">5562</span>
            

            
              
            

            <code class="ruby">      &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6668" data-linenumber="33">
            
              <span class="hits">6668</span>
            

            
              
            

            <code class="ruby">    link_to name, path, options.merge(class: css_class)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def form_field_setup(field, local_assigns)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5079" data-linenumber="37">
            
              <span class="hits">5079</span>
            

            
              
            

            <code class="ruby">    validate_local_assigns(local_assigns)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5070" data-linenumber="38">
            
              <span class="hits">5070</span>
            

            
              
            

            <code class="ruby">    validate_form_context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5068" data-linenumber="40">
            
              <span class="hits">5068</span>
            

            
              
            

            <code class="ruby">    field_translations = build_field_translations(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="41">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">    value, prefilled = get_field_value_and_prefilled_status(@_current_form,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="44">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">    build_field_setup_result(field_translations, value, prefilled)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def get_field_value_and_prefilled_status(form_object, field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5963" data-linenumber="48">
            
              <span class="hits">5963</span>
            

            
              
                <span class="hits" title="then branch hit 5963 times">
                  then: 5963
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 4033 times">
                  else: 4033
                </span>
              
                <span class="hits" title="then branch hit 1930 times">
                  then: 1930
                </span>
              
            

            <code class="ruby">    return [nil, false] unless form_object&amp;.object</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4033" data-linenumber="49">
            
              <span class="hits">4033</span>
            

            
              
            

            <code class="ruby">    model = form_object.object</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4033" data-linenumber="50">
            
              <span class="hits">4033</span>
            

            
              
            

            <code class="ruby">    resolved = resolve_field_value(model, field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4033" data-linenumber="51">
            
              <span class="hits">4033</span>
            

            
              
            

            <code class="ruby">    [resolved[:value], resolved[:prefilled]]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_numeric_value(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3630" data-linenumber="55">
            
              <span class="hits">3630</span>
            

            
              
                <span class="hits" title="else branch hit 3577 times">
                  else: 3577
                </span>
              
            

            <code class="ruby">    if value.is_a?(String) &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">        value.match?(/\A-?\d*\.?\d+\z/) &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="57">
            
              <span class="hits">53</span>
            

            
              
                <span class="hits" title="then branch hit 53 times">
                  then: 53
                </span>
              
            

            <code class="ruby">        (float_value = Float(value, exception: false))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="58">
            
              <span class="hits">53</span>
            

            
              
            

            <code class="ruby">      value = float_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3630" data-linenumber="61">
            
              <span class="hits">3630</span>
            

            
              
                <span class="hits" title="else branch hit 343 times">
                  else: 343
                </span>
              
                <span class="hits" title="then branch hit 3287 times">
                  then: 3287
                </span>
              
            

            <code class="ruby">    return value unless value.is_a?(Numeric)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="343" data-linenumber="63">
            
              <span class="hits">343</span>
            

            
              
            

            <code class="ruby">    number_with_precision(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      precision: 4,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      strip_insignificant_zeros: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="72">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_local_assigns(local_assigns)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5079" data-linenumber="73">
            
              <span class="hits">5079</span>
            

            
              
            

            <code class="ruby">    locally_assigned_keys = (local_assigns || {}).keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5079" data-linenumber="74">
            
              <span class="hits">5079</span>
            

            
              
            

            <code class="ruby">    disallowed_keys = locally_assigned_keys - ALLOWED_LOCAL_ASSIGNS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5079" data-linenumber="76">
            
              <span class="hits">5079</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 5070 times">
                  else: 5070
                </span>
              
            

            <code class="ruby">    if disallowed_keys.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="77">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      raise ArgumentError, &quot;local_assigns contains #{disallowed_keys.inspect}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="81">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_form_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5070" data-linenumber="82">
            
              <span class="hits">5070</span>
            

            
              
                <span class="hits" title="else branch hit 5069 times">
                  else: 5069
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    raise ArgumentError, &quot;missing i18n_base&quot; unless @_current_i18n_base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5069" data-linenumber="83">
            
              <span class="hits">5069</span>
            

            
              
                <span class="hits" title="else branch hit 5068 times">
                  else: 5068
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    raise ArgumentError, &quot;missing form_object&quot; unless @_current_form</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="86">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_field_translations(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5068" data-linenumber="87">
            
              <span class="hits">5068</span>
            

            
              
            

            <code class="ruby">    fields_key = &quot;#{@_current_i18n_base}.fields.#{field}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5068" data-linenumber="88">
            
              <span class="hits">5068</span>
            

            
              
            

            <code class="ruby">    field_label = t(fields_key, raise: true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="90">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">    base_parts = @_current_i18n_base.split(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="91">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">    root = base_parts[0..-2]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="92">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">    hint_key = (root + [&quot;hints&quot;, field]).join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="93">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">    placeholder_key = (root + [&quot;placeholders&quot;, field]).join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="96">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">      field_label:,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      field_hint: t(hint_key, default: nil),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      field_placeholder: t(placeholder_key, default: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="102">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_field_setup_result(field_translations, value, prefilled)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5067" data-linenumber="104">
            
              <span class="hits">5067</span>
            

            
              
            

            <code class="ruby">      form_object: @_current_form,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      i18n_base: @_current_i18n_base,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      value:,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      prefilled:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">    }.merge(field_translations)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="111">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def resolve_field_value(model, field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4033" data-linenumber="112">
            
              <span class="hits">4033</span>
            

            
              
            

            <code class="ruby">    field_str = field.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4033" data-linenumber="113">
            
              <span class="hits">4033</span>
            

            
              
                <span class="hits" title="then branch hit 166 times">
                  then: 166
                </span>
              
                <span class="hits" title="else branch hit 3867 times">
                  else: 3867
                </span>
              
            

            <code class="ruby">    if field_str.include?(&quot;password&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="114">
            
              <span class="hits">166</span>
            

            
              
            

            <code class="ruby">      return {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">        value: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">        prefilled: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3867" data-linenumber="120">
            
              <span class="hits">3867</span>
            

            
              
                <span class="hits" title="then branch hit 3828 times">
                  then: 3828
                </span>
              
                <span class="hits" title="else branch hit 39 times">
                  else: 39
                </span>
              
            

            <code class="ruby">    actual_current_value = model.send(field) if model.respond_to?(field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    # Check if this field should be excluded from prefilling</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">    # Use the same exclusion list as the controller</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3867" data-linenumber="124">
            
              <span class="hits">3867</span>
            

            
              
                <span class="hits" title="then branch hit 266 times">
                  then: 266
                </span>
              
                <span class="hits" title="else branch hit 3601 times">
                  else: 3601
                </span>
              
            

            <code class="ruby">    if InspectionsController::NOT_COPIED_FIELDS.include?(field_str)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      return {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="266" data-linenumber="126">
            
              <span class="hits">266</span>
            

            
              
            

            <code class="ruby">        value: actual_current_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">        prefilled: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3601" data-linenumber="131">
            
              <span class="hits">3601</span>
            

            
              
            

            <code class="ruby">    previous_value = extract_previous_value(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      @previous_inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      model,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3601" data-linenumber="137">
            
              <span class="hits">3601</span>
            

            
              
                <span class="hits" title="then branch hit 193 times">
                  then: 193
                </span>
              
            

            <code class="ruby">    if actual_current_value.nil? &amp;&amp; !previous_value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="193" data-linenumber="139">
            
              <span class="hits">193</span>
            

            
              
            

            <code class="ruby">        value: format_numeric_value(previous_value),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">        prefilled: !previous_value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
                <span class="hits" title="else branch hit 3408 times">
                  else: 3408
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3408" data-linenumber="144">
            
              <span class="hits">3408</span>
            

            
              
            

            <code class="ruby">        value: format_numeric_value(actual_current_value),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">        prefilled: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="150">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def extract_previous_value(previous_inspection, current_model, field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3601" data-linenumber="151">
            
              <span class="hits">3601</span>
            

            
              
                <span class="hits" title="then branch hit 3285 times">
                  then: 3285
                </span>
              
            

            <code class="ruby">    if !previous_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3285" data-linenumber="152">
            
              <span class="hits">3285</span>
            

            
              
                <span class="hits" title="else branch hit 316 times">
                  else: 316
                </span>
              
            

            <code class="ruby">      nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="316" data-linenumber="153">
            
              <span class="hits">316</span>
            

            
              
                <span class="hits" title="then branch hit 181 times">
                  then: 181
                </span>
              
            

            <code class="ruby">    elsif current_model.class.name.include?(&quot;Assessment&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="154">
            
              <span class="hits">181</span>
            

            
              
            

            <code class="ruby">      assessment_type = current_model.class.name.demodulize.underscore</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="155">
            
              <span class="hits">181</span>
            

            
              
            

            <code class="ruby">      previous_model = previous_inspection.send(assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="181" data-linenumber="156">
            
              <span class="hits">181</span>
            

            
              
                <span class="hits" title="then branch hit 181 times">
                  then: 181
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      previous_model&amp;.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
                <span class="hits" title="else branch hit 135 times">
                  else: 135
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="135" data-linenumber="158">
            
              <span class="hits">135</span>
            

            
              
            

            <code class="ruby">      previous_inspection.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="162">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def comment_field_options(form, comment_field, base_field_label)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="163">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">    model = form.object</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">    comment_value, comment_prefilled =</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="165">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">      get_field_value_and_prefilled_status(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">        form,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">        comment_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="170">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">    has_comment = comment_value.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="172">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">    base_field = comment_field.to_s.chomp(&quot;_comment&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="174">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">    placeholder_text = t(&quot;shared.field_comment_placeholder&quot;, field: base_field_label)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="175">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">    textarea_id = &quot;#{base_field}_comment_textarea_#{model.object_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="176">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">    checkbox_id = &quot;#{base_field}_has_comment_#{model.object_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="177">
            
              <span class="hits">800</span>
            

            
              
                <span class="hits" title="then branch hit 27 times">
                  then: 27
                </span>
              
                <span class="hits" title="else branch hit 773 times">
                  else: 773
                </span>
              
            

            <code class="ruby">    display_style = has_comment ? &quot;block&quot; : &quot;none&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="800" data-linenumber="180">
            
              <span class="hits">800</span>
            

            
              
            

            <code class="ruby">      options: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">        rows: 2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">        placeholder: placeholder_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">        id: textarea_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">        style: &quot;display: #{display_style};&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">        value: comment_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">      prefilled: comment_prefilled,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">      has_comment: has_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">      checkbox_id: checkbox_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="193">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def radio_button_options(prefilled, checked_value, expected_value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1412" data-linenumber="194">
            
              <span class="hits">1412</span>
            

            
              
                <span class="hits" title="then branch hit 68 times">
                  then: 68
                </span>
              
                <span class="hits" title="else branch hit 1344 times">
                  else: 1344
                </span>
              
            

            <code class="ruby">    (prefilled &amp;&amp; checked_value == expected_value) ? {checked: true} : {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="197">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="199">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def controller_matches?(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6154" data-linenumber="200">
            
              <span class="hits">6154</span>
            

            
              
            

            <code class="ruby">    route = Rails.application.routes.recognize_path(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6154" data-linenumber="201">
            
              <span class="hits">6154</span>
            

            
              
            

            <code class="ruby">    path_controller = route[:controller]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6154" data-linenumber="202">
            
              <span class="hits">6154</span>
            

            
              
            

            <code class="ruby">    controller_name == path_controller</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">  rescue ActionController::RoutingError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5ede36d5faa42f454c3658fd9a193293123438ec">
  <div class="header">
    <h3>app/helpers/inspections_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  84.62%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>32</b> relevant lines.
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>13</b> total branches, </span>
          <span class="green"><b>11</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module InspectionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_inspection_count(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    count = user.inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    t(&quot;inspections.count&quot;, count: count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_result_badge(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="235" data-linenumber="8">
            
              <span class="hits">235</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    case inspection.passed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
                <span class="hits" title="when branch hit 166 times">
                  when: 166
                </span>
              
            

            <code class="ruby">    when true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="10">
            
              <span class="hits">166</span>
            

            
              
            

            <code class="ruby">      content_tag(:span, t(&quot;inspections.status.pass&quot;), class: &quot;pass-badge&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
                <span class="hits" title="when branch hit 20 times">
                  when: 20
                </span>
              
            

            <code class="ruby">    when false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="12">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      content_tag(:span, t(&quot;inspections.status.fail&quot;), class: &quot;fail-badge&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
                <span class="hits" title="when branch hit 49 times">
                  when: 49
                </span>
              
            

            <code class="ruby">    when nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="14">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">      content_tag(:span, t(&quot;inspections.status.pending&quot;), class: &quot;pending-badge&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_actions(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="19">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    actions = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="21">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    if inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
                <span class="hits" title="then branch hit 38 times">
                  then: 38
                </span>
              
            

            <code class="ruby">      # Complete inspections: Switch to In Progress / Log</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="23">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        label: t(&quot;inspections.buttons.switch_to_in_progress&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        url: mark_draft_inspection_path(inspection),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        method: :patch,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        confirm: t(&quot;inspections.messages.mark_in_progress_confirm&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        button: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="30">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        label: t(&quot;inspections.buttons.log&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        url: log_inspection_path(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
                <span class="hits" title="else branch hit 64 times">
                  else: 64
                </span>
              
            

            <code class="ruby">      # Incomplete inspections: Update Inspection / Log / Delete Inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="36">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        label: t(&quot;inspections.buttons.update&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        url: edit_inspection_path(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="40">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        label: t(&quot;inspections.buttons.log&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        url: log_inspection_path(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="44">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        label: t(&quot;inspections.buttons.delete&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">        url: inspection_path(inspection),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">        method: :delete,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        confirm: t(&quot;inspections.messages.delete_confirm&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">        danger: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="53">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  # Tabbed inspection editing helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_tabs(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="244" data-linenumber="58">
            
              <span class="hits">244</span>
            

            
              
            

            <code class="ruby">    inspection.applicable_tabs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1747" data-linenumber="62">
            
              <span class="hits">1747</span>
            

            
              
            

            <code class="ruby">    params[:tab].presence || &quot;inspection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_complete?(inspection, tab)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1509" data-linenumber="66">
            
              <span class="hits">1509</span>
            

            
              
            

            <code class="ruby">    case tab</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    when &quot;inspection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
                <span class="hits" title="when branch hit 184 times">
                  when: 184
                </span>
              
            

            <code class="ruby">      # For the main inspection tab, check if required fields are filled (excluding passed)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="184" data-linenumber="69">
            
              <span class="hits">184</span>
            

            
              
            

            <code class="ruby">      inspection.inspection_tab_incomplete_fields.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    when &quot;results&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
                <span class="hits" title="when branch hit 184 times">
                  when: 184
                </span>
              
            

            <code class="ruby">      # For results tab, check if passed field is filled (risk_assessment is optional)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="184" data-linenumber="72">
            
              <span class="hits">184</span>
            

            
              
            

            <code class="ruby">      inspection.passed.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
                <span class="hits" title="else branch hit 1141 times">
                  else: 1141
                </span>
              
            

            <code class="ruby">      # For assessment tabs, check the corresponding assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1141" data-linenumber="75">
            
              <span class="hits">1141</span>
            

            
              
            

            <code class="ruby">      assessment_method = &quot;#{tab}_assessment&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1141" data-linenumber="76">
            
              <span class="hits">1141</span>
            

            
              
            

            <code class="ruby">      assessment = inspection.public_send(assessment_method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1141" data-linenumber="77">
            
              <span class="hits">1141</span>
            

            
              
                <span class="hits" title="then branch hit 1141 times">
                  then: 1141
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      assessment&amp;.complete? || false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="81">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def tab_name_with_check(inspection, tab)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1509" data-linenumber="82">
            
              <span class="hits">1509</span>
            

            
              
            

            <code class="ruby">    name = t(&quot;forms.#{tab}.header&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1509" data-linenumber="83">
            
              <span class="hits">1509</span>
            

            
              
                <span class="hits" title="then branch hit 430 times">
                  then: 430
                </span>
              
                <span class="hits" title="else branch hit 1079 times">
                  else: 1079
                </span>
              
            

            <code class="ruby">    assessment_complete?(inspection, tab) ? &quot;#{name} &quot; : name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c95b2e04a94cf2e4786f102e5b1bc533fa523c5c">
  <div class="header">
    <h3>app/helpers/sessions_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>29</b> relevant lines.
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SessionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_in(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="584" data-linenumber="3">
            
              <span class="hits">584</span>
            

            
              
            

            <code class="ruby">    session[:user_id] = user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def remember_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="7">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="8">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      cookies.permanent.signed[:user_id] = current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def forget_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="13">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">    cookies.delete(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29486" data-linenumber="17">
            
              <span class="hits">29486</span>
            

            
              
                <span class="hits" title="then branch hit 22236 times">
                  then: 22236
                </span>
              
            

            <code class="ruby">    if session[:user_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22236" data-linenumber="18">
            
              <span class="hits">22236</span>
            

            
              
                <span class="hits" title="else branch hit 7250 times">
                  else: 7250
                </span>
              
            

            <code class="ruby">      @current_user ||= User.find_by(id: session[:user_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7250" data-linenumber="19">
            
              <span class="hits">7250</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 7246 times">
                  else: 7246
                </span>
              
            

            <code class="ruby">    elsif cookies.signed[:user_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="20">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      user = User.find_by(id: cookies.signed[:user_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="21">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">      return unless user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      log_in user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @current_user = user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def logged_in?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2445" data-linenumber="28">
            
              <span class="hits">2445</span>
            

            
              
            

            <code class="ruby">    !current_user.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_out</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="32">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">    session.delete(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="33">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">    session.delete(:original_admin_id)  # Clear impersonation tracking</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="34">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">    forget_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="35">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">    @current_user = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def authenticate_user(email, password)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="580" data-linenumber="39">
            
              <span class="hits">580</span>
            

            
              
                <span class="hits" title="else branch hit 574 times">
                  else: 574
                </span>
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    return nil unless email.present? &amp;&amp; password.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="574" data-linenumber="40">
            
              <span class="hits">574</span>
            

            
              
                <span class="hits" title="then branch hit 572 times">
                  then: 572
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    User.find_by(email: email.downcase)&amp;.authenticate(password)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create_user_session(user, should_remember = false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="569" data-linenumber="44">
            
              <span class="hits">569</span>
            

            
              
            

            <code class="ruby">    log_in user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="569" data-linenumber="45">
            
              <span class="hits">569</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 566 times">
                  else: 566
                </span>
              
            

            <code class="ruby">    remember_user if should_remember</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4d672f89ddff41c8f22f9133fb8783500299a92b">
  <div class="header">
    <h3>app/helpers/units_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module UnitsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def manufacturer_options(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="3">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    user.units.distinct.pluck(:manufacturer).compact.compact_blank.sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def owner_options(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="7">
            
              <span class="hits">154</span>
            

            
              
            

            <code class="ruby">    user.units.distinct.pluck(:owner).compact.compact_blank.sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def unit_actions(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    actions = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95" data-linenumber="13">
            
              <span class="hits">95</span>
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;units.buttons.view&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        url: unit_path(unit, anchor: &quot;inspections&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;ui.edit&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        url: edit_unit_path(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;units.buttons.pdf_report&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        url: unit_path(unit, format: :pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    # Add activity log link for admins and unit owners</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95" data-linenumber="27">
            
              <span class="hits">95</span>
            

            
              
                <span class="hits" title="then branch hit 80 times">
                  then: 80
                </span>
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
            

            <code class="ruby">    if current_user &amp;&amp; (current_user.admin? || unit.user_id == current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="80" data-linenumber="28">
            
              <span class="hits">80</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;units.links.view_log&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        url: log_unit_path(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95" data-linenumber="34">
            
              <span class="hits">95</span>
            

            
              
                <span class="hits" title="then branch hit 81 times">
                  then: 81
                </span>
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    if unit.deletable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="81" data-linenumber="35">
            
              <span class="hits">81</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;units.buttons.delete&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        url: unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        method: :delete,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">        danger: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">        confirm: I18n.t(&quot;units.messages.delete_confirm&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95" data-linenumber="44">
            
              <span class="hits">95</span>
            

            
              
            

            <code class="ruby">    actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      label: I18n.t(&quot;units.buttons.add_inspection&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      url: inspections_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      method: :post,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      params: {unit_id: unit.id},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      confirm: I18n.t(&quot;units.messages.add_inspection_confirm&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95" data-linenumber="52">
            
              <span class="hits">95</span>
            

            
              
            

            <code class="ruby">    actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="604ab6d410566363484398c4f11f25c4c5184f48">
  <div class="header">
    <h3>app/helpers/users_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module UsersHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def admin_status(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    user.admin? ? &quot;Yes&quot; : &quot;No&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_count(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="7">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    count = user.inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="8">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    &quot;#{count} #{(count == 1) ? &quot;inspection&quot; : &quot;inspections&quot;}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_job_time(time)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="12">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return &quot;Never&quot; unless time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    &quot;#{time_ago_in_words(time)} ago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="997c8bcf69ded09410b7263fec479df7455f7422">
  <div class="header">
    <h3>app/models/application_record.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class ApplicationRecord &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  primary_abstract_class</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4e20a5128cd952646a71ca878b943dbe1f2ece3f">
  <div class="header">
    <h3>app/models/assessments/anchorage_assessment.rb</h3>
    <h4>
      <span class="green">
  95.24%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  66.67%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>21</b> relevant lines.
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Assessments::AnchorageAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.primary_key = &quot;inspection_id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :num_high_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    :num_low_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0, only_integer: true},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meets_anchor_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    unless total_anchors &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        inspection.width &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        inspection.height &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="19">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        inspection.length</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">      return false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    total_anchors &gt;= anchorage_result.value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def total_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="27">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    (num_low_anchors || 0) + (num_high_anchors || 0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchorage_result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="31">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @anchor_result ||= SafetyStandards::AnchorCalculator.calculate(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      length: inspection.length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      width: inspection.width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      height: inspection.height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def required_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="39">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    return 0 if inspection.volume.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="40">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    anchorage_result.value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchorage_breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="44">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return [] unless inspection.volume</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    anchorage_result.breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8cbca11b5b0e2f37f59374d1311b10cd8558e8a0">
  <div class="header">
    <h3>app/models/assessments/enclosed_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Assessments::EnclosedAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.primary_key = &quot;inspection_id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :exit_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    numericality: {greater_than: 0},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e00557590cfd6ee8d101f4c1c3ed0717bae05418">
  <div class="header">
    <h3>app/models/assessments/fan_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Assessments::FanAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.primary_key = &quot;inspection_id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f268cf6c73c33f232e9d716926a8416df354ae1c">
  <div class="header">
    <h3>app/models/assessments/materials_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Assessments::MaterialsAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.primary_key = &quot;inspection_id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  enum :ropes_pass, Inspection::PASS_FAIL_NA</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :ropes,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def ropes_compliant? = SafetyStandards::MaterialValidator.valid_rope_diameter?(ropes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="812275a1016ba54b81d7a19600d8465cea341e1d">
  <div class="header">
    <h3>app/models/assessments/slide_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  57.14%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>23</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>8</b> branches covered</span> and
          <span class="red"><b>6</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Assessments::SlideAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.primary_key = &quot;inspection_id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  enum :clamber_netting_pass, Inspection::PASS_FAIL_NA</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :slide_platform_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    :slide_wall_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    :runout,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    :slide_first_metre_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    :slide_beyond_first_metre_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meets_runout_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="20">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless runout.present? &amp;&amp; slide_platform_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="21">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    SafetyStandards::SlideCalculator.meets_runout_requirements?(runout, slide_platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def required_runout_length</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return nil if slide_platform_height.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    SafetyStandards::SlideCalculator.calculate_runout_value(slide_platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="29">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def runout_compliance_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="30">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    return I18n.t(&quot;forms.slide.compliance.not_assessed&quot;) if runout.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="31">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if meets_runout_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="32">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      I18n.t(&quot;forms.slide.compliance.compliant&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      I18n.t(&quot;forms.slide.compliance.non_compliant&quot;, required: required_runout_length)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meets_wall_height_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="39">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless slide_platform_height.present? &amp;&amp; slide_wall_height.present? &amp;&amp; !slide_permanent_roof.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    # Get user height from the inspection&#39;s user height assessment</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="42">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    user_height = inspection.user_height_assessment?&amp;.tallest_user_height</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="43">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    return false if user_height.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    SafetyStandards::SlideCalculator.meets_height_requirements?(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      slide_platform_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      slide_wall_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      slide_permanent_roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6c0a63263f96a6f354f4051351eef27eb5a5001d">
  <div class="header">
    <h3>app/models/assessments/structure_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Assessments::StructureAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.primary_key = &quot;inspection_id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :stitch_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    :unit_pressure,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    :blower_tube_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    :step_ramp_size,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    :critical_fall_off_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    :trough_depth,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    :trough_adjacent_panel_width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def stitch_length_compliant? =</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    SafetyStandards::MaterialValidator.valid_stitch_length?(stitch_length)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4d79c73b76e4dd8bb0718532ea353520b5477d14">
  <div class="header">
    <h3>app/models/assessments/user_height_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  60.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>19</b> relevant lines.
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>10</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Assessments::UserHeightAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.primary_key = &quot;inspection_id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :containing_wall_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    :platform_height, :tallest_user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :users_at_1000mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    :users_at_1200mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    :users_at_1500mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    :users_at_1800mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0, only_integer: true}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :play_area_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    :play_area_width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    :negative_adjustment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meets_height_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="29">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless platform_height.present? &amp;&amp; tallest_user_height.present? &amp;&amp; containing_wall_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="31">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    permanent_roof = permanent_roof_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="32">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    return false if permanent_roof.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="34">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    SafetyStandards::SlideCalculator.meets_height_requirements?(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      platform_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      tallest_user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      containing_wall_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      permanent_roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="44">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def permanent_roof_status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    # Permanent roof only matters for platforms 3.0m and above</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="46">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return false if platform_height &lt; 3.0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    # For platforms 3.0m+, check slide assessment if inspection has a slide</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="49">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless inspection.has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="51">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    inspection.slide_assessment?&amp;.slide_permanent_roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="50f5e4ae6c4a83ee17ba708e713beac17353d8d7">
  <div class="header">
    <h3>app/models/calculator_response.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>6</b> relevant lines.
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">CalculatorResponse = Data.define(:value, :value_suffix, :breakdown) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def initialize(value:, value_suffix: &quot;&quot;, breakdown: [])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="349" data-linenumber="3">
            
              <span class="hits">349</span>
            

            
              
            

            <code class="ruby">    super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def to_h</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="8">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      value: value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      value_suffix: value_suffix,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      breakdown: breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  alias_method :as_json, :to_h</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="359cf64369a56324806d8087667b97fb771ba23d">
  <div class="header">
    <h3>app/models/concerns/assessment_completion.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>10</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module AssessmentCompletion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  SYSTEM_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    inspection_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    created_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2196" data-linenumber="12">
            
              <span class="hits">2196</span>
            

            
              
            

            <code class="ruby">    incomplete_fields.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def incomplete_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4805" data-linenumber="16">
            
              <span class="hits">4805</span>
            

            
              
            

            <code class="ruby">    (attributes.keys - SYSTEM_FIELDS)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95262" data-linenumber="17">
            
              <span class="hits">95262</span>
            

            
              
            

            <code class="ruby">      .select { |f| !f.end_with?(&quot;_comment&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50058" data-linenumber="18">
            
              <span class="hits">50058</span>
            

            
              
            

            <code class="ruby">      .select { |f| send(f).nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31041" data-linenumber="19">
            
              <span class="hits">31041</span>
            

            
              
            

            <code class="ruby">      .map { |f| f.to_sym }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0b46a31d2cea501a6daca42dfb893d46062d31b0">
  <div class="header">
    <h3>app/models/concerns/assessment_logging.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>8</b> relevant lines.
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module AssessmentLogging</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  included do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="5">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_assessment_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6589" data-linenumber="11">
            
              <span class="hits">6589</span>
            

            
              
            

            <code class="ruby">    assessment_type = self.class.name.underscore.humanize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6589" data-linenumber="12">
            
              <span class="hits">6589</span>
            

            
              
            

            <code class="ruby">    inspection.log_audit_action(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      &quot;assessment_updated&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      inspection.user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      &quot;#{assessment_type} updated&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fadd7321bf3d3f109f9961e4749b219a5ca071cc">
  <div class="header">
    <h3>app/models/concerns/custom_id_generator.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>15</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Standard ID length for all models using CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ID_LENGTH = 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  included do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="8">
            
              <span class="hits">78</span>
            

            
              
            

            <code class="ruby">    self.primary_key = &quot;id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5365" data-linenumber="9">
            
              <span class="hits">5365</span>
            

            
              
            

            <code class="ruby">    before_create :generate_custom_id, if: -&gt; { id.blank? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class_methods do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def generate_random_id(scope_conditions = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6664" data-linenumber="14">
            
              <span class="hits">6664</span>
            

            
              
            

            <code class="ruby">      loop do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6665" data-linenumber="15">
            
              <span class="hits">6665</span>
            

            
              
            

            <code class="ruby">        id = SecureRandom.alphanumeric(CustomIdGenerator::ID_LENGTH).upcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6665" data-linenumber="16">
            
              <span class="hits">6665</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 6664 times">
                  then: 6664
                </span>
              
            

            <code class="ruby">        break id unless exists?({id: id}.merge(scope_conditions))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def generate_custom_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6660" data-linenumber="24">
            
              <span class="hits">6660</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 6659 times">
                  else: 6659
                </span>
              
            

            <code class="ruby">    scope_conditions = respond_to?(:uniqueness_scope) ? uniqueness_scope : {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6660" data-linenumber="25">
            
              <span class="hits">6660</span>
            

            
              
            

            <code class="ruby">    self.id = self.class.generate_random_id(scope_conditions)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="92d6f40602eefd92bbad50dab828c3f09bdc4c50">
  <div class="header">
    <h3>app/models/concerns/public_field_filtering.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Shared concern for defining which fields should be excluded from public output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"># Used by both PDF generation and JSON serialization to ensure consistency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module PublicFieldFiltering</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # System/metadata fields to exclude from public outputs (shared)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  EXCLUDED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    created_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    pdf_last_accessed_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    user_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    unit_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    inspector_company_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    inspection_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    is_seed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    unique_report_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  # Additional fields to exclude from PDFs specifically</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  PDF_EXCLUDED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    complete_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    inspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  # Fields excluded from PDFs (combines shared + PDF-specific)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  PDF_TOTAL_EXCLUDED_FIELDS = (EXCLUDED_FIELDS + PDF_EXCLUDED_FIELDS).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  # Computed fields to exclude from public outputs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  EXCLUDED_COMPUTED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    reinspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class_methods do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def public_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="37">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      column_names - EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def excluded_fields_for_assessment(klass_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="41">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f0efad46d7eb33d4a088463c237a17c4eb67e5aa">
  <div class="header">
    <h3>app/models/event.rb</h3>
    <h4>
      <span class="green">
  92.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  50.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>25</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>1</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Event &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :resource, polymorphic: true, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :action, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :resource_type, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :resource_id, presence: true,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6712" data-linenumber="8">
            
              <span class="hits">6712</span>
            

            
              
            

            <code class="ruby">    unless: -&gt; { resource_type == &quot;System&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # Scopes for common queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="11">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :for_user, -&gt;(user) { where(user: user) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="13">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">  scope :for_resource, -&gt;(resource) { where(resource: resource) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :by_action, -&gt;(action) { where(action: action) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :today, -&gt; { where(created_at: Date.current.all_day) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :this_week, -&gt; { where(created_at: Date.current.all_week) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  # Helper to create events easily</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.log(user:, action:, resource:, details: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    changed_data: nil, metadata: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6697" data-linenumber="21">
            
              <span class="hits">6697</span>
            

            
              
            

            <code class="ruby">    create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      user: user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      resource_type: resource.class.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      resource_id: resource.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      details: details,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      changed_data: changed_data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      metadata: metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  # Helper for system events that don&#39;t have a specific resource</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.log_system_event(user:, action:, details:, metadata: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="34">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      user: user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      resource_type: &quot;System&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      resource_id: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      details: details,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      metadata: metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  # Formatted description for display</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="45">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def description</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">    details || &quot;#{user.email} #{action} #{resource_type} #{resource_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  # Check if the event was triggered by a specific user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def triggered_by?(check_user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">    user == check_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  # Get the resource object if it still exists</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="55">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def resource_object</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="56">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless resource_type &amp;&amp; resource_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    resource_type.constantize.find_by(id: resource_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  rescue NameError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b82cf78cdf6132273a3c14439d06b087bd7cc856">
  <div class="header">
    <h3>app/models/inspection.rb</h3>
    <h4>
      <span class="green">
  91.58%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  72.37%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>190</b> relevant lines.
      <span class="green"><b>174</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>76</b> total branches, </span>
          <span class="green"><b>55</b> branches covered</span> and
          <span class="red"><b>21</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Inspection &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  PASS_FAIL_NA = {fail: 0, pass: 1, na: 2}.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  enum :inspection_type, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    bouncy_castle: &quot;BOUNCY_CASTLE&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    bouncing_pillow: &quot;BOUNCING_PILLOW&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  CASTLE_ASSESSMENT_TYPES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    user_height_assessment: Assessments::UserHeightAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    slide_assessment: Assessments::SlideAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    structure_assessment: Assessments::StructureAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    anchorage_assessment: Assessments::AnchorageAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    materials_assessment: Assessments::MaterialsAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    enclosed_assessment: Assessments::EnclosedAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    fan_assessment: Assessments::FanAssessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  PILLOW_ASSESSMENT_TYPES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    fan_assessment: Assessments::FanAssessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  ALL_ASSESSMENT_TYPES =</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    CASTLE_ASSESSMENT_TYPES.merge(PILLOW_ASSESSMENT_TYPES).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  USER_EDITABLE_PARAMS = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    has_slide</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    indoor_only</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    inspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    is_totally_enclosed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    passed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    risk_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    unique_report_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    unit_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    width</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  REQUIRED_TO_COMPLETE_FIELDS =</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="44">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    USER_EDITABLE_PARAMS - %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      risk_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      unique_report_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :unit, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="51">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspector_company, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ALL_ASSESSMENT_TYPES.each do |assessment_name, assessment_class|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="54">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    has_one assessment_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      class_name: assessment_class.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="59">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  alias_method :tallest_user_height_assessment, :user_height_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  # Accept nested attributes for all assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="62">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  accepts_nested_attributes_for(*ALL_ASSESSMENT_TYPES.keys)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  # Override assessment getters to auto-create if missing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ALL_ASSESSMENT_TYPES.each do |assessment_name, assessment_class|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    # Auto-create version</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="67">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    define_method(assessment_name) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17537" data-linenumber="68">
            
              <span class="hits">17537</span>
            

            
              
            

            <code class="ruby">      super() || assessment_class.find_or_create_by!(inspection: self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">    # Non-creating version for safe navigation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="119" data-linenumber="72">
            
              <span class="hits">119</span>
            

            
              
            

            <code class="ruby">    define_method(&quot;#{assessment_name}?&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="73">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">      association(assessment_name).loaded? ? send(assessment_name) :</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="74">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        assessment_class.find_by(inspection: self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="78">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_location, presence: true, if: :complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="79">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_date, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  # rubocop:disable Rails/UniqueValidationWithoutIndex</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="81">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :unique_report_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    uniqueness: {scope: :user_id, allow_blank: true}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  # rubocop:enable Rails/UniqueValidationWithoutIndex</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="86">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_validation :set_inspector_company_from_user, on: :create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="87">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_validation :set_inspection_type_from_unit, on: :create</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="90">
            
              <span class="hits">92</span>
            

            
              
            

            <code class="ruby">  scope :seed_data, -&gt; { where(is_seed: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="91">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">  scope :non_seed_data, -&gt; { where(is_seed: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="92">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">  scope :passed, -&gt; { where(passed: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="93">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">  scope :failed, -&gt; { where(passed: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="615" data-linenumber="94">
            
              <span class="hits">615</span>
            

            
              
            

            <code class="ruby">  scope :complete, -&gt; { where.not(complete_date: nil) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="95">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">  scope :draft, -&gt; { where(complete_date: nil) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="96">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :search, -&gt;(query) {</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="424" data-linenumber="97">
            
              <span class="hits">424</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            

            
              
            

            <code class="ruby">      joins(&quot;LEFT JOIN units ON units.id = inspections.unit_id&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">        .where(search_conditions, *search_values(query))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
                <span class="hits" title="else branch hit 424 times">
                  else: 424
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="101">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">      all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="104">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :filter_by_result, -&gt;(result) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="430" data-linenumber="105">
            
              <span class="hits">430</span>
            

            
              
                <span class="hits" title="when branch hit 10 times">
                  when: 10
                </span>
              
                <span class="hits" title="else branch hit 416 times">
                  else: 416
                </span>
              
            

            <code class="ruby">    case result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="106">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;passed&quot; then where(passed: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="107">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    when &quot;failed&quot; then where(passed: false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="110">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :filter_by_unit, -&gt;(unit_id) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="427" data-linenumber="111">
            
              <span class="hits">427</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 424 times">
                  else: 424
                </span>
              
            

            <code class="ruby">    where(unit_id: unit_id) if unit_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="113">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :filter_by_owner, -&gt;(owner) {</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="424" data-linenumber="114">
            
              <span class="hits">424</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if owner.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            

            
              
            

            <code class="ruby">      joins(:unit).where(units: {owner: owner})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
                <span class="hits" title="else branch hit 424 times">
                  else: 424
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="424" data-linenumber="117">
            
              <span class="hits">424</span>
            

            
              
            

            <code class="ruby">      all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="120">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :filter_by_inspection_location, -&gt;(location) {</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="424" data-linenumber="121">
            
              <span class="hits">424</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 424 times">
                  else: 424
                </span>
              
            

            <code class="ruby">    where(inspection_location: location) if location.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="123">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :filter_by_date_range, -&gt;(start_date, end_date) {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            

            
              
            

            <code class="ruby">    range = start_date..end_date</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="125">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    where(inspection_date: range) if both_dates_present?(start_date, end_date)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="127">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :overdue, -&gt; { where(&quot;inspection_date &lt; ?&quot;, Time.zone.today - 1.year) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">  # Helper methods for scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="130">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.search_conditions</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            

            
              
            

            <code class="ruby">    &quot;inspections.inspection_location LIKE ? OR inspections.id LIKE ? OR &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">    &quot;inspections.unique_report_number LIKE ? OR units.serial LIKE ? OR &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">    &quot;units.manufacturer LIKE ? OR units.name LIKE ?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="136">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.search_values(query) = Array.new(6) { &quot;%#{query}%&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="138">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.both_dates_present?(start_date, end_date) =</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">    start_date.present? &amp;&amp; end_date.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">  # Calculated fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="142">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def reinspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="299" data-linenumber="143">
            
              <span class="hits">299</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 298 times">
                  else: 298
                </span>
              
            

            <code class="ruby">    return nil if inspection_date.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="144">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">    inspection_date + 1.year</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="147">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def area</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="148">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless width &amp;&amp; length</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            

            
              
            

            <code class="ruby">    width * length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="152">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def volume</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="153">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">    return nil unless width &amp;&amp; length &amp;&amp; height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="154">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    width * length * height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="157">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3646" data-linenumber="158">
            
              <span class="hits">3646</span>
            

            
              
            

            <code class="ruby">    complete_date.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="161">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_types</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="173" data-linenumber="162">
            
              <span class="hits">173</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 173 times">
                  else: 173
                </span>
              
            

            <code class="ruby">    bouncing_pillow? ? PILLOW_ASSESSMENT_TYPES : CASTLE_ASSESSMENT_TYPES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="165">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def applicable_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2023" data-linenumber="166">
            
              <span class="hits">2023</span>
            

            
              
                <span class="hits" title="then branch hit 96 times">
                  then: 96
                </span>
              
            

            <code class="ruby">    if bouncing_pillow?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="96" data-linenumber="167">
            
              <span class="hits">96</span>
            

            
              
            

            <code class="ruby">      pillow_applicable_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
                <span class="hits" title="else branch hit 1927 times">
                  else: 1927
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1927" data-linenumber="169">
            
              <span class="hits">1927</span>
            

            
              
            

            <code class="ruby">      castle_applicable_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="173">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="175">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def castle_applicable_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1927" data-linenumber="176">
            
              <span class="hits">1927</span>
            

            
              
            

            <code class="ruby">    CASTLE_ASSESSMENT_TYPES.select do |assessment_key, _|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13489" data-linenumber="177">
            
              <span class="hits">13489</span>
            

            
              
            

            <code class="ruby">      case assessment_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
                <span class="hits" title="when branch hit 1927 times">
                  when: 1927
                </span>
              
            

            <code class="ruby">      when :slide_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1927" data-linenumber="179">
            
              <span class="hits">1927</span>
            

            
              
            

            <code class="ruby">        has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
                <span class="hits" title="when branch hit 1927 times">
                  when: 1927
                </span>
              
            

            <code class="ruby">      when :enclosed_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1927" data-linenumber="181">
            
              <span class="hits">1927</span>
            

            
              
            

            <code class="ruby">        is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
                <span class="hits" title="when branch hit 1927 times">
                  when: 1927
                </span>
              
            

            <code class="ruby">      when :anchorage_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1927" data-linenumber="183">
            
              <span class="hits">1927</span>
            

            
              
            

            <code class="ruby">        !indoor_only?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
                <span class="hits" title="else branch hit 7708 times">
                  else: 7708
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7708" data-linenumber="185">
            
              <span class="hits">7708</span>
            

            
              
            

            <code class="ruby">        true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="190">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def pillow_applicable_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="96" data-linenumber="191">
            
              <span class="hits">96</span>
            

            
              
            

            <code class="ruby">    PILLOW_ASSESSMENT_TYPES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="194">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  public</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">  # Iterate over only applicable assessments with a block</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="197">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def each_applicable_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1134" data-linenumber="198">
            
              <span class="hits">1134</span>
            

            
              
            

            <code class="ruby">    applicable_assessments.each do |assessment_key, assessment_class|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6365" data-linenumber="199">
            
              <span class="hits">6365</span>
            

            
              
            

            <code class="ruby">      assessment = send(assessment_key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6365" data-linenumber="200">
            
              <span class="hits">6365</span>
            

            
              
                <span class="hits" title="then branch hit 6365 times">
                  then: 6365
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      yield(assessment_key, assessment_class, assessment) if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">  # Check if a specific assessment is applicable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="205">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_applicable?(assessment_key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="206">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">    applicable_assessments.key?(assessment_key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">  # Returns tabs in the order they appear in the UI</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="210">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def applicable_tabs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="697" data-linenumber="211">
            
              <span class="hits">697</span>
            

            
              
            

            <code class="ruby">    tabs = [&quot;inspection&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">    # Get applicable assessments for this inspection type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5049" data-linenumber="214">
            
              <span class="hits">5049</span>
            

            
              
            

            <code class="ruby">    applicable = applicable_assessments.keys.map { |k| k.to_s.chomp(&quot;_assessment&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">    # Add tabs in the correct UI order</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="697" data-linenumber="217">
            
              <span class="hits">697</span>
            

            
              
            

            <code class="ruby">    ordered_tabs = %w[user_height slide structure anchorage materials fan enclosed]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="697" data-linenumber="218">
            
              <span class="hits">697</span>
            

            
              
            

            <code class="ruby">    ordered_tabs.each do |tab|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4879" data-linenumber="219">
            
              <span class="hits">4879</span>
            

            
              
                <span class="hits" title="then branch hit 4352 times">
                  then: 4352
                </span>
              
                <span class="hits" title="else branch hit 527 times">
                  else: 527
                </span>
              
            

            <code class="ruby">      tabs &lt;&lt; tab if applicable.include?(tab)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">    # Add results tab at the end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="697" data-linenumber="223">
            
              <span class="hits">697</span>
            

            
              
            

            <code class="ruby">    tabs &lt;&lt; &quot;results&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="697" data-linenumber="225">
            
              <span class="hits">697</span>
            

            
              
            

            <code class="ruby">    tabs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">  # Advanced methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="229">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def can_be_completed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="136" data-linenumber="230">
            
              <span class="hits">136</span>
            

            
              
            

            <code class="ruby">    unit.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">      all_assessments_complete? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">      inspection_location.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">      !passed.nil? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">      inspection_date.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">      width.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">      length.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">      height.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">      !has_slide.nil? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">      !is_totally_enclosed.nil? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">      !indoor_only.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="243">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="244">
            

            
              
            

            <code class="ruby">    complete = complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="245">
            

            
              
            

            <code class="ruby">    all_assessments_complete = all_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="246">
            

            
              
            

            <code class="ruby">    missing_assessments = get_missing_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="247">
            

            
              
            

            <code class="ruby">    can_be_completed = can_be_completed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="250">
            

            
              
            

            <code class="ruby">      complete:,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">      all_assessments_complete:,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">      missing_assessments:,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">      can_be_completed:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="257">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def can_mark_complete? = can_be_completed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="259">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_errors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="260">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    errors = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="22" data-linenumber="261">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 22 times">
                  else: 22
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;Unit is required&quot; if unit.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="262">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">    errors += get_missing_assessments.map { |assessment| &quot;#{assessment} Assessment incomplete&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="263">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="266">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def get_missing_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="267">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    missing = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">    # Check for missing unit first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="270">
            
              <span class="hits">24</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 23 times">
                  else: 23
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Unit&quot; if unit.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">    # Check for missing assessments using the new helper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="273">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    each_applicable_assessment do |assessment_key, _, assessment|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="136" data-linenumber="274">
            
              <span class="hits">136</span>
            

            
              
                <span class="hits" title="then branch hit 136 times">
                  then: 136
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 94 times">
                  else: 94
                </span>
              
            

            <code class="ruby">      unless assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
                <span class="hits" title="then branch hit 42 times">
                  then: 42
                </span>
              
            

            <code class="ruby">        # Get the assessment type without &quot;_assessment&quot; suffix</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="276">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">        assessment_type = assessment_key.to_s.sub(&quot;_assessment&quot;, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby">        # Get the name from the form header</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="278">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">        missing &lt;&lt; I18n.t(&quot;forms.#{assessment_type}.header&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="282">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    missing</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="285">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete!(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="286">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    update!(complete_date: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="287">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    log_audit_action(&quot;completed&quot;, user, &quot;Inspection completed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="290">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def un_complete!(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="291">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    update!(complete_date: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="292">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    log_audit_action(&quot;marked_incomplete&quot;, user, &quot;Inspection completed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="295">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_completeness</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="296">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    assessment_validation_data.filter_map do |name, assessment, message|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">      # Convert the symbol name (e.g., :slide) to assessment key (e.g., :slide_assessment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="298">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">      assessment_key = :&quot;#{name}_assessment&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="299">
            
              <span class="hits">42</span>
            

            
              
                <span class="hits" title="else branch hit 30 times">
                  else: 30
                </span>
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
            

            <code class="ruby">      next unless assessment_applicable?(assessment_key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="30" data-linenumber="301">
            
              <span class="hits">30</span>
            

            
              
                <span class="hits" title="then branch hit 30 times">
                  then: 30
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 30 times">
                  else: 30
                </span>
              
            

            <code class="ruby">      message if assessment&amp;.present? &amp;&amp; !assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="305">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_audit_action(action, user, details)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6599" data-linenumber="306">
            
              <span class="hits">6599</span>
            

            
              
            

            <code class="ruby">    Event.log(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby">      user: user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby">      action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            

            
              
            

            <code class="ruby">      resource: self,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby">      details: details</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">  rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            
              
            

            <code class="ruby">    # Fallback to logging if Event creation fails</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="314">
            

            
              
            

            <code class="ruby">    Rails.logger.error(&quot;Failed to create event: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="315">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    Rails.logger.info(&quot;Inspection #{id}: #{action} by #{user&amp;.email} - #{details}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="318">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def field_label(form, field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22252" data-linenumber="319">
            
              <span class="hits">22252</span>
            

            
              
            

            <code class="ruby">    key = &quot;forms.#{form}.fields.#{field}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">    # Try the field as-is first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22252" data-linenumber="321">
            
              <span class="hits">22252</span>
            

            
              
            

            <code class="ruby">    label = I18n.t(key, default: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">    # Try removing _pass and/or _comment suffixes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22252" data-linenumber="323">
            
              <span class="hits">22252</span>
            

            
              
                <span class="hits" title="then branch hit 2406 times">
                  then: 2406
                </span>
              
                <span class="hits" title="else branch hit 19846 times">
                  else: 19846
                </span>
              
            

            <code class="ruby">    if label.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2406" data-linenumber="324">
            
              <span class="hits">2406</span>
            

            
              
            

            <code class="ruby">      base_field = field.to_s.gsub(/_pass$|_comment$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2406" data-linenumber="325">
            
              <span class="hits">2406</span>
            

            
              
            

            <code class="ruby">      label = I18n.t(&quot;forms.#{form}.fields.#{base_field}&quot;, default: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby">    # Try adding _pass suffix</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="22252" data-linenumber="328">
            
              <span class="hits">22252</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 22252 times">
                  else: 22252
                </span>
              
            

            <code class="ruby">    if label.nil? &amp;&amp; !field.to_s.end_with?(&quot;_pass&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="329">
            

            
              
            

            <code class="ruby">      label = I18n.t(&quot;#{key}_pass&quot;, default: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            
              
            

            <code class="ruby">    # If still not found, raise for the original key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22252" data-linenumber="332">
            
              <span class="hits">22252</span>
            

            
              
            

            <code class="ruby">    label || I18n.t(key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="335">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_tab_incomplete_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby">    # Fields required for the inspection tab specifically (excludes passed which is on results tab)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="598" data-linenumber="337">
            
              <span class="hits">598</span>
            

            
              
            

            <code class="ruby">    fields = REQUIRED_TO_COMPLETE_FIELDS - [:passed]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="598" data-linenumber="338">
            
              <span class="hits">598</span>
            

            
              
            

            <code class="ruby">    fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5382" data-linenumber="339">
            
              <span class="hits">5382</span>
            

            
              
            

            <code class="ruby">      .select { |f| !f.end_with?(&quot;_comment&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5382" data-linenumber="340">
            
              <span class="hits">5382</span>
            

            
              
            

            <code class="ruby">      .select { |f| send(f).nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="341">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="342">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="343">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def incomplete_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="344">
            
              <span class="hits">414</span>
            

            
              
            

            <code class="ruby">    output = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            

            
              
            

            <code class="ruby">    # Process tabs in the same order as applicable_tabs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="347">
            
              <span class="hits">414</span>
            

            
              
            

            <code class="ruby">    applicable_tabs.each do |tab|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3432" data-linenumber="348">
            
              <span class="hits">3432</span>
            

            
              
            

            <code class="ruby">      case tab</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            

            
              
            

            <code class="ruby">      when &quot;inspection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
                <span class="hits" title="when branch hit 414 times">
                  when: 414
                </span>
              
            

            <code class="ruby">        # Get incomplete fields for the inspection tab (excluding passed)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            
              
            

            <code class="ruby">        inspection_tab_fields =</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="352">
            
              <span class="hits">414</span>
            

            
              
            

            <code class="ruby">          inspection_tab_incomplete_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="808" data-linenumber="353">
            
              <span class="hits">808</span>
            

            
              
            

            <code class="ruby">            .map { |f| {field: f, label: field_label(:inspection, f)} }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="355">
            
              <span class="hits">414</span>
            

            
              
                <span class="hits" title="then branch hit 268 times">
                  then: 268
                </span>
              
                <span class="hits" title="else branch hit 146 times">
                  else: 146
                </span>
              
            

            <code class="ruby">        if inspection_tab_fields.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="268" data-linenumber="356">
            
              <span class="hits">268</span>
            

            
              
            

            <code class="ruby">          output &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            
              
            

            <code class="ruby">            tab: :inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="358">
            

            
              
            

            <code class="ruby">            name: I18n.t(&quot;forms.inspection.header&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="359">
            

            
              
            

            <code class="ruby">            fields: inspection_tab_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="361">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="362">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="363">
            

            
              
            

            <code class="ruby">      when &quot;results&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="364">
            

            
              
                <span class="hits" title="when branch hit 414 times">
                  when: 414
                </span>
              
            

            <code class="ruby">        # Get incomplete fields for the results tab</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="365">
            
              <span class="hits">414</span>
            

            
              
            

            <code class="ruby">        results_fields = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="366">
            
              <span class="hits">414</span>
            

            
              
                <span class="hits" title="then branch hit 142 times">
                  then: 142
                </span>
              
                <span class="hits" title="else branch hit 272 times">
                  else: 272
                </span>
              
            

            <code class="ruby">        results_fields &lt;&lt; {field: :passed, label: field_label(:results, :passed)} if passed.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="368">
            
              <span class="hits">414</span>
            

            
              
                <span class="hits" title="then branch hit 142 times">
                  then: 142
                </span>
              
                <span class="hits" title="else branch hit 272 times">
                  else: 272
                </span>
              
            

            <code class="ruby">        if results_fields.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="369">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">          output &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="370">
            

            
              
            

            <code class="ruby">            tab: :results,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            
              
            

            <code class="ruby">            name: I18n.t(&quot;forms.results.header&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            
              
            

            <code class="ruby">            fields: results_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="374">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            

            
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            

            
              
                <span class="hits" title="else branch hit 2604 times">
                  else: 2604
                </span>
              
            

            <code class="ruby">        # All other tabs are assessment tabs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2604" data-linenumber="378">
            
              <span class="hits">2604</span>
            

            
              
            

            <code class="ruby">        assessment_key = :&quot;#{tab}_assessment&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2604" data-linenumber="379">
            
              <span class="hits">2604</span>
            

            
              
                <span class="hits" title="then branch hit 2604 times">
                  then: 2604
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        assessment = send(assessment_key) if respond_to?(assessment_key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="381">
            

            
              
            

            <code class="ruby">        assessment_fields =</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2604" data-linenumber="382">
            
              <span class="hits">2604</span>
            

            
              
                <span class="hits" title="then branch hit 2604 times">
                  then: 2604
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 2604 times">
                  then: 2604
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          assessment&amp;.incomplete_fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21302" data-linenumber="383">
            
              <span class="hits">21302</span>
            

            
              
            

            <code class="ruby">            &amp;.map { |f| {field: f, label: field_label(tab.to_sym, f)} } ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="384">
            

            
              
            

            <code class="ruby">          []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2604" data-linenumber="386">
            
              <span class="hits">2604</span>
            

            
              
                <span class="hits" title="then branch hit 2100 times">
                  then: 2100
                </span>
              
                <span class="hits" title="else branch hit 504 times">
                  else: 504
                </span>
              
            

            <code class="ruby">        if assessment_fields.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2100" data-linenumber="387">
            
              <span class="hits">2100</span>
            

            
              
            

            <code class="ruby">          output &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            

            
              
            

            <code class="ruby">            tab: tab.to_sym,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            
              
            

            <code class="ruby">            name: I18n.t(&quot;forms.#{tab}.header&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            
              
            

            <code class="ruby">            fields: assessment_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="391">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="392">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="396">
            
              <span class="hits">414</span>
            

            
              
            

            <code class="ruby">    output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="397">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="399">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="401">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_inspector_company_from_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1884" data-linenumber="402">
            
              <span class="hits">1884</span>
            

            
              
            

            <code class="ruby">    self.inspector_company_id ||= user.inspection_company_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="404">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="405">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_inspection_type_from_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1884" data-linenumber="406">
            
              <span class="hits">1884</span>
            

            
              
                <span class="hits" title="else branch hit 1870 times">
                  else: 1870
                </span>
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
            

            <code class="ruby">    return unless unit</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1870" data-linenumber="407">
            
              <span class="hits">1870</span>
            

            
              
                <span class="hits" title="else branch hit 1870 times">
                  else: 1870
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless new_record?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="408">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="409">
            

            
              
            

            <code class="ruby">    # Set inspection type to match unit type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1870" data-linenumber="410">
            
              <span class="hits">1870</span>
            

            
              
            

            <code class="ruby">    self.inspection_type = unit.unit_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="411">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="412">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="413">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def all_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="135" data-linenumber="414">
            
              <span class="hits">135</span>
            

            
              
            

            <code class="ruby">    required_assessment_completions.all?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="415">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="416">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="417">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def required_assessment_completions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="135" data-linenumber="418">
            
              <span class="hits">135</span>
            

            
              
            

            <code class="ruby">    applicable_assessments.map do |assessment_key, _|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="832" data-linenumber="419">
            
              <span class="hits">832</span>
            

            
              
                <span class="hits" title="then branch hit 832 times">
                  then: 832
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      send(assessment_key)&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="421">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="422">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="423">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def all_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="424">
            

            
              
            

            <code class="ruby">    applicable_assessments.map { |assessment_key, _| send(assessment_key) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="425">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="426">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="427">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="428">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="429">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_validation_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="430">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    assessment_types = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="431">
            

            
              
            

            <code class="ruby">      anchorage</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="432">
            

            
              
            

            <code class="ruby">      enclosed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="433">
            

            
              
            

            <code class="ruby">      fan</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="434">
            

            
              
            

            <code class="ruby">      materials</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="435">
            

            
              
            

            <code class="ruby">      slide</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="436">
            

            
              
            

            <code class="ruby">      structure</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="437">
            

            
              
            

            <code class="ruby">      user_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="438">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="439">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="440">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    assessment_types.map do |type|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="441">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">      assessment = send(&quot;#{type}_assessment&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="442">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">      message = I18n.t(&quot;inspections.validation.#{type}_incomplete&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="443">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">      [type, assessment, message]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="445">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="446">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="70a5831225bd608a9387978d5f44c242eba33b4b">
  <div class="header">
    <h3>app/models/inspector_company.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  85.71%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>46</b> relevant lines.
      <span class="green"><b>46</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class InspectorCompany &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :inspections, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # File attachments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one_attached :logo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :name, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :email, format: {with: URI::MailTo::EMAIL_REGEXP}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :phone, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :address, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="73" data-linenumber="16">
            
              <span class="hits">73</span>
            

            
              
            

            <code class="ruby">  scope :active, -&gt; { where(active: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="17">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">  scope :archived, -&gt; { where(active: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :by_status, -&gt;(status) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="19">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    case status&amp;.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="20">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;active&quot; then active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="21">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;archived&quot; then archived</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">    when &quot;all&quot; then all</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="23">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    else all # Default to all companies when no parameter provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :search_by_term, -&gt;(term) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="27">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return all if term.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="28">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    where(&quot;name LIKE ?&quot;, &quot;%#{term}%&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_save :normalize_phone_number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :update_inspection_company_data, if: :saved_change_to_name?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  # Methods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  # Credentials validation moved to individual inspector level (User model)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def full_address</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="39">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    [address, city, postal_code].compact.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="46">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def recent_inspections(limit = 10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    # Will be enhanced when Unit relationship is added</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="48">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    inspections.order(inspection_date: :desc).limit(limit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="51">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def pass_rate(total = nil, passed = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="52">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    total ||= inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="53">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    passed ||= inspections.passed.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="54">
            
              <span class="hits">15</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return 0 if total == 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    (passed.to_f / total * 100).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="58">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def company_statistics</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    # Use group to get all counts in a single query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="60">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    counts = inspections.group(:passed).count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="61">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    passed_count = counts[true] || 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="62">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    failed_count = counts[false] || 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="63">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    total_count = passed_count + failed_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="66">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      total_inspections: total_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      passed_inspections: passed_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      failed_inspections: failed_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      pass_rate: pass_rate(total_count, passed_count),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      active_since: created_at.year</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="74">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def logo_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    logo.attached? ? logo : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="78">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="80">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def normalize_phone_number</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1740" data-linenumber="81">
            
              <span class="hits">1740</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1740 times">
                  else: 1740
                </span>
              
            

            <code class="ruby">    return if phone.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    # Remove all non-digit characters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1740" data-linenumber="84">
            
              <span class="hits">1740</span>
            

            
              
            

            <code class="ruby">    self.phone = phone.gsub(/\D/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="87">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_inspection_company_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    # Update any draft inspections with new company name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    # Will be enhanced when draft scope and audit logging are added to Inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="90">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    inspections.each do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      # inspection.update(inspection_company_name: name) - will be added in later step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      # inspection.log_audit_action(&#39;company_updated&#39;, user, &#39;Company name updated&#39;) - will be added in later step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0f23dae70a6b92ac2c1b330c66617f30ba35b26a">
  <div class="header">
    <h3>app/models/unit.rb</h3>
    <h4>
      <span class="yellow">
  86.3%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  73.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>73</b> relevant lines.
      <span class="green"><b>63</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>30</b> total branches, </span>
          <span class="green"><b>22</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Unit &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.table_name = &quot;units&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  enum :unit_type, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    bouncy_castle: &quot;BOUNCY_CASTLE&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    bouncing_pillow: &quot;BOUNCING_PILLOW&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="385" data-linenumber="12">
            
              <span class="hits">385</span>
            

            
              
            

            <code class="ruby">  has_many :complete_inspections, -&gt; { where.not(complete_date: nil) }, class_name: &quot;Inspection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="13">
            
              <span class="hits">189</span>
            

            
              
            

            <code class="ruby">  has_many :draft_inspections, -&gt; { where(complete_date: nil) }, class_name: &quot;Inspection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  # File attachments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one_attached :photo</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validate :photo_must_be_image</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_create :generate_custom_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_destroy :check_complete_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_destroy :destroy_draft_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  # All fields are required for Units</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :name, :serial, :description, :manufacturer, :owner, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :serial, uniqueness: {scope: [:user_id]}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  # Scopes - enhanced from original Equipment and new Unit functionality</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="29">
            
              <span class="hits">103</span>
            

            
              
            

            <code class="ruby">  scope :seed_data, -&gt; { where(is_seed: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="30">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">  scope :non_seed_data, -&gt; { where(is_seed: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :search, -&gt;(query) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="86" data-linenumber="32">
            
              <span class="hits">86</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
            

            <code class="ruby">    if query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="33">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      search_term = &quot;%#{query}%&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="34">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      where(&lt;&lt;~SQL, *([search_term] * 5))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        serial LIKE ?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        OR name LIKE ?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        OR description LIKE ?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        OR manufacturer LIKE ?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">        OR owner LIKE ?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      SQL</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
                <span class="hits" title="else branch hit 77 times">
                  else: 77
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="42">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="45">
            
              <span class="hits">102</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 75 times">
                  else: 75
                </span>
              
            

            <code class="ruby">  scope :by_manufacturer, -&gt;(manufacturer) { where(manufacturer: manufacturer) if manufacturer.present? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="83" data-linenumber="46">
            
              <span class="hits">83</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 59 times">
                  else: 59
                </span>
              
            

            <code class="ruby">  scope :by_owner, -&gt;(owner) { where(owner: owner) if owner.present? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :with_recent_inspections, -&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">    cutoff_date = SafetyStandard::REINSPECTION_INTERVAL_DAYS.days.ago</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">    joins(:inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      .where(inspections: {inspection_date: cutoff_date..})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      .distinct</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :inspection_due, -&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">    joins(:inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      .merge(Inspection.completed)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      .group(&quot;units.id&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      .having(&quot;MAX(inspections.complete_date) + INTERVAL #{SafetyStandard::REINSPECTION_INTERVAL_DAYS} DAY &lt;= CURRENT_DATE&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="63">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="608" data-linenumber="64">
            
              <span class="hits">608</span>
            

            
              
            

            <code class="ruby">    @last_inspection ||= inspections.merge(Inspection.complete).order(complete_date: :desc).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="67">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def last_inspection_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="68">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    last_inspection&amp;.passed? ? &quot;Passed&quot; : &quot;Failed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="71">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_history</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">    inspections.includes(:user).order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="75">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def next_inspection_due</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="76">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    return nil unless last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="77">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    last_inspection.inspection_date + SafetyStandard::REINSPECTION_INTERVAL_DAYS.days</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="80">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_overdue?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="81">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return false unless next_inspection_due</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="82">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    next_inspection_due &lt; Date.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def compliance_status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="86">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return &quot;Never Inspected&quot; unless last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="88">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if inspection_overdue?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      &quot;Overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="90">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    elsif last_inspection.passed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Compliant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Non-Compliant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      total_inspections: inspections.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      passed_inspections: inspections.passed.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      failed_inspections: inspections.failed.count,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="102">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      last_inspection_date: last_inspection&amp;.inspection_date,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      next_due_date: next_inspection_due,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      compliance_status: compliance_status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="108">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def deletable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="112" data-linenumber="109">
            
              <span class="hits">112</span>
            

            
              
            

            <code class="ruby">    !complete_inspections.exists?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="112">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="114">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_complete_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="87" data-linenumber="115">
            
              <span class="hits">87</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 86 times">
                  else: 86
                </span>
              
            

            <code class="ruby">    if complete_inspections.exists?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      errors.add(:base, :has_complete_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      throw(:abort)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="121">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def destroy_draft_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="86" data-linenumber="122">
            
              <span class="hits">86</span>
            

            
              
            

            <code class="ruby">    draft_inspections.destroy_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="125">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  public</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="127">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.overdue</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">    # Find units where their most recent inspection is older than the interval</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">    # Using Date.current instead of Date.today for Rails timezone consistency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="130">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    cutoff_date = Date.current - SafetyStandard::REINSPECTION_INTERVAL_DAYS.days</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="131">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    joins(:inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      .group(&quot;units.id&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      .having(&quot;MAX(inspections.inspection_date) &lt;= ?&quot;, cutoff_date)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="136">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="138">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_for_complete_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="139">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if complete_inspections.exists?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            

            
              
            

            <code class="ruby">      errors.add(:base, :has_complete_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            

            
              
            

            <code class="ruby">      throw(:abort)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="145">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def photo_must_be_image</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1465" data-linenumber="146">
            
              <span class="hits">1465</span>
            

            
              
                <span class="hits" title="else branch hit 60 times">
                  else: 60
                </span>
              
                <span class="hits" title="then branch hit 1405 times">
                  then: 1405
                </span>
              
            

            <code class="ruby">    return unless photo.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="60" data-linenumber="148">
            
              <span class="hits">60</span>
            

            
              
                <span class="hits" title="else branch hit 60 times">
                  else: 60
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    unless photo.blob.content_type.start_with?(&quot;image/&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            

            
              
            

            <code class="ruby">      errors.add(:photo, &quot;must be an image file&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            

            
              
            

            <code class="ruby">      photo.purge</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a8de2fd5d1e4076b8b8a18a5e619dbaecb324a3e">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4>
      <span class="green">
  92.13%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  65.63%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>89</b> relevant lines.
      <span class="green"><b>82</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>32</b> total branches, </span>
          <span class="green"><b>21</b> branches covered</span> and
          <span class="red"><b>11</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class User &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_secure_password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :inspections, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :units, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :events, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one_attached :logo</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one_attached :signature</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validate :logo_must_be_image</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validate :signature_must_be_image</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection_company,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    class_name: &quot;InspectorCompany&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    presence: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    uniqueness: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    format: {with: URI::MailTo::EMAIL_REGEXP}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :password,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    presence: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    length: {minimum: 6},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    if: :password_digest_changed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    presence: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    if: :validate_name?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :rpii_inspector_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    uniqueness: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :theme,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    inclusion: {in: %w[default light dark]}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="39">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_save :downcase_email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_save :normalize_rpii_number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="41">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_create :set_inactive_on_signup</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def is_active?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1904" data-linenumber="44">
            
              <span class="hits">1904</span>
            

            
              
            

            <code class="ruby">    active_until.nil? || active_until &gt;= Date.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  alias_method :can_create_inspection?, :is_active?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inactive_user_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="50">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">    I18n.t(&quot;users.messages.user_inactive&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8257" data-linenumber="54">
            
              <span class="hits">8257</span>
            

            
              
            

            <code class="ruby">    admin_pattern = ENV[&quot;ADMIN_EMAILS_PATTERN&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8257" data-linenumber="55">
            
              <span class="hits">8257</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 8257 times">
                  else: 8257
                </span>
              
            

            <code class="ruby">    return false if admin_pattern.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8257" data-linenumber="58">
            
              <span class="hits">8257</span>
            

            
              
            

            <code class="ruby">      regex = Regexp.new(admin_pattern)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8257" data-linenumber="59">
            
              <span class="hits">8257</span>
            

            
              
            

            <code class="ruby">      regex.match?(email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">    rescue RegexpError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            

            
              
            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def active_until=(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1720" data-linenumber="66">
            
              <span class="hits">1720</span>
            

            
              
            

            <code class="ruby">    @active_until_explicitly_set = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1720" data-linenumber="67">
            
              <span class="hits">1720</span>
            

            
              
            

            <code class="ruby">    super</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_company?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="71">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">    inspection_company_id.present? || inspection_company.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="74">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def display_phone</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="75">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    has_company? ? inspection_company.phone : phone</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="78">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def display_address</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="79">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    has_company? ? inspection_company.address : address</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="82">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def display_country</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="83">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    has_company? ? inspection_company.country : country</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="86">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def display_postal_code</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="87">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    has_company? ? inspection_company.postal_code : postal_code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="90">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def verify_rpii_inspector_number</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="91">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if rpii_inspector_number.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">      return {valid: false, error: :blank_number}</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="93">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    elsif name.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">      return {valid: false, error: :blank_name}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="97">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    result = RpiiVerificationService.verify(rpii_inspector_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="99">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    if result[:valid]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="100">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      handle_valid_rpii_result(result[:inspector])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="102">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      update(rpii_verified_date: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="103">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      {valid: false, error: :not_found}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="107">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def rpii_verified?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="108">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">    rpii_verified_date.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="111">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def handle_valid_rpii_result(inspector)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="112">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    if inspector[:name].present? &amp;&amp; names_match?(name, inspector[:name])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="113">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      update(rpii_verified_date: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="114">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      {valid: true, inspector: inspector}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="116">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      update(rpii_verified_date: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="117">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      {valid: false, error: :name_mismatch, inspector: inspector}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="121">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_seed_data?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="122">
            
              <span class="hits">78</span>
            

            
              
            

            <code class="ruby">    units.seed_data.exists? || inspections.seed_data.exists?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="125">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_name?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3195" data-linenumber="126">
            
              <span class="hits">3195</span>
            

            
              
            

            <code class="ruby">    new_record? || name_changed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="129">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def names_match?(user_name, inspector_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="130">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    normalized_user = user_name.to_s.strip.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="131">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    normalized_inspector = inspector_name.to_s.strip.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="133">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    return true if normalized_user == normalized_inspector</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="135">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    user_parts = normalized_user.split(/\s+/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="136">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    inspector_parts = normalized_inspector.split(/\s+/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="138">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    user_parts.all? { |part| inspector_parts.include?(part) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="141">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def downcase_email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3162" data-linenumber="142">
            
              <span class="hits">3162</span>
            

            
              
            

            <code class="ruby">    self.email = email.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="145">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def normalize_rpii_number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3162" data-linenumber="146">
            
              <span class="hits">3162</span>
            

            
              
                <span class="hits" title="then branch hit 188 times">
                  then: 188
                </span>
              
                <span class="hits" title="else branch hit 2974 times">
                  else: 2974
                </span>
              
            

            <code class="ruby">    self.rpii_inspector_number = nil if rpii_inspector_number.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="149">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_inactive_on_signup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1678" data-linenumber="150">
            
              <span class="hits">1678</span>
            

            
              
                <span class="hits" title="else branch hit 1668 times">
                  else: 1668
                </span>
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
            

            <code class="ruby">    unless instance_variable_get(:@active_until_explicitly_set)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="151">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      self.active_until = Date.current - 1.day</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="155">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def logo_must_be_image</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3195" data-linenumber="156">
            
              <span class="hits">3195</span>
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 3187 times">
                  then: 3187
                </span>
              
            

            <code class="ruby">    return unless logo.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="158">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    unless logo.blob.content_type.start_with?(&quot;image/&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="159">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      errors.add(:logo, &quot;must be an image file&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="160">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      logo.purge</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="164">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def signature_must_be_image</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3195" data-linenumber="165">
            
              <span class="hits">3195</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 3192 times">
                  then: 3192
                </span>
              
            

            <code class="ruby">    return unless signature.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="167">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless signature.blob.content_type.start_with?(&quot;image/&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="168">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      errors.add(:signature, &quot;must be an image file&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="169">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      signature.purge</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b22584013992bc5757858e5647e3edf2b4f1ada1">
  <div class="header">
    <h3>app/services/image_processor_service.rb</h3>
    <h4>
      <span class="yellow">
  89.66%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  70.59%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>29</b> relevant lines.
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>17</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class ImageProcessorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  FULL_SIZE = 1200</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  THUMBNAIL_SIZE = 200</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  DEFAULT_SIZE = 800</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.full_size(image)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="7">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return nil unless image&amp;.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="9">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    image.variant(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      format: :jpeg,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      resize_to_limit: [FULL_SIZE, FULL_SIZE],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      saver: {quality: 75}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.thumbnail(image)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="17">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return nil unless image&amp;.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="19">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    image.variant(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      format: :jpeg,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      resize_to_limit: [THUMBNAIL_SIZE, THUMBNAIL_SIZE],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      saver: {quality: 75}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.default(image)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="27">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return nil unless image&amp;.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="29">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    image.variant(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      format: :jpeg,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      resize_to_limit: [DEFAULT_SIZE, DEFAULT_SIZE],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      saver: {quality: 75}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  # Calculate actual dimensions after resize_to_limit transformation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  # Pass in metadata hash with &quot;width&quot; and &quot;height&quot; keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  # Size can be :full, :thumbnail, or :default (defaults to :default)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="39">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.calculate_dimensions(metadata, size = :default)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    max_size = max_size_for(size)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    original_width = metadata[&quot;width&quot;].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    original_height = metadata[&quot;height&quot;].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    resize_dimensions(original_width, original_height, max_size)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.max_size_for(size)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="49">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when :full then FULL_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    when :thumbnail then THUMBNAIL_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    else DEFAULT_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="55">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.resize_dimensions(original_width, original_height, max_size)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    ratio = max_size / [original_width, original_height].max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if ratio &lt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="60">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        width: (original_width * ratio).round,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        height: (original_height * ratio).round</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="63">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            
              
            

            <code class="ruby">      {width: original_width.to_i, height: original_height.to_i}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a24adb581826e989c761bcdc2a5430687d71a94d">
  <div class="header">
    <h3>app/services/inspection_creation_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  93.75%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>37</b> relevant lines.
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>15</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class InspectionCreationService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def initialize(user, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="3">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="4">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    @unit_id = params[:unit_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="8">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    unit = find_and_validate_unit if @unit_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="9">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 21 times">
                  else: 21
                </span>
              
            

            <code class="ruby">    return invalid_unit_result if @unit_id.present? &amp;&amp; unit.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="11">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">    inspection = build_inspection(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="13">
            
              <span class="hits">21</span>
            

            
              
                <span class="hits" title="then branch hit 20 times">
                  then: 20
                </span>
              
            

            <code class="ruby">    if inspection.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="14">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      notify_if_production(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="15">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      success_result(inspection, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      failure_result(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def find_and_validate_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="24">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @user.units.find_by(id: @unit_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  COPY_FROM_LAST_INSPECTION_FIELDS = %i[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    has_slide</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    is_totally_enclosed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    width</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_inspection(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="36">
            
              <span class="hits">21</span>
            

            
              
                <span class="hits" title="then branch hit 18 times">
                  then: 18
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    last_inspection = unit&amp;.last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="37">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">    copy_fields = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="38">
            
              <span class="hits">21</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">    if last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="39">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      copy_fields = COPY_FROM_LAST_INSPECTION_FIELDS.map do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="40">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">        [field, last_inspection.send(field)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      end.to_h</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="44">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">    @user.inspections.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      unit: unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      inspection_date: Date.current,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      inspector_company_id: @user.inspection_company_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      inspection_location: @user.default_inspection_location,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      **copy_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def notify_if_production(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="54">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
            

            <code class="ruby">    return unless Rails.env.production?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    NtfyService.notify(&quot;new inspection by #{@user.email}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="58">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def invalid_unit_result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      success: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      error_type: :invalid_unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      message: I18n.t(&quot;inspections.errors.invalid_unit&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">      redirect_path: &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="67">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def success_result(inspection, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="68">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 18 times">
                  else: 18
                </span>
              
            

            <code class="ruby">    message_key = unit.nil? ? &quot;created_without_unit&quot; : &quot;created&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="69">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      success: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      inspection: inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      message: I18n.t(&quot;inspections.messages.#{message_key}&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      redirect_path: &quot;/inspections/#{inspection.id}/edit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="77">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def failure_result(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    error_messages = inspection.errors.full_messages.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="79">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_path = build_failure_redirect_path(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      success: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">      error_type: :validation_failed,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      message: I18n.t(&quot;inspections.errors.creation_failed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        errors: error_messages),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      redirect_path: redirect_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="90">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_failure_redirect_path(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    inspection.unit.present? ? &quot;/units/#{inspection.unit.id}&quot; : &quot;/&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f0e125eb76c1fd9b174f84f25323607ed6336b49">
  <div class="header">
    <h3>app/services/inspection_csv_export_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  88.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>30</b> relevant lines.
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>25</b> total branches, </span>
          <span class="green"><b>22</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class InspectionCsvExportService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def initialize(inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="3">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    @inspections = inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def generate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="7">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    CSV.generate(headers: true) do |csv|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="8">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      csv &lt;&lt; headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="10">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      @inspections.each do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="11">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        csv &lt;&lt; row_data(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    # All inspection column names (excluding foreign keys we&#39;ll handle specially)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    excluded_columns = %w[user_id inspector_company_id unit_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    inspection_columns = Inspection.column_names - excluded_columns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    # Build comprehensive header list</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    headers = inspection_columns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    headers += %w[unit_name unit_serial unit_manufacturer unit_owner unit_description]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    headers += %w[inspector_company_name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    headers += %w[inspector_user_email]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    headers += %w[complete]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def row_data(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="34">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    headers.map do |header|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="261" data-linenumber="35">
            
              <span class="hits">261</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
            

            <code class="ruby">      case header</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="36">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      in &quot;unit_name&quot; then inspection.unit&amp;.name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="37">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      in &quot;unit_serial&quot; then inspection.unit&amp;.serial</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="38">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      in &quot;unit_manufacturer&quot; then inspection.unit&amp;.manufacturer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="39">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      in &quot;unit_owner&quot; then inspection.unit&amp;.owner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="40">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      in &quot;unit_description&quot; then inspection.unit&amp;.description</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="41">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      in &quot;inspector_company_name&quot; then inspection.inspector_company&amp;.name</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="42">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="in branch hit 9 times">
                  in: 9
                </span>
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      in &quot;inspector_user_email&quot; then inspection.user&amp;.email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="43">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 189 times">
                  else: 189
                </span>
              
            

            <code class="ruby">      in &quot;complete&quot; then inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="189" data-linenumber="44">
            
              <span class="hits">189</span>
            

            
              
                <span class="hits" title="then branch hit 189 times">
                  then: 189
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else inspection.send(header) if inspection.respond_to?(header)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8f076ba221aee0a5c4b2ec1f6c9006efd03eee28">
  <div class="header">
    <h3>app/services/json_serializer_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  71.43%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>50</b> relevant lines.
      <span class="green"><b>50</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>28</b> total branches, </span>
          <span class="green"><b>20</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class JsonSerializerService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.format_value(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4384" data-linenumber="3">
            
              <span class="hits">4384</span>
            

            
              
            

            <code class="ruby">    case value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
                <span class="hits" title="when branch hit 115 times">
                  when: 115
                </span>
              
            

            <code class="ruby">    when Date, Time, DateTime</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="115" data-linenumber="5">
            
              <span class="hits">115</span>
            

            
              
            

            <code class="ruby">      value.strftime(&quot;%Y-%m-%d&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
                <span class="hits" title="else branch hit 4269 times">
                  else: 4269
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4269" data-linenumber="7">
            
              <span class="hits">4269</span>
            

            
              
            

            <code class="ruby">      value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.serialize_unit(unit, include_inspections: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="30" data-linenumber="12">
            
              <span class="hits">30</span>
            

            
              
                <span class="hits" title="else branch hit 30 times">
                  else: 30
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="14">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    unit_fields = Unit.column_names - PublicFieldFiltering::EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="16">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="17">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    unit_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="240" data-linenumber="18">
            
              <span class="hits">240</span>
            

            
              
            

            <code class="ruby">      value = unit.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="240" data-linenumber="19">
            
              <span class="hits">240</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 240 times">
                  then: 240
                </span>
              
            

            <code class="ruby">      data[field.to_sym] = format_value(value) unless value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="22">
            
              <span class="hits">30</span>
            

            
              
                <span class="hits" title="then branch hit 28 times">
                  then: 28
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    if include_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="23">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">      completed_inspections = unit.inspections.complete.order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="25">
            
              <span class="hits">28</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 20 times">
                  else: 20
                </span>
              
            

            <code class="ruby">      if completed_inspections.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="26">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        data[:inspection_history] = completed_inspections.map do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="28">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">            inspection_date: format_value(inspection.inspection_date),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">            passed: inspection.passed,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">            complete: inspection.complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="31">
            

            
              
                <span class="hits" title="then branch hit 11 times">
                  then: 11
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">            inspector_company: inspection.inspector_company&amp;.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">            unique_report_number: inspection.unique_report_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">            inspection_location: inspection.inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="37">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        data[:total_inspections] = completed_inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="38">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        data[:last_inspection_date] = format_value(completed_inspections.first&amp;.inspection_date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="39">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        data[:last_inspection_passed] = completed_inspections.first&amp;.passed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="43">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    base_url = ENV[&quot;BASE_URL&quot;] || Rails.application.routes.default_url_options[:host] || &quot;localhost:3000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="44">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    data[:urls] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      report_pdf: &quot;#{base_url}/units/#{unit.id}.pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      report_json: &quot;#{base_url}/units/#{unit.id}.json&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      qr_code: &quot;#{base_url}/units/#{unit.id}.png&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="50">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.serialize_inspection(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="34" data-linenumber="54">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="else branch hit 34 times">
                  else: 34
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="56">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    inspection_fields = Inspection.column_names - PublicFieldFiltering::EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="58">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="59">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    inspection_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="510" data-linenumber="60">
            
              <span class="hits">510</span>
            

            
              
            

            <code class="ruby">      value = inspection.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="510" data-linenumber="61">
            
              <span class="hits">510</span>
            

            
              
                <span class="hits" title="else branch hit 110 times">
                  else: 110
                </span>
              
                <span class="hits" title="then branch hit 400 times">
                  then: 400
                </span>
              
            

            <code class="ruby">      data[field.to_sym] = format_value(value) unless value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="64">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    data[:complete] = inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="65">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="then branch hit 32 times">
                  then: 32
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    data[:passed] = inspection.passed? if inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="67">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    data[:inspector] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      name: inspection.user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      rpii_inspector_number: inspection.user.rpii_inspector_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="72">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    base_url = ENV[&quot;BASE_URL&quot;] || Rails.application.routes.default_url_options[:host] || &quot;localhost:3000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="73">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    data[:urls] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      report_pdf: &quot;#{base_url}/inspections/#{inspection.id}.pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      report_json: &quot;#{base_url}/inspections/#{inspection.id}.json&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      qr_code: &quot;#{base_url}/inspections/#{inspection.id}.png&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="34" data-linenumber="79">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="then branch hit 34 times">
                  then: 34
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if inspection.unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="80">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">      data[:unit] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        id: inspection.unit.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">        name: inspection.unit.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">        serial: inspection.unit.serial,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        manufacturer: inspection.unit.manufacturer,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        owner: inspection.unit.owner</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="89">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    assessments = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="91">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    inspection.each_applicable_assessment do |assessment_key, assessment_class, assessment|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="235" data-linenumber="92">
            
              <span class="hits">235</span>
            

            
              
                <span class="hits" title="then branch hit 235 times">
                  then: 235
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="235" data-linenumber="93">
            
              <span class="hits">235</span>
            

            
              
            

            <code class="ruby">        assessments[assessment_key] = serialize_assessment(assessment, assessment_class)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="97">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    data[:assessments] = assessments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="99">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="102">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.serialize_assessment(assessment, klass)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="235" data-linenumber="103">
            
              <span class="hits">235</span>
            

            
              
            

            <code class="ruby">    assessment_fields = klass.column_names - PublicFieldFiltering::EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="235" data-linenumber="105">
            
              <span class="hits">235</span>
            

            
              
            

            <code class="ruby">    data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="235" data-linenumber="106">
            
              <span class="hits">235</span>
            

            
              
            

            <code class="ruby">    assessment_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4607" data-linenumber="107">
            
              <span class="hits">4607</span>
            

            
              
            

            <code class="ruby">      value = assessment.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4607" data-linenumber="108">
            
              <span class="hits">4607</span>
            

            
              
                <span class="hits" title="else branch hit 882 times">
                  else: 882
                </span>
              
                <span class="hits" title="then branch hit 3725 times">
                  then: 3725
                </span>
              
            

            <code class="ruby">      data[field.to_sym] = format_value(value) unless value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="235" data-linenumber="111">
            
              <span class="hits">235</span>
            

            
              
            

            <code class="ruby">    data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="833b3bdd941a28c296c4e4017998935dc62189fe">
  <div class="header">
    <h3>app/services/ntfy_service.rb</h3>
    <h4>
      <span class="red">
  66.67%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>21</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">require &quot;net/http&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class NtfyService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def notify(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="6">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      Thread.new do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="7">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        send_notification(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="9">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        Rails.logger.error(&quot;NtfyService error: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      ensure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="11">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        ActiveRecord::Base.connection_pool.release_connection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def send_notification(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      channel = ENV[&quot;NTFY_CHANNEL&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="19">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      return if channel.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      uri = URI.parse(&quot;https://ntfy.sh/#{channel}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      http = Net::HTTP.new(uri.host, uri.port)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">      http.use_ssl = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">      request = Net::HTTP::Post.new(uri.path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">      request[&quot;Title&quot;] = &quot;play-test notification&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">      request[&quot;Priority&quot;] = &quot;high&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">      request[&quot;Tags&quot;] = &quot;warning&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">      request.body = message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">      http.request(request)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f04bd6a5175b7a67a12634a2ce7d0a55bdab3e9e">
  <div class="header">
    <h3>app/services/pdf_generator_service.rb</h3>
    <h4>
      <span class="green">
  91.89%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  85.71%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>74</b> relevant lines.
      <span class="green"><b>68</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/configuration&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/utilities&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/header_generator&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/table_builder&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/assessment_renderer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/position_calculator&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/image_orientation_processor&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/image_processor&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require_relative &quot;pdf_generator_service/debug_info_renderer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_report(inspection, debug_enabled: false, debug_queries: [])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="15">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">    require &quot;prawn/table&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="17">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">    Prawn::Document.new(page_size: &quot;A4&quot;, page_layout: :portrait) do |pdf|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="18">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      Configuration.setup_pdf_fonts(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      # Initialize assessment renderer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="21">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      assessment_renderer = AssessmentRenderer.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      # Header section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="24">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      HeaderGenerator.generate_inspection_pdf_header(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      # Unit details section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="27">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      generate_inspection_unit_details(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      # Risk assessment section (if present)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="30">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      generate_risk_assessment_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      # Generate all assessment sections using the inspection&#39;s applicable assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="33">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      inspection.each_applicable_assessment do |assessment_key, _, assessment|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        # Get the assessment type name for i18n (remove _assessment suffix)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="35">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">        assessment_type = assessment_key.to_s.sub(/_assessment$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        # Generate the section using the generic renderer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="38">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">        renderer = AssessmentRenderer.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="39">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">        renderer.generate_assessment_section(pdf, assessment_type, assessment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="40">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">        assessment_renderer.current_assessment_blocks.concat(renderer.current_assessment_blocks)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      # Render all collected assessments in newspaper-style columns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="44">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      assessment_renderer.render_all_assessments_in_columns(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      # QR Code in bottom right corner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="47">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      ImageProcessor.generate_qr_code_footer(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      # Add DRAFT watermark overlay for draft inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="50">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="else branch hit 35 times">
                  else: 35
                </span>
              
                <span class="hits" title="then branch hit 21 times">
                  then: 21
                </span>
              
            

            <code class="ruby">      Utilities.add_draft_watermark(pdf) unless inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      # Add debug info page if enabled (admins only)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="53">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 53 times">
                  else: 53
                </span>
              
            

            <code class="ruby">      if debug_enabled &amp;&amp; debug_queries.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="54">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        DebugInfoRenderer.add_debug_info_page(pdf, debug_queries)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="59">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_report(unit, debug_enabled: false, debug_queries: [])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="60">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    require &quot;prawn/table&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    # Preload all inspections once to avoid N+1 queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="63">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    completed_inspections = unit.inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      .includes(:user, inspector_company: {logo_attachment: :blob})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      .complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      .order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="68">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    last_inspection = completed_inspections.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="70">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    Prawn::Document.new(page_size: &quot;A4&quot;, page_layout: :portrait) do |pdf|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="71">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      Configuration.setup_pdf_fonts(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="72">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      HeaderGenerator.generate_unit_pdf_header(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="73">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      generate_unit_details_with_inspection(pdf, unit, last_inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="74">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      generate_unit_inspection_history_with_data(pdf, unit, completed_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="75">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      ImageProcessor.generate_qr_code_footer(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      # Add debug info page if enabled (admins only)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="78">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 31 times">
                  else: 31
                </span>
              
            

            <code class="ruby">      if debug_enabled &amp;&amp; debug_queries.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="79">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        DebugInfoRenderer.add_debug_info_page(pdf, debug_queries)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="84">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_unit_details(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="85">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">    unit = inspection.unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="87">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="88">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">      unit_data = TableBuilder.build_unit_details_table_with_inspection(unit, inspection, :inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="89">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">      TableBuilder.create_unit_details_table(pdf, I18n.t(&quot;pdf.inspection.equipment_details&quot;), unit_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    # Hide the table entirely when no unit is associated</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="94">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_details(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            

            
              
            

            <code class="ruby">    unit_data = TableBuilder.build_unit_details_table(unit, :unit)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            

            
              
            

            <code class="ruby">    TableBuilder.create_unit_details_table(pdf, I18n.t(&quot;pdf.unit.details&quot;), unit_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="99">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_details_with_inspection(pdf, unit, last_inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="100">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    unit_data = TableBuilder.build_unit_details_table(unit, :unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="101">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    TableBuilder.create_unit_details_table(pdf, I18n.t(&quot;pdf.unit.details&quot;), unit_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="104">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_inspection_history(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    # Check for completed inspections - preload associations to avoid N+1 queries</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">    # Since all inspections belong to the same unit, we don&#39;t need to reload the unit</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            

            
              
            

            <code class="ruby">    completed_inspections = unit.inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      .includes(:user, inspector_company: {logo_attachment: :blob})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">      .complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">      .order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="112">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if completed_inspections.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            

            
              
            

            <code class="ruby">      TableBuilder.create_nice_box_table(pdf, I18n.t(&quot;pdf.unit.inspection_history&quot;), [[I18n.t(&quot;pdf.unit.no_completed_inspections&quot;), &quot;&quot;]])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="114">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            

            
              
            

            <code class="ruby">      TableBuilder.create_inspection_history_table(pdf, I18n.t(&quot;pdf.unit.inspection_history&quot;), completed_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="119">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_inspection_history_with_data(pdf, unit, completed_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="120">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 26 times">
                  then: 26
                </span>
              
            

            <code class="ruby">    if completed_inspections.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="121">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      TableBuilder.create_nice_box_table(pdf, I18n.t(&quot;pdf.unit.inspection_history&quot;), [[I18n.t(&quot;pdf.unit.no_completed_inspections&quot;), &quot;&quot;]])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="123">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      TableBuilder.create_inspection_history_table(pdf, I18n.t(&quot;pdf.unit.inspection_history&quot;), completed_inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="127">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_risk_assessment_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="128">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 55 times">
                  else: 55
                </span>
              
            

            <code class="ruby">    return if inspection.risk_assessment.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="130">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.inspection.risk_assessment&quot;), size: HEADER_TEXT_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="131">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">    pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="132">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="134">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">    pdf.text inspection.risk_assessment, size: 10</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="135">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 15</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">  # Helper methods for backward compatibility and testing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="139">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.truncate_text(text, max_length)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="140">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    Utilities.truncate_text(text, max_length)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="143">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.format_pass_fail(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="144">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    Utilities.format_pass_fail(value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="147">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.format_measurement(value, unit = &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="148">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    Utilities.format_measurement(value, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0362eba099c60f94cabc89c4097ae57bccb9f291">
  <div class="header">
    <h3>app/services/pdf_generator_service/assessment_renderer.rb</h3>
    <h4>
      <span class="green">
  99.13%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  80.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>115</b> relevant lines.
      <span class="green"><b>114</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>40</b> total branches, </span>
          <span class="green"><b>32</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class AssessmentRenderer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    SENSITIVE_COLUMNS = %w[id inspection_id created_at updated_at].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    NULL_COLOR = &quot;663399&quot;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    COMMENT_COLOR = &quot;663399&quot;.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    SECTION_TITLE_SIZE = 12</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_TITLE_SIZE = 10</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    FIELD_TEXT_SIZE = 8</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    SECTION_MARGIN_AFTER_TITLE = 15</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_MARGIN_AFTER_TITLE = 3</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_MARGIN_AFTER = 16</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    SECTION_MARGIN_AFTER = 20</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    COLUMN_COUNT = 3</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    COLUMN_SPACER = 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    attr_accessor :current_assessment_blocks, :current_assessment_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def initialize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="456" data-linenumber="21">
            
              <span class="hits">456</span>
            

            
              
            

            <code class="ruby">      @current_assessment_blocks = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="456" data-linenumber="22">
            
              <span class="hits">456</span>
            

            
              
            

            <code class="ruby">      reset_assessment_context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def reset_assessment_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="456" data-linenumber="28">
            
              <span class="hits">456</span>
            

            
              
            

            <code class="ruby">      @current_assessment_fields = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="456" data-linenumber="29">
            
              <span class="hits">456</span>
            

            
              
            

            <code class="ruby">      @current_assessment_type = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="456" data-linenumber="30">
            
              <span class="hits">456</span>
            

            
              
            

            <code class="ruby">      @current_assessment = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def render_fields_from_i18n</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="34">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      available_columns = @current_assessment.attributes.keys - SENSITIVE_COLUMNS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="35">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      field_groups = group_assessment_fields(available_columns.map(&amp;:to_sym))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4242" data-linenumber="36">
            
              <span class="hits">4242</span>
            

            
              
            

            <code class="ruby">      field_groups.each { |base, fields| render_field_group(base, fields) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="39">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def render_field_group(base_name, fields)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      # For grouped fields, check i18n for base field; for standalone pass fields, check the pass field</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3857" data-linenumber="41">
            
              <span class="hits">3857</span>
            

            
              
            

            <code class="ruby">      label_field = fields[:base] || fields[:pass]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3857" data-linenumber="42">
            
              <span class="hits">3857</span>
            

            
              
                <span class="hits" title="else branch hit 3197 times">
                  else: 3197
                </span>
              
                <span class="hits" title="then branch hit 660 times">
                  then: 660
                </span>
              
            

            <code class="ruby">      return unless label_field &amp;&amp; has_any_i18n_label?(base_name, fields)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3197" data-linenumber="44">
            
              <span class="hits">3197</span>
            

            
              
            

            <code class="ruby">      [render_field_line(fields), render_comment_line(fields)].compact.each do |line|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4716" data-linenumber="45">
            
              <span class="hits">4716</span>
            

            
              
            

            <code class="ruby">        @current_assessment_fields &lt;&lt; line</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def has_i18n_label?(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6399" data-linenumber="50">
            
              <span class="hits">6399</span>
            

            
              
            

            <code class="ruby">      I18n.exists?(&quot;forms.#{@current_assessment_type}.fields.#{field}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def has_any_i18n_label?(base_name, fields)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      # Check if any of the field variants have an i18n label</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      # Priority: base field, pass field, then base name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3197" data-linenumber="56">
            
              <span class="hits">3197</span>
            

            
              
            

            <code class="ruby">      fields[:base] &amp;&amp; has_i18n_label?(fields[:base]) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        fields[:pass] &amp;&amp; has_i18n_label?(fields[:pass]) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">        has_i18n_label?(base_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def determine_pass_value(fields, main_field, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="62">
            
              <span class="hits">3202</span>
            

            
              
                <span class="hits" title="then branch hit 2319 times">
                  then: 2319
                </span>
              
                <span class="hits" title="else branch hit 883 times">
                  else: 883
                </span>
              
            

            <code class="ruby">      return @current_assessment.send(fields[:pass]) if fields[:pass]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="883" data-linenumber="63">
            
              <span class="hits">883</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 883 times">
                  else: 883
                </span>
              
            

            <code class="ruby">      return value if main_field.to_s.end_with?(&quot;_pass&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="883" data-linenumber="64">
            
              <span class="hits">883</span>
            

            
              
            

            <code class="ruby">      nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="67">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def format_field_line(label, value, pass_value, is_pass_field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="68">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      parts = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      # For boolean fields that aren&#39;t pass/fail fields, don&#39;t show pass/fail indicator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="70">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      if [true, false].include?(value) &amp;&amp; !is_pass_field &amp;&amp; pass_value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
                <span class="hits" title="then branch hit 34 times">
                  then: 34
                </span>
              
            

            <code class="ruby">        # Just show the label and value for regular boolean fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="72">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">        parts &lt;&lt; bold(label)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="34" data-linenumber="73">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 34 times">
                  else: 34
                </span>
              
            

            <code class="ruby">        parts &lt;&lt; &quot;: #{value ? &quot;Yes&quot; : &quot;No&quot;}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
                <span class="hits" title="else branch hit 3168 times">
                  else: 3168
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3168" data-linenumber="75">
            
              <span class="hits">3168</span>
            

            
              
                <span class="hits" title="else branch hit 1731 times">
                  else: 1731
                </span>
              
                <span class="hits" title="then branch hit 1437 times">
                  then: 1437
                </span>
              
            

            <code class="ruby">        parts &lt;&lt; pass_fail_indicator(pass_value) unless pass_value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3168" data-linenumber="76">
            
              <span class="hits">3168</span>
            

            
              
            

            <code class="ruby">        parts &lt;&lt; bold(label)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3168" data-linenumber="77">
            
              <span class="hits">3168</span>
            

            
              
                <span class="hits" title="then branch hit 991 times">
                  then: 991
                </span>
              
                <span class="hits" title="else branch hit 2177 times">
                  else: 2177
                </span>
              
            

            <code class="ruby">        parts &lt;&lt; &quot;: #{value}&quot; if !is_pass_field &amp;&amp; value.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="79">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      parts.join</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="82">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def pass_fail_indicator(pass_value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1437" data-linenumber="83">
            
              <span class="hits">1437</span>
            

            
              
                <span class="hits" title="when branch hit 1429 times">
                  when: 1429
                </span>
              
            

            <code class="ruby">      indicator, color = case pass_value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1429" data-linenumber="84">
            
              <span class="hits">1429</span>
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">      when true, &quot;pass&quot; then [I18n.t(&quot;shared.pass_pdf&quot;), Configuration::PASS_COLOR]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="85">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      when false, &quot;fail&quot; then [I18n.t(&quot;shared.fail_pdf&quot;), Configuration::FAIL_COLOR]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="86">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      else [I18n.t(&quot;shared.na_pdf&quot;), Configuration::NA_COLOR]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1437" data-linenumber="88">
            
              <span class="hits">1437</span>
            

            
              
            

            <code class="ruby">      &quot;&lt;font name=&#39;Courier&#39;&gt;#{bold(colored(indicator, color))}&lt;/font&gt; &quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="91">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def colored(text, color) = &quot;&lt;color rgb=&#39;#{color}&#39;&gt;#{text}&lt;/color&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="93">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def bold(text) = &quot;&lt;b&gt;#{text}&lt;/b&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="95">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def italic(text) = &quot;&lt;i&gt;#{text}&lt;/i&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def field_label(field_name) = I18n.t!(&quot;forms.#{@current_assessment_type}.fields.#{field_name}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="17" data-linenumber="99">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    def pass_fail(value) = I18n.t(value ? &quot;shared.pass_pdf&quot; : &quot;shared.fail_pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="101">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    public</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="103">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def extract_base_field_name(field_str)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9877" data-linenumber="104">
            
              <span class="hits">9877</span>
            

            
              
            

            <code class="ruby">      field_str.sub(/_(pass|comment)$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="107">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def group_assessment_fields(field_keys)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="388" data-linenumber="108">
            
              <span class="hits">388</span>
            

            
              
            

            <code class="ruby">      field_keys.each_with_object({}) do |field, groups|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7557" data-linenumber="109">
            
              <span class="hits">7557</span>
            

            
              
            

            <code class="ruby">        field_str = field.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7557" data-linenumber="110">
            
              <span class="hits">7557</span>
            

            
              
                <span class="hits" title="else branch hit 7555 times">
                  else: 7555
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">        next unless @current_assessment.respond_to?(field_str)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7555" data-linenumber="112">
            
              <span class="hits">7555</span>
            

            
              
            

            <code class="ruby">        base_field = extract_base_field_name(field_str)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7555" data-linenumber="113">
            
              <span class="hits">7555</span>
            

            
              
            

            <code class="ruby">        groups[base_field] ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7555" data-linenumber="115">
            
              <span class="hits">7555</span>
            

            
              
                <span class="hits" title="when branch hit 2318 times">
                  when: 2318
                </span>
              
            

            <code class="ruby">        field_type = case field_str</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2318" data-linenumber="116">
            
              <span class="hits">2318</span>
            

            
              
                <span class="hits" title="when branch hit 3583 times">
                  when: 3583
                </span>
              
            

            <code class="ruby">        when /pass$/ then :pass</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3583" data-linenumber="117">
            
              <span class="hits">3583</span>
            

            
              
                <span class="hits" title="else branch hit 1654 times">
                  else: 1654
                </span>
              
            

            <code class="ruby">        when /comment$/ then :comment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1654" data-linenumber="118">
            
              <span class="hits">1654</span>
            

            
              
            

            <code class="ruby">        else :base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7555" data-linenumber="121">
            
              <span class="hits">7555</span>
            

            
              
            

            <code class="ruby">        groups[base_field][field_type] = field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="125">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def render_field_line(fields)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="126">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      main_field = fields[:base] || fields[:pass]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3202" data-linenumber="127">
            
              <span class="hits">3202</span>
            

            
              
                <span class="hits" title="else branch hit 3202 times">
                  else: 3202
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return unless main_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="129">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      value = @current_assessment.send(main_field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">      # Try to get label in priority order: base field, pass field, base name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="131">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      label = get_field_label(fields)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="132">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      pass_value = determine_pass_value(fields, main_field, value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="134">
            
              <span class="hits">3202</span>
            

            
              
            

            <code class="ruby">      format_field_line(label, value, pass_value, main_field.to_s.end_with?(&quot;_pass&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="137">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def get_field_label(fields)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="138">
            
              <span class="hits">3202</span>
            

            
              
                <span class="hits" title="then branch hit 2319 times">
                  then: 2319
                </span>
              
                <span class="hits" title="else branch hit 883 times">
                  else: 883
                </span>
              
            

            <code class="ruby">      base_name = extract_base_field_name(fields[:pass].to_s) if fields[:pass]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">      # Try in order: base field, pass field, base name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3202" data-linenumber="141">
            
              <span class="hits">3202</span>
            

            
              
                <span class="hits" title="then branch hit 1656 times">
                  then: 1656
                </span>
              
            

            <code class="ruby">      if fields[:base] &amp;&amp; has_i18n_label?(fields[:base])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1656" data-linenumber="142">
            
              <span class="hits">1656</span>
            

            
              
                <span class="hits" title="else branch hit 1546 times">
                  else: 1546
                </span>
              
            

            <code class="ruby">        field_label(fields[:base])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1546" data-linenumber="143">
            
              <span class="hits">1546</span>
            

            
              
                <span class="hits" title="then branch hit 1546 times">
                  then: 1546
                </span>
              
            

            <code class="ruby">      elsif fields[:pass] &amp;&amp; has_i18n_label?(fields[:pass])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1546" data-linenumber="144">
            
              <span class="hits">1546</span>
            

            
              
            

            <code class="ruby">        field_label(fields[:pass])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="145">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            

            
              
            

            <code class="ruby">        field_label(base_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="150">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def render_comment_line(fields)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3200" data-linenumber="151">
            
              <span class="hits">3200</span>
            

            
              
                <span class="hits" title="else branch hit 2923 times">
                  else: 2923
                </span>
              
                <span class="hits" title="then branch hit 277 times">
                  then: 277
                </span>
              
            

            <code class="ruby">      return unless fields[:comment]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2923" data-linenumber="152">
            
              <span class="hits">2923</span>
            

            
              
            

            <code class="ruby">      comment = @current_assessment.send(fields[:comment])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2923" data-linenumber="153">
            
              <span class="hits">2923</span>
            

            
              
                <span class="hits" title="then branch hit 1403 times">
                  then: 1403
                </span>
              
                <span class="hits" title="else branch hit 1520 times">
                  else: 1520
                </span>
              
            

            <code class="ruby">      return if comment.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1520" data-linenumber="155">
            
              <span class="hits">1520</span>
            

            
              
            

            <code class="ruby">      &quot;    #{colored(italic(comment), COMMENT_COLOR)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="158">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def generate_assessment_section(pdf, assessment_type, assessment)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="386" data-linenumber="159">
            
              <span class="hits">386</span>
            

            
              
                <span class="hits" title="else branch hit 386 times">
                  else: 386
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      raise ArgumentError, &quot;Assessment missing: #{assessment_type}&quot; unless assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="161">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      @current_assessment_type = assessment_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="162">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      @current_assessment = assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="163">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      @current_assessment_fields = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="165">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      render_fields_from_i18n</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="167">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      @current_assessment_blocks &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">        title: I18n.t(&quot;forms.#{assessment_type}.header&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">        fields: @current_assessment_fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="173">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def render_all_assessments_in_columns(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="56" data-linenumber="174">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 56 times">
                  else: 56
                </span>
              
            

            <code class="ruby">      return if @current_assessment_blocks.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="176">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      pdf.text I18n.t(&quot;pdf.inspection.assessments_section&quot;), size: SECTION_TITLE_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="177">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="178">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      pdf.move_down SECTION_MARGIN_AFTER_TITLE</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="180">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      pdf.column_box([0, pdf.cursor], columns: COLUMN_COUNT, width: pdf.bounds.width, spacer: COLUMN_SPACER) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="442" data-linenumber="181">
            
              <span class="hits">442</span>
            

            
              
            

            <code class="ruby">        @current_assessment_blocks.each { |block| render_assessment_block(pdf, block) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="184">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      @current_assessment_blocks = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="185">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      pdf.move_down SECTION_MARGIN_AFTER</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="188">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def render_assessment_block(pdf, block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="189">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      pdf.text block[:title], size: ASSESSMENT_TITLE_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="190">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      pdf.move_down ASSESSMENT_MARGIN_AFTER_TITLE</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5100" data-linenumber="192">
            
              <span class="hits">5100</span>
            

            
              
            

            <code class="ruby">      block[:fields].each { |field| pdf.text field, size: FIELD_TEXT_SIZE, inline_format: true }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="386" data-linenumber="193">
            
              <span class="hits">386</span>
            

            
              
            

            <code class="ruby">      pdf.move_down ASSESSMENT_MARGIN_AFTER</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fd6fb10c579b55dade9859adfb49fc9c70872ae2">
  <div class="header">
    <h3>app/services/pdf_generator_service/configuration.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>51</b> relevant lines.
      <span class="green"><b>51</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">    # Unit table constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    UNIT_LABEL_COLUMN_WIDTH = 100</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    UNIT_NAME_MAX_LENGTH = 30</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    UNIT_TABLE_CELL_PADDING = [6, 4]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    UNIT_TABLE_TEXT_SIZE = 9</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    # General text and spacing constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HEADER_TEXT_SIZE = 12</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HEADER_SPACING = 8</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    STATUS_TEXT_SIZE = 14</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    STATUS_SPACING = 15</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    SECTION_TITLE_SIZE = 14</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    COMMENTS_PADDING = 20</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    # Header table constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    LOGO_HEIGHT = 50</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HEADER_TABLE_PADDING = [5, 0]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    LOGO_COLUMN_WIDTH_RATIO = 1.0 / 3.0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    # Table constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    TABLE_CELL_PADDING = [5, 10]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    TABLE_FIRST_COLUMN_WIDTH = 150</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    NICE_TABLE_CELL_PADDING = [4, 8]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    NICE_TABLE_TEXT_SIZE = 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    # Inspection history table styling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="29">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_TABLE_TEXT_SIZE = 8</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_TABLE_HEADER_COLOR = &quot;F5F5F5&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_TABLE_ROW_COLOR = &quot;FAFAFA&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_TABLE_ALT_ROW_COLOR = &quot;F0F0F0&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    PASS_COLOR = &quot;008000&quot;  # Green</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="34">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    FAIL_COLOR = &quot;CC0000&quot;  # Red</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    NA_COLOR = &quot;4169E1&quot;  # Royal Blue</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HEADER_COLOR = &quot;663399&quot;  # Purple</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="37">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    SUBTITLE_COLOR = &quot;666666&quot;  # Gray</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    # Inspection history table column widths</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_DATE_COLUMN_WIDTH = 90      # Date column (DD/MM/YYYY) - slightly wider</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="41">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_RESULT_COLUMN_WIDTH = 45    # Result column (PASS/FAIL) - narrower</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_INSPECTOR_WIDTH_PERCENT = 0.5  # 50% of remaining space</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    HISTORY_LOCATION_WIDTH_PERCENT = 0.5   # 50% of remaining space</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    # Assessment layout constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="46">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_COLUMNS_COUNT = 3</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_COLUMN_SPACER = 10</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="48">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_TITLE_SIZE = 10</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_FIELD_TEXT_SIZE = 7</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ASSESSMENT_BLOCK_SPACING = 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    # QR Code constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    QR_CODE_SIZE = 80</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    QR_CODE_MARGIN = 0  # No margin - align with table right edge</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="55">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    QR_CODE_BOTTOM_OFFSET = HEADER_SPACING  # Match header spacing from top</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    # Unit photo constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="58">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    UNIT_PHOTO_X_OFFSET = 130</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="59">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    UNIT_PHOTO_WIDTH = 120</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="60">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    UNIT_PHOTO_HEIGHT = 90</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    # Watermark constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="63">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    WATERMARK_TRANSPARENCY = 0.4</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="64">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    WATERMARK_TEXT_SIZE = 24</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    WATERMARK_WIDTH = 100</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="66">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    WATERMARK_HEIGHT = 60</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="68">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.setup_pdf_fonts(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="69">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">      font_path = Rails.root.join(&quot;app/assets/fonts&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="70">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">      pdf.font_families.update(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">        &quot;NotoSans&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">          normal: &quot;#{font_path}/NotoSans-Regular.ttf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">          bold: &quot;#{font_path}/NotoSans-Bold.ttf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">          italic: &quot;#{font_path}/NotoSans-Regular.ttf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">          bold_italic: &quot;#{font_path}/NotoSans-Bold.ttf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        &quot;NotoEmoji&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">          normal: &quot;#{font_path}/NotoEmoji-Regular.ttf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="81">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">      pdf.font &quot;NotoSans&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="840cf6ad9593096c87f1e41467114585e586efe4">
  <div class="header">
    <h3>app/services/pdf_generator_service/debug_info_renderer.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>3</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class DebugInfoRenderer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.add_debug_info_page(pdf, queries)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="6">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      return if queries.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      # Start a new page for debug info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="9">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.start_new_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      # Header</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="12">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.text I18n.t(&quot;debug.title&quot;), size: HEADER_TEXT_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="13">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="14">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      # Summary info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="17">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;debug.query_count&quot;)}: #{queries.size}&quot;, size: NICE_TABLE_TEXT_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="18">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      # Build table data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      table_data = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="22">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        [I18n.t(&quot;debug.query&quot;), I18n.t(&quot;debug.duration&quot;), I18n.t(&quot;debug.name&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="25">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      queries.each do |query|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="26">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">        table_data &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">          query[:sql],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">          &quot;#{query[:duration]} ms&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">          query[:name] || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      # Create the table</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="34">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.table(table_data, width: pdf.bounds.width) do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        # Header row styling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="36">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.row(0).background_color = &quot;333333&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="37">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.row(0).text_color = &quot;FFFFFF&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="38">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.row(0).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">        # General styling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="41">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.cells.borders = [:bottom]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="42">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.cells.border_color = &quot;DDDDDD&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="43">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.cells.padding = TABLE_CELL_PADDING</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="44">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.cells.size = 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">        # Column widths</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="47">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.columns(0).width = pdf.bounds.width * 0.6  # Query column gets most space</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="48">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.columns(1).width = pdf.bounds.width * 0.2  # Duration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="49">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        t.columns(2).width = pdf.bounds.width * 0.2  # Name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">        # Alternating row colors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="52">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        (1..table_data.length - 1).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="53">
            
              <span class="hits">47</span>
            

            
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 22 times">
                  else: 22
                </span>
              
            

            <code class="ruby">          t.row(i).background_color = i.odd? ? &quot;FFFFFF&quot; : &quot;F5F5F5&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3e5148bd8bf37599768889d24ffd3045268ef40b">
  <div class="header">
    <h3>app/services/pdf_generator_service/header_generator.rb</h3>
    <h4>
      <span class="yellow">
  84.72%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  63.64%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>72</b> relevant lines.
      <span class="green"><b>61</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>22</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class HeaderGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.generate_inspection_pdf_header(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="6">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      create_inspection_header(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.create_inspection_header(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="10">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      inspector_user = inspection.user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="11">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      report_id_text = build_report_id_text(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="12">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      status_text, status_color = build_status_text_and_color(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="14">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      logo_width, logo_temp = prepare_logo(inspector_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="16">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      render_inspection_header_layout(pdf, inspection, report_id_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        status_text, status_color,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        logo_width, logo_temp)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="56" data-linenumber="20">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 56 times">
                  else: 56
                </span>
              
            

            <code class="ruby">      logo_temp&amp;.unlink</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="21">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">      pdf.move_down Configuration::STATUS_SPACING</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.generate_unit_pdf_header(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="25">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      create_unit_header(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.create_unit_header(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="29">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      user = unit.user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="30">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      unit_id_text = build_unit_id_text(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="32">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      logo_width, logo_temp = prepare_logo(user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="34">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      render_unit_header_layout(pdf, unit, unit_id_text, logo_width, logo_temp)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="32" data-linenumber="36">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 32 times">
                  else: 32
                </span>
              
            

            <code class="ruby">      logo_temp&amp;.unlink</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="37">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      pdf.move_down Configuration::STATUS_SPACING</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="41">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def build_report_id_text(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="44">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">        &quot;#{I18n.t(&quot;pdf.inspection.fields.report_id&quot;)}: #{inspection.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def build_status_text_and_color(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="56" data-linenumber="48">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        case inspection.passed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
                <span class="hits" title="when branch hit 50 times">
                  when: 50
                </span>
              
            

            <code class="ruby">        when true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="50">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">          [I18n.t(&quot;pdf.inspection.passed&quot;), Configuration::PASS_COLOR]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">        when false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="52">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">          [I18n.t(&quot;pdf.inspection.failed&quot;), Configuration::FAIL_COLOR]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">        when nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="54">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          [I18n.t(&quot;pdf.inspection.in_progress&quot;), Configuration::NA_COLOR]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="58">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def build_unit_id_text(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="59">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">        &quot;#{I18n.t(&quot;pdf.unit.fields.unit_id&quot;)}: #{unit.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="62">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def prepare_logo(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="88" data-linenumber="63">
            
              <span class="hits">88</span>
            

            
              
                <span class="hits" title="then branch hit 88 times">
                  then: 88
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 88 times">
                  then: 88
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 88 times">
                  then: 88
                </span>
              
            

            <code class="ruby">        return [0, nil] unless user&amp;.logo&amp;.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">        logo_data = user.logo.download</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">        logo_height = Configuration::LOGO_HEIGHT</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            
              
            

            <code class="ruby">        logo_width = logo_height * 2 + 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            

            
              
            

            <code class="ruby">        logo_temp = Tempfile.new([&quot;user_logo_#{user.id}&quot;, &quot;.png&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            

            
              
            

            <code class="ruby">        logo_temp.binmode</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            

            
              
            

            <code class="ruby">        logo_temp.write(logo_data)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">        logo_temp.close</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            

            
              
            

            <code class="ruby">        [logo_width, logo_temp]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="77">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def render_inspection_header_layout(pdf, inspection, report_id_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        status_text, status_color,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        logo_width, logo_temp)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="80">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">        pdf.bounding_box([0, pdf.cursor], width: pdf.bounds.width) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="81">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">          render_inspection_text_section(pdf, inspection, report_id_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">            status_text, status_color, logo_width)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="56" data-linenumber="83">
            
              <span class="hits">56</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 56 times">
                  else: 56
                </span>
              
            

            <code class="ruby">          render_logo_section(pdf, logo_temp, logo_width) if logo_temp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="87">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def render_inspection_text_section(pdf, inspection, report_id_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">        status_text, status_color, logo_width)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="89">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">        width = pdf.bounds.width - logo_width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="90">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">        pdf.bounding_box([0, pdf.bounds.top], width: width) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="91">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">          pdf.text report_id_text, size: Configuration::HEADER_TEXT_SIZE,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">            style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="93">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">          pdf.text status_text, size: Configuration::HEADER_TEXT_SIZE,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">            style: :bold,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">            color: status_color</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="97">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">          expiry_label = I18n.t(&quot;pdf.inspection.fields.expiry_date&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="98">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">          expiry_value = Utilities.format_date(inspection.reinspection_date)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="99">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">          pdf.text &quot;#{expiry_label}: #{expiry_value}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">            size: Configuration::HEADER_TEXT_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="104">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def render_unit_header_layout(pdf, unit, unit_id_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">        logo_width, logo_temp)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="106">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">        pdf.bounding_box([0, pdf.cursor], width: pdf.bounds.width) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="107">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">          render_unit_text_section(pdf, unit, unit_id_text, logo_width)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="32" data-linenumber="108">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 32 times">
                  else: 32
                </span>
              
            

            <code class="ruby">          render_logo_section(pdf, logo_temp, logo_width) if logo_temp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="112">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def render_unit_text_section(pdf, unit, unit_id_text, logo_width)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="113">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">        width = pdf.bounds.width - logo_width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="114">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">        pdf.bounding_box([0, pdf.bounds.top], width: width) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="115">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">          pdf.text unit_id_text, size: Configuration::HEADER_TEXT_SIZE,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">            style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="118">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">          expiry_label = I18n.t(&quot;pdf.unit.fields.expiry_date&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="119">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 26 times">
                  else: 26
                </span>
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">          expiry_value = if unit.last_inspection&amp;.reinspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="120">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">            Utilities.format_date(unit.last_inspection.reinspection_date)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
                <span class="hits" title="else branch hit 26 times">
                  else: 26
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="122">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">            I18n.t(&quot;pdf.unit.fields.na&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="124">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">          pdf.text &quot;#{expiry_label}: #{expiry_value}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">            size: Configuration::HEADER_TEXT_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="129">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      def render_logo_section(pdf, logo_temp, logo_width)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            

            
              
            

            <code class="ruby">        x_position = pdf.bounds.width - logo_width + 10</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            

            
              
            

            <code class="ruby">        pdf.bounding_box([x_position, pdf.bounds.top],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">          width: logo_width - 10) do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            

            
              
            

            <code class="ruby">          pdf.image logo_temp.path, height: Configuration::LOGO_HEIGHT,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">            position: :right</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9527a4daec2ab239f019b3f52dbc311d3914f70d">
  <div class="header">
    <h3>app/services/pdf_generator_service/image_orientation_processor.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>13</b> relevant lines.
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class ImageOrientationProcessor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    require &quot;mini_magick&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Process image to handle EXIF orientation data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.process_with_orientation(image)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="7">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      image.auto_orient</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="8">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      image.to_blob</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    # Get image dimensions after applying EXIF orientation correction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.get_dimensions(image)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="13">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      image = image.dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      image.auto_orient</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      [image.width, image.height]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    # Check if image needs orientation correction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.needs_orientation_correction?(image)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="20">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      orientation = image.exif[&quot;Orientation&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      # Orientations 2-8 need correction, 1 is normal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="22">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="then branch hit 11 times">
                  then: 11
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      orientation ? orientation.to_i &gt; 1 : false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9cdbc1b55897061ede249f42bf31afc895eb4788">
  <div class="header">
    <h3>app/services/pdf_generator_service/image_processor.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  83.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>37</b> relevant lines.
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>10</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class ImageProcessor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Unified QR code generator for any entity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.generate_qr_code_footer(pdf, entity)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="94" data-linenumber="7">
            
              <span class="hits">94</span>
            

            
              
            

            <code class="ruby">      entity_type = entity.class.name.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="94" data-linenumber="8">
            
              <span class="hits">94</span>
            

            
              
            

            <code class="ruby">      qr_code_png = QrCodeService.generate_qr_code(entity)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="9">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">      qr_code_temp_file = Tempfile.new([&quot;qr_code_#{entity_type}_#{entity.id}_#{Process.pid}&quot;, &quot;.png&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="12">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        qr_code_temp_file.binmode</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="13">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        qr_code_temp_file.write(qr_code_png)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="14">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        qr_code_temp_file.close</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">        # Calculate positions using PositionCalculator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="17">
            
              <span class="hits">93</span>
            

            
              
                <span class="hits" title="then branch hit 58 times">
                  then: 58
                </span>
              
                <span class="hits" title="else branch hit 35 times">
                  else: 35
                </span>
              
            

            <code class="ruby">        photo_entity = entity.is_a?(Inspection) ? entity.unit : entity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="18">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        qr_x, qr_y = PositionCalculator.qr_code_position(pdf.bounds.width)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        # Add entity photo first (so it&#39;s behind the QR code)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="21">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        add_entity_photo_footer(pdf, photo_entity, qr_x, qr_y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        # Add QR code on top with transparency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="24">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">        pdf.transparent(0.5) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="25">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">          qr_width, qr_height = PositionCalculator.qr_code_dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="93" data-linenumber="26">
            
              <span class="hits">93</span>
            

            
              
            

            <code class="ruby">          pdf.image qr_code_temp_file.path, at: [qr_x, qr_y], width: qr_width, height: qr_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="93" data-linenumber="29">
            
              <span class="hits">93</span>
            

            
              
                <span class="hits" title="else branch hit 93 times">
                  else: 93
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        qr_code_temp_file.close unless qr_code_temp_file.closed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="93" data-linenumber="30">
            
              <span class="hits">93</span>
            

            
              
                <span class="hits" title="then branch hit 93 times">
                  then: 93
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        qr_code_temp_file.unlink if File.exist?(qr_code_temp_file.path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    # Process image to handle EXIF orientation data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.process_image_with_orientation(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="36">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      image = create_image(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="37">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      ImageOrientationProcessor.process_with_orientation(image)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    # Add entity photo in footer area (below QR code)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="41">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.add_entity_photo_footer(pdf, entity, qr_x, qr_y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      # Early return if entity is nil or photo is not properly loaded</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="96" data-linenumber="43">
            
              <span class="hits">96</span>
            

            
              
                <span class="hits" title="then branch hit 94 times">
                  then: 94
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="else branch hit 94 times">
                  else: 94
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">      return unless entity&amp;.photo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      # Check if attachment is loaded to avoid N+1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="94" data-linenumber="46">
            
              <span class="hits">94</span>
            

            
              
            

            <code class="ruby">      attachment = entity.photo</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="94" data-linenumber="47">
            
              <span class="hits">94</span>
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
                <span class="hits" title="then branch hit 83 times">
                  then: 83
                </span>
              
            

            <code class="ruby">      return unless attachment.blob</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      # Download blob data only once and create image</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="50">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      image_data = attachment.blob.download</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="51">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      image = MiniMagick::Image.read(image_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      # Get original image dimensions (without duplicating)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="54">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      original_width = image.width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="55">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      original_height = image.height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      # Calculate photo dimensions maintaining aspect ratio</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="58">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      photo_width, photo_height = PositionCalculator.footer_photo_dimensions(original_width, original_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      # Calculate position based on photo dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="61">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      photo_x, photo_y = PositionCalculator.photo_footer_position(qr_x, qr_y, photo_width, photo_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">      # Process image for orientation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="64">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      image.auto_orient</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="65">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      processed_image = image.to_blob</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="67">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      pdf.image StringIO.new(processed_image), at: [photo_x, photo_y], width: photo_width, height: photo_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.create_image(attachment)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      # Download blob data only once</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="72">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      image_data = attachment.blob.download</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="73">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      MiniMagick::Image.read(image_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="368ed9e9bade823b5080a332bb1f0fc20812f43b">
  <div class="header">
    <h3>app/services/pdf_generator_service/position_calculator.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>39</b> relevant lines.
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>10</b> total branches, </span>
          <span class="green"><b>10</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class PositionCalculator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Calculate QR code position in bottom right corner</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    # QR code&#39;s bottom-right corner aligns with table right edge, bottom matches header spacing from top</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.qr_code_position(pdf_bounds_width)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="8">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">      x = pdf_bounds_width - QR_CODE_SIZE - QR_CODE_MARGIN</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="9">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">      y = QR_CODE_BOTTOM_OFFSET + QR_CODE_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="97" data-linenumber="10">
            
              <span class="hits">97</span>
            

            
              
            

            <code class="ruby">      [x, y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    # Calculate photo position aligned with QR code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    # Photo width is twice QR code size, height maintains aspect ratio</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    # Photo&#39;s bottom-right corner aligns with QR code&#39;s bottom-right corner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.photo_footer_position(qr_x, qr_y, photo_width = nil, photo_height = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="17">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      photo_width ||= QR_CODE_SIZE * 2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="18">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      photo_height ||= photo_width # Default to square if no height provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      # Photo&#39;s right edge aligns with QR&#39;s right edge (both align with table right edge)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="21">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      photo_x = qr_x + QR_CODE_SIZE - photo_width</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      # Photo&#39;s bottom edge aligns with QR&#39;s bottom edge (both match header spacing)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="24">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      photo_y = qr_y - QR_CODE_SIZE + photo_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="26">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      [photo_x, photo_y]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    # Calculate photo dimensions for footer (width = 2x QR size, height maintains aspect ratio)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    # Note: original_width and original_height should be post-EXIF-rotation dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.footer_photo_dimensions(original_width, original_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="32">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      target_width = QR_CODE_SIZE * 2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="34">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
            

            <code class="ruby">      return [target_width, target_width] if original_width.zero? || original_height.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="36">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      aspect_ratio = calculate_aspect_ratio(original_width, original_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="37">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      target_height = (target_width / aspect_ratio).round</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="39">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      [target_width, target_height]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    # Get QR code dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.qr_code_dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="94" data-linenumber="44">
            
              <span class="hits">94</span>
            

            
              
            

            <code class="ruby">      [QR_CODE_SIZE, QR_CODE_SIZE]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    # Check if coordinates are within PDF bounds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="48">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.within_bounds?(x, y, width, height, pdf_bounds_width, pdf_bounds_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="49">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      x &gt;= 0 &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">        y &gt;= 0 &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="51">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        (x + width) &lt;= pdf_bounds_width &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="52">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        (y + height) &lt;= pdf_bounds_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">    # Calculate aspect ratio for image fitting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="56">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.calculate_aspect_ratio(original_width, original_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="57">
            
              <span class="hits">27</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 26 times">
                  else: 26
                </span>
              
            

            <code class="ruby">      return 1.0 if original_height.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="58">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      original_width.to_f / original_height.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    # Calculate dimensions to fit within constraints while maintaining aspect ratio</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="62">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.fit_dimensions(original_width, original_height, max_width, max_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="63">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
            

            <code class="ruby">      return [max_width, max_height] if original_width.zero? || original_height.zero?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      # If original already fits within constraints, return original dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="66">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">      if original_width &lt;= max_width &amp;&amp; original_height &lt;= max_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        return [original_width, original_height]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="70">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      aspect_ratio = calculate_aspect_ratio(original_width, original_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      # Try fitting by width first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="73">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      fitted_width = max_width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="74">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      fitted_height = (fitted_width / aspect_ratio).round</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      # If height is too big, fit by height instead</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="77">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      if fitted_height &gt; max_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="78">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        fitted_height = max_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="79">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        fitted_width = (fitted_height * aspect_ratio).round</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="82">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      [fitted_width, fitted_height]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3d98c406fa7ebc25db769ceef09467c2481ec671">
  <div class="header">
    <h3>app/services/pdf_generator_service/table_builder.rb</h3>
    <h4>
      <span class="green">
  99.25%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  89.66%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>133</b> relevant lines.
      <span class="green"><b>132</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>58</b> total branches, </span>
          <span class="green"><b>52</b> branches covered</span> and
          <span class="red"><b>6</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class TableBuilder</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.create_pdf_table(pdf, data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="8">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      table = pdf.table(data, width: pdf.bounds.width) do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="9">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        t.cells.borders = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="10">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        t.cells.padding = TABLE_CELL_PADDING</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="11">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        t.columns(0).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="12">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        t.columns(0).width = TABLE_FIRST_COLUMN_WIDTH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="13">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).background_color = &quot;EEEEEE&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="14">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).borders = [:bottom]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="15">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).border_color = &quot;DDDDDD&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="18">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      yield table if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="19">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.create_nice_box_table(pdf, title, data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="23">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      pdf.text title, size: HEADER_TEXT_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="24">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="25">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="27">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      table = pdf.table(data, width: pdf.bounds.width) do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="28">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.cells.borders = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="29">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.cells.padding = NICE_TABLE_CELL_PADDING</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="30">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.cells.size = NICE_TABLE_TEXT_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="31">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.columns(0).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="32">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.columns(0).width = TABLE_FIRST_COLUMN_WIDTH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="33">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).background_color = &quot;EEEEEE&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="34">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).borders = [:bottom]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="35">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).border_color = &quot;DDDDDD&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="38">
            
              <span class="hits">30</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 29 times">
                  else: 29
                </span>
              
            

            <code class="ruby">      yield table if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="39">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 15</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="40">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.create_unit_details_table(pdf, title, data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="44">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">      pdf.text title, size: HEADER_TEXT_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="45">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">      pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="46">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      # Check if it&#39;s a 2-column table (unit PDF) or 4-column table (inspection PDF)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="49">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">      is_unit_pdf = data.first.length == 2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="51">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">      table = pdf.table(data, width: pdf.bounds.width) do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="52">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        t.cells.borders = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="53">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        t.cells.padding = UNIT_TABLE_CELL_PADDING</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="54">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        t.cells.size = UNIT_TABLE_TEXT_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="56">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        t.columns(0).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="57">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        if is_unit_pdf</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
                <span class="hits" title="then branch hit 32 times">
                  then: 32
                </span>
              
            

            <code class="ruby">          # Simple 2-column layout for unit PDFs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="59">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">          t.columns(0).width = UNIT_LABEL_COLUMN_WIDTH</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">          # 4-column layout for inspection PDFs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
                <span class="hits" title="else branch hit 58 times">
                  else: 58
                </span>
              
            

            <code class="ruby">          # Make label columns (0 and 2) bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="63">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          t.columns(2).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">          # Set column widths - labels just fit content, values take remaining space</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="65">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          t.columns(0).width = UNIT_LABEL_COLUMN_WIDTH   # Description label</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="66">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          t.columns(2).width = UNIT_LABEL_COLUMN_WIDTH   # Serial/Type/Owner labels</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="67">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          remaining_width = pdf.bounds.width - (UNIT_LABEL_COLUMN_WIDTH * 2) # Total minus both label columns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="68">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          t.columns(1).width = remaining_width / 2  # Description value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="69">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">          t.columns(3).width = remaining_width / 2  # Serial/Type/Owner values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="72">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).background_color = &quot;EEEEEE&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="73">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).borders = [:bottom]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="74">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        t.row(0..data.length - 1).border_color = &quot;DDDDDD&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="91" data-linenumber="77">
            
              <span class="hits">91</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 91 times">
                  else: 91
                </span>
              
            

            <code class="ruby">      yield table if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="78">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 15</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="79">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">      table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="82">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.create_inspection_history_table(pdf, title, inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="83">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      pdf.text title, size: HEADER_TEXT_SIZE, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="84">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="85">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      # Prepare table data with header row</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="88">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      table_data = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      # Header row</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="91">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      table_data &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.unit.fields.date&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.unit.fields.result&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.unit.fields.inspector&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.inspection.fields.inspection_location&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      # Data rows</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="99">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      inspections.each do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="100">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">        inspector_name = inspection.user.name || I18n.t(&quot;pdf.unit.fields.na&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="101">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">        rpii_number = inspection.user.rpii_inspector_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">        # Combine inspector name with RPII number if present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="104">
            
              <span class="hits">36</span>
            

            
              
                <span class="hits" title="then branch hit 36 times">
                  then: 36
                </span>
              
            

            <code class="ruby">        inspector_text = if rpii_number.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="105">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">          &quot;#{inspector_name} (#{I18n.t(&quot;pdf.inspection.fields.rpii_inspector_no&quot;)} #{rpii_number})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="106">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            

            
              
            

            <code class="ruby">          inspector_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="110">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">        table_data &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">          Utilities.format_date(inspection.inspection_date),</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="112">
            
              <span class="hits">36</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">          if inspection.passed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="113">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">            I18n.t(&quot;shared.pass_pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
                <span class="hits" title="else branch hit 19 times">
                  else: 19
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="115">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">            I18n.t(&quot;shared.fail_pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">          end,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">          inspector_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">          inspection.inspection_location || I18n.t(&quot;pdf.unit.fields.na&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      # Create table with enhanced styling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="123">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      table = pdf.table(table_data, width: pdf.bounds.width) do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="124">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        t.cells.padding = NICE_TABLE_CELL_PADDING</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="125">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        t.cells.size = HISTORY_TABLE_TEXT_SIZE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="126">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        t.cells.border_width = 0.5</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="127">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        t.cells.border_color = &quot;CCCCCC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">        # Header row styling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="130">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        t.row(0).background_color = HISTORY_TABLE_HEADER_COLOR</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="131">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        t.row(0).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">        # Alternating row colors for data rows (skip header row)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="134">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        (1...table_data.length).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="135">
            
              <span class="hits">36</span>
            

            
              
                <span class="hits" title="then branch hit 24 times">
                  then: 24
                </span>
              
            

            <code class="ruby">          t.row(i).background_color = if i.odd?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="136">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">            HISTORY_TABLE_ROW_COLOR</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="138">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">            HISTORY_TABLE_ALT_ROW_COLOR</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">          # Color and style the result column (index 1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="142">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">          result_cell = t.row(i).column(1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="143">
            
              <span class="hits">36</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">          if table_data[i][1] == I18n.t(&quot;shared.pass_pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="144">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">            result_cell.text_color = PASS_COLOR</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="145">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="else branch hit 19 times">
                  else: 19
                </span>
              
            

            <code class="ruby">            result_cell.font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="19" data-linenumber="146">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          elsif table_data[i][1] == I18n.t(&quot;shared.fail_pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="147">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">            result_cell.text_color = FAIL_COLOR</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="148">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">            result_cell.font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">        # Column widths - specific widths for date and result; others fill remaining space</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="153">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        remaining_width = pdf.bounds.width - HISTORY_DATE_COLUMN_WIDTH - HISTORY_RESULT_COLUMN_WIDTH</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="154">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        inspector_width = remaining_width * HISTORY_INSPECTOR_WIDTH_PERCENT</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="155">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        location_width = remaining_width * HISTORY_LOCATION_WIDTH_PERCENT</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="157">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        t.column_widths = [HISTORY_DATE_COLUMN_WIDTH, HISTORY_RESULT_COLUMN_WIDTH, inspector_width, location_width]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="160">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 15</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="161">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="164">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.build_unit_details_table(unit, context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">      # Get dimensions from last inspection if available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="166">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">      last_inspection = unit.last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="167">
            
              <span class="hits">40</span>
            

            
              
                <span class="hits" title="then branch hit 32 times">
                  then: 32
                </span>
              
            

            <code class="ruby">      if context == :unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="168">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">        build_unit_details_table_for_unit_pdf(unit, last_inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="170">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        build_unit_details_table_with_inspection(unit, last_inspection, context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="174">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.build_unit_details_table_for_unit_pdf(unit, last_inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="175">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      dimensions = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="177">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 26 times">
                  else: 26
                </span>
              
            

            <code class="ruby">      if last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="178">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if last_inspection.width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="179">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          dimensions &lt;&lt; &quot;#{I18n.t(&quot;pdf.dimensions.width&quot;)}: #{Utilities.format_dimension(last_inspection.width)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="181">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if last_inspection.length.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="182">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          dimensions &lt;&lt; &quot;#{I18n.t(&quot;pdf.dimensions.length&quot;)}: #{Utilities.format_dimension(last_inspection.length)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="184">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if last_inspection.height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="185">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          dimensions &lt;&lt; &quot;#{I18n.t(&quot;pdf.dimensions.height&quot;)}: #{Utilities.format_dimension(last_inspection.height)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="188">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 26 times">
                  else: 26
                </span>
              
            

            <code class="ruby">      dimensions_text = dimensions.any? ? dimensions.join(&quot; &quot;) : &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">      # Build simple two-column table for unit PDFs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">      [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="192">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">        [I18n.t(&quot;pdf.inspection.fields.description&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">          Utilities.truncate_text(unit.name || unit.description || &quot;&quot;, UNIT_NAME_MAX_LENGTH)],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">        [I18n.t(&quot;pdf.inspection.fields.manufacturer&quot;), unit.manufacturer.presence || &quot;&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">        [I18n.t(&quot;pdf.inspection.fields.owner&quot;), unit.owner.presence || &quot;&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">        [I18n.t(&quot;pdf.inspection.fields.serial&quot;), unit.serial || &quot;&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">        [I18n.t(&quot;pdf.inspection.fields.size_m&quot;), dimensions_text]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="201">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.build_unit_details_table_with_inspection(unit, last_inspection, context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="202">
            
              <span class="hits">63</span>
            

            
              
            

            <code class="ruby">      dimensions = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="204">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      if last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="205">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="then branch hit 35 times">
                  then: 35
                </span>
              
                <span class="hits" title="else branch hit 20 times">
                  else: 20
                </span>
              
            

            <code class="ruby">        if last_inspection.width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="206">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">          dimensions &lt;&lt; &quot;#{I18n.t(&quot;pdf.dimensions.width&quot;)}: #{Utilities.format_dimension(last_inspection.width)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="208">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="then branch hit 35 times">
                  then: 35
                </span>
              
                <span class="hits" title="else branch hit 20 times">
                  else: 20
                </span>
              
            

            <code class="ruby">        if last_inspection.length.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="209">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">          dimensions &lt;&lt; &quot;#{I18n.t(&quot;pdf.dimensions.length&quot;)}: #{Utilities.format_dimension(last_inspection.length)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="211">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="then branch hit 35 times">
                  then: 35
                </span>
              
                <span class="hits" title="else branch hit 20 times">
                  else: 20
                </span>
              
            

            <code class="ruby">        if last_inspection.height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="212">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">          dimensions &lt;&lt; &quot;#{I18n.t(&quot;pdf.dimensions.height&quot;)}: #{Utilities.format_dimension(last_inspection.height)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="215">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 35 times">
                  then: 35
                </span>
              
                <span class="hits" title="else branch hit 28 times">
                  else: 28
                </span>
              
            

            <code class="ruby">      dimensions_text = dimensions.any? ? dimensions.join(&quot; &quot;) : &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">      # Get inspector details from current inspection (for inspection PDF) or last inspection (for unit PDF)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="218">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
            

            <code class="ruby">      inspection = if context == :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="219">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">        last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="221">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        unit.last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="223">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      inspector_name = inspection&amp;.user&amp;.name || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="224">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      rpii_number = inspection&amp;.user&amp;.rpii_inspector_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">      # Combine inspector name with RPII number if present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="227">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 52 times">
                  then: 52
                </span>
              
            

            <code class="ruby">      inspector_text = if rpii_number.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="228">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">        &quot;#{inspector_name} (#{I18n.t(&quot;pdf.inspection.fields.rpii_inspector_no&quot;)} #{rpii_number})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="230">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        inspector_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="233">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      inspection_location = inspection&amp;.inspection_location || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="234">
            
              <span class="hits">63</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
            

            <code class="ruby">      issued_date = if inspection&amp;.inspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="235">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">        Utilities.format_date(inspection.inspection_date)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="237">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">      # Build the table rows</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">      [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="243">
            
              <span class="hits">63</span>
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.description&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">          Utilities.truncate_text(unit.name || unit.description || &quot;&quot;, UNIT_NAME_MAX_LENGTH),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.inspected_by&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby">          inspector_text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.manufacturer&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">          unit.manufacturer.presence || &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.owner&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">          unit.owner.presence || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.size_m&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">          dimensions_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.inspection_location&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">          inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.serial&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">          unit.serial || &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;pdf.inspection.fields.issued_date&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">          issued_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="03069e536259f908b86d88f3ee878333004d07e8">
  <div class="header">
    <h3>app/services/pdf_generator_service/utilities.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  92.31%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>13</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class Utilities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    include Configuration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.truncate_text(text, max_length)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="104" data-linenumber="6">
            
              <span class="hits">104</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 102 times">
                  else: 102
                </span>
              
            

            <code class="ruby">      return &quot;&quot; if text.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="7">
            
              <span class="hits">102</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 97 times">
                  else: 97
                </span>
              
            

            <code class="ruby">      (text.length &gt; max_length) ? &quot;#{text[0...max_length]}...&quot; : text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.format_dimension(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="129" data-linenumber="11">
            
              <span class="hits">129</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 128 times">
                  else: 128
                </span>
              
            

            <code class="ruby">      return &quot;&quot; if value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="128" data-linenumber="12">
            
              <span class="hits">128</span>
            

            
              
            

            <code class="ruby">      value.to_s.sub(/\.0$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.format_date(date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="156" data-linenumber="16">
            
              <span class="hits">156</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 156 times">
                  else: 156
                </span>
              
            

            <code class="ruby">      return I18n.t(&quot;pdf.inspection.fields.na&quot;) if date.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="156" data-linenumber="17">
            
              <span class="hits">156</span>
            

            
              
            

            <code class="ruby">      date.strftime(&quot;%-d %B, %Y&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.format_pass_fail(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="21">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      case value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when true then I18n.t(&quot;shared.pass_pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="23">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      when false then I18n.t(&quot;shared.fail_pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="24">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      else I18n.t(&quot;pdf.inspection.fields.na&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.format_measurement(value, unit = &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="29">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">      return I18n.t(&quot;pdf.inspection.fields.na&quot;) if value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="30">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      &quot;#{value}#{unit}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def self.add_draft_watermark(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      # Add 3x3 grid of DRAFT watermarks to each page</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="35">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      (1..pdf.page_count).each do |page_num|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="36">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        pdf.go_to_page(page_num)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="38">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        pdf.transparent(WATERMARK_TRANSPARENCY) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="39">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">          pdf.fill_color &quot;FF0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">          # 3x3 grid positions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="210" data-linenumber="42">
            
              <span class="hits">210</span>
            

            
              
            

            <code class="ruby">          y_positions = [0.10, 0.30, 0.50, 0.70, 0.9].map { |pct| pdf.bounds.height * pct }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="140" data-linenumber="43">
            
              <span class="hits">140</span>
            

            
              
            

            <code class="ruby">          x_positions = [0.15, 0.50, 0.85].map { |pct| pdf.bounds.width * pct - (WATERMARK_WIDTH / 2) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="45">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">          y_positions.each do |y|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="175" data-linenumber="46">
            
              <span class="hits">175</span>
            

            
              
            

            <code class="ruby">            x_positions.each do |x|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="525" data-linenumber="47">
            
              <span class="hits">525</span>
            

            
              
            

            <code class="ruby">              pdf.text_box I18n.t(&quot;pdf.inspection.watermark.draft&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">                at: [x, y],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">                width: WATERMARK_WIDTH,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">                height: WATERMARK_HEIGHT,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">                size: WATERMARK_TEXT_SIZE,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">                style: :bold,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">                align: :center,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">                valign: :top</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">            end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="59">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        pdf.fill_color &quot;000000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="be35116fa6f11728960efcfa8d4680b8089c9e54">
  <div class="header">
    <h3>app/services/photo_processing_service.rb</h3>
    <h4>
      <span class="yellow">
  89.47%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  50.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>38</b> relevant lines.
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>10</b> total branches, </span>
          <span class="green"><b>5</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class PhotoProcessingService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require &quot;mini_magick&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Process uploaded photo data: resize to max 1200px, convert to JPEG 75% quality, apply EXIF orientation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.process_upload_data(image_data, original_filename = &quot;photo&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    return nil if image_data.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      # Create MiniMagick image from data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="10">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      image = MiniMagick::Image.read(image_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      # Apply EXIF orientation correction first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="13">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      image.auto_orient</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      # Resize to maximum 1200px on longest side</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="16">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      image.resize &quot;#{ImageProcessorService::FULL_SIZE}x#{ImageProcessorService::FULL_SIZE}&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      # Replace transparency with white background before converting to JPEG</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="19">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      image.combine_options do |c|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="20">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        c.background &quot;white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="21">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        c.alpha &quot;remove&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="22">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        c.alpha &quot;off&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      # Convert to JPEG with 75% quality</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="26">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      image.format &quot;jpeg&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="27">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      image.quality &quot;75&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      # Get processed image data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="30">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      processed_data = image.to_blob</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      # Create a new StringIO object with processed data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="33">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      processed_io = StringIO.new(processed_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      # Add custom attributes by defining singleton methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="35">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      processed_filename = change_extension_to_jpg(original_filename)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="36">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      processed_io.define_singleton_method(:original_filename) { processed_filename }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="37">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      processed_io.define_singleton_method(:content_type) { &quot;image/jpeg&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="39">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      processed_io</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Photo processing failed: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  # Process uploaded file (for backward compatibility)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.process_upload(uploaded_file)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="48">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return nil if uploaded_file.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">    process_upload_data(uploaded_file.read, uploaded_file.original_filename)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  # Validate that data is a processable image</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.valid_image_data?(image_data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="54">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    return false if image_data.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="56">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    image = MiniMagick::Image.read(image_data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    # Try to get basic image properties to ensure it&#39;s valid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="58">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    image.width &amp;&amp; image.height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  rescue MiniMagick::Error, MiniMagick::Invalid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="61">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  # Validate that uploaded file is a processable image</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.valid_image?(uploaded_file)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="66">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return false if uploaded_file.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            
              
            

            <code class="ruby">    valid_image_data?(uploaded_file.read)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.change_extension_to_jpg(filename)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="71">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">    return &quot;photo.jpg&quot; if filename.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="73">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    basename = File.basename(filename, &quot;.*&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="74">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    &quot;#{basename}.jpg&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="77">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private_class_method :change_extension_to_jpg</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b99c89d084682299a2423f98e4c9b8438a28f358">
  <div class="header">
    <h3>app/services/qr_code_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>3</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class QrCodeService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_qr_code(record)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="3">
            
              <span class="hits">103</span>
            

            
              
            

            <code class="ruby">    require &quot;rqrcode&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Create QR code for the report URL using the shorter format</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="6">
            
              <span class="hits">103</span>
            

            
              
                <span class="hits" title="then branch hit 64 times">
                  then: 64
                </span>
              
            

            <code class="ruby">    if record.is_a?(Inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="7">
            
              <span class="hits">64</span>
            

            
              
                <span class="hits" title="else branch hit 39 times">
                  else: 39
                </span>
              
            

            <code class="ruby">      generate_inspection_qr_code(record)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="39" data-linenumber="8">
            
              <span class="hits">39</span>
            

            
              
                <span class="hits" title="then branch hit 39 times">
                  then: 39
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    elsif record.is_a?(Unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="9">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      generate_unit_qr_code(record)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_qr_code(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="14">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">    require &quot;rqrcode&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="16">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">    url = &quot;#{ENV[&quot;BASE_URL&quot;]}/inspections/#{inspection.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="17">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">    generate_qr_code_from_url(url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_qr_code(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="21">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    require &quot;rqrcode&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="23">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    url = &quot;#{ENV[&quot;BASE_URL&quot;]}/units/#{unit.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="24">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    generate_qr_code_from_url(url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.generate_qr_code_from_url(url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    # Create QR code with optimized options for chunkier appearance</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="29">
            
              <span class="hits">103</span>
            

            
              
            

            <code class="ruby">    qrcode = RQRCode::QRCode.new(url, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      # Use lower error correction level for fewer modules (chunkier code)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      # :l - 7% error correction (lowest, largest modules)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      # :m - 15% error correction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      # :q - 25% error correction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      # :h - 30% error correction (highest, smallest modules)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      level: :m</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="38">
            
              <span class="hits">103</span>
            

            
              
            

            <code class="ruby">    qrcode.as_png(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      bit_depth: 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      border_modules: 2,           # Less border space</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      color_mode: ChunkyPNG::COLOR_GRAYSCALE,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      color: &quot;black&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      file: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      fill: &quot;white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      module_px_size: 8,           # Larger modules</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      resize_exactly_to: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      resize_gte_to: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      size: 300</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    ).to_blob</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="003799499abcf9975f340e86cc1d162e20a02ee3">
  <div class="header">
    <h3>app/services/rpii_verification_service.rb</h3>
    <h4>
      <span class="yellow">
  81.82%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  44.44%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>44</b> relevant lines.
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>18</b> total branches, </span>
          <span class="green"><b>8</b> branches covered</span> and
          <span class="red"><b>10</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Service to verify RPII inspector numbers using the official API</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">require &quot;net/http&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">require &quot;uri&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">require &quot;json&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class RpiiVerificationService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  BASE_URL = &quot;https://www.playinspectors.com/wp-admin/admin-ajax.php&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  USER_AGENT = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def search(inspector_number)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="12">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">      return [] if inspector_number.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="14">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      uri = URI.parse(BASE_URL)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="15">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      http = Net::HTTP.new(uri.host, uri.port)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="16">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      http.use_ssl = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="18">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      request = Net::HTTP::Post.new(uri.path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="19">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      request[&quot;User-Agent&quot;] = USER_AGENT</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="20">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      request[&quot;Content-Type&quot;] = &quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="21">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      request[&quot;X-Requested-With&quot;] = &quot;XMLHttpRequest&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="23">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      request.body = URI.encode_www_form({</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        action: &quot;check_inspector_ajax&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        search: inspector_number.to_s.strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="28">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      response = http.request(request)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="30">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">      if response.code == &quot;200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="31">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        parse_response(JSON.parse(response.body))</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="32">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">        Rails.logger.error &quot;RPII verification failed: #{response.code} - #{response.body}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">        []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def verify(inspector_number)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="39">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      results = search(inspector_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="10" data-linenumber="41">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      inspector = results.find { |r| r[:number]&amp;.to_s == inspector_number.to_s }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="43">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">      if inspector</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="44">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        {valid: true, inspector: inspector}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="46">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        {valid: false, inspector: nil}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="52">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def parse_response(response)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="53">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">      if response.is_a?(Hash) &amp;&amp; response[&quot;suggestions&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="54">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        suggestions = response[&quot;suggestions&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="55">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      elsif response.is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">        suggestions = response</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="57">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">        return []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="61">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return [] unless suggestions.is_a?(Array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="63">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      suggestions.map do |item|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="64">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        value = item[&quot;value&quot;] || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="65">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        data = item[&quot;data&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="67">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        if value =~ /^(.+?)\s*\((.+?)\)$/</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="70">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">            name: $1.strip,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">            number: data,  # The data field contains the inspector number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">            qualifications: $2.strip,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">            id: data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">            raw_value: value</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="75">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            

            
              
            

            <code class="ruby">        elsif value =~ /^(.+?)\s*\((\d+)\)\s*-\s*(.+)$/</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="77">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            

            
              
            

            <code class="ruby">            name: $1.strip,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">            number: $2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">            qualifications: $3.strip,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">            id: data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">            raw_value: value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="85">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            

            
              
            

            <code class="ruby">            raw_value: value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">            number: data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">            id: data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a5d82b78a360dd19e2ea5de249e4b9ea59f20bd3">
  <div class="header">
    <h3>app/services/safety_standard.rb</h3>
    <h4>
      <span class="green">
  93.94%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  66.67%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>132</b> relevant lines.
      <span class="green"><b>124</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>39</b> total branches, </span>
          <span class="green"><b>26</b> branches covered</span> and
          <span class="red"><b>13</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SafetyStandard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Height category constants based on EN 14960:2019</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  HEIGHT_CATEGORIES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    1000 =&gt; {label: &quot;1.0m (Young children)&quot;, max_users: :calculate_by_area},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    1200 =&gt; {label: &quot;1.2m (Children)&quot;, max_users: :calculate_by_area},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    1500 =&gt; {label: &quot;1.5m (Adolescents)&quot;, max_users: :calculate_by_area},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    1800 =&gt; {label: &quot;1.8m (Adults)&quot;, max_users: :calculate_by_area}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  # Grounding test weights by user height (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  GROUNDING_TEST_WEIGHTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    height_1000mm: 25,               # kg test weight for 1.0m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    height_1200mm: 35,               # kg test weight for 1.2m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    height_1500mm: 65,               # kg test weight for 1.5m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    height_1800mm: 85                # kg test weight for 1.8m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  # Reinspection interval</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  REINSPECTION_INTERVAL_DAYS = 365  # days</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  # API Example Parameters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  API_EXAMPLE_PARAMS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    anchors: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      type: &quot;anchors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      length: 5.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      width: 5.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      height: 3.0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    slide_runout: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      type: &quot;slide_runout&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      platform_height: 2.5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    wall_height: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      type: &quot;wall_height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      platform_height: 2.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      user_height: 1.5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    user_capacity: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      type: &quot;user_capacity&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      length: 10.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      width: 8.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      negative_adjustment_area: 15.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      max_user_height: 1.5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  # API Example Responses</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  API_EXAMPLE_RESPONSES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="51">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    anchors: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      passed: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      status: &quot;Calculation completed successfully&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      result: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">        value: 8,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        breakdown: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">          [&quot;Front/back area&quot;, &quot;5.0m (W)  3.0m (H) = 15.0m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">          [&quot;Sides area&quot;, &quot;5.0m (L)  3.0m (H) = 15.0m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">          [&quot;Front &amp; back anchor counts&quot;, &quot;((15.0  114.0 * 1.5)  1600.0 = 2&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">          [&quot;Left &amp; right anchor counts&quot;, &quot;((15.0  114.0 * 1.5)  1600.0 = 2&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">          [&quot;Required anchors&quot;, &quot;(2 + 2)  2 = 8&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    slide_runout: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      passed: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      status: &quot;Calculation completed successfully&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      result: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">        value: 1.25,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">        breakdown: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">          [&quot;50% calculation&quot;, &quot;2.5m  0.5 = 1.25m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">          [&quot;Minimum requirement&quot;, &quot;0.3m (300mm)&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">          [&quot;Base runout&quot;, &quot;Maximum of 1.25m and 0.3m = 1.25m&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    wall_height: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      passed: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      status: &quot;Calculation completed successfully&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      result: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">        value: 1.5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        breakdown: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">          [&quot;Height range&quot;, &quot;0.6m - 3.0m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">          [&quot;Calculation&quot;, &quot;1.5m (user height)&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    user_capacity: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      passed: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      status: &quot;Calculation completed successfully&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      result: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">        length: 10.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">        width: 8.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">        area: 80.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">        negative_adjustment_area: 15.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">        usable_area: 65.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">        max_user_height: 1.5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">        capacities: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">          users_1000mm: 65,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">          users_1200mm: 48,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">          users_1500mm: 39,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">          users_1800mm: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">        breakdown: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">          [&quot;Total area&quot;, &quot;10m  8m = 80m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">          [&quot;Obstacles/adjustments&quot;, &quot;- 15m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">          [&quot;Usable area&quot;, &quot;65m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">          [&quot;Capacity calculations&quot;, &quot;Based on usable area&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">          [&quot;1m users&quot;, &quot;65  1 = 65 users&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">          [&quot;1.2m users&quot;, &quot;65  1.3 = 48 users&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">          [&quot;1.5m users&quot;, &quot;65  1.7 = 39 users&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">          [&quot;1.8m users&quot;, &quot;Not allowed (exceeds height limit)&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="121">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="122">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def height_categories</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="123">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      HEIGHT_CATEGORIES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="126">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculation_metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="647" data-linenumber="128">
            
              <span class="hits">647</span>
            

            
              
            

            <code class="ruby">        anchors: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">          title: &quot;Anchor Requirements&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">          description: I18n.t(&quot;safety_standards.calculators.anchor.description&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">          method_name: :calculate_required_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">          module_name: SafetyStandards::AnchorCalculator,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">          example_input: 25.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">          input_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">          output_unit: &quot;anchors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">          formula_text: &quot;((Area  114.0  1.5)  1600.0)&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">        slide_runout: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">          title: &quot;Slide Runout Requirements&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">          description: &quot;Minimum runout distance for safe slide deceleration.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">          method_name: :calculate_required_runout,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">          additional_methods: [:calculate_runout_value],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">          module_name: SafetyStandards::SlideCalculator,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">          example_input: 2.5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">          input_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">          output_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">          formula_text: &quot;50% of platform height, minimum 300mm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">        wall_height: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">          title: &quot;Wall Height Requirements&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">          description: &quot;Containing wall heights must scale with user height based on platform height thresholds.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">          method_name: :meets_height_requirements?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">          module_name: SafetyStandards::SlideCalculator,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">          example_input: {platform_height: 2.0, user_height: 1.5},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">          input_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">          output_unit: &quot;requirement text&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">          formula_text: &quot;Tiered requirements based on platform height thresholds&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">        user_capacity: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">          title: &quot;User Capacity Calculation&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">          description: I18n.t(&quot;safety_standards.calculators.user_capacity.description&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">          method_name: :calculate,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">          module_name: SafetyStandards::UserCapacityCalculator,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">          example_input: {length: 10.0, width: 8.0},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">          input_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">          output_unit: &quot;users&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">          formula_text: &quot;Area  space_per_user (varies by height: 1-2 m per user)&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="176">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def get_method_source(method_name, module_name, additional_methods = [])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">      # Get the source file from the first method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="178">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      method_obj = module_name.method(method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="179">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      source_location = method_obj.source_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="250" data-linenumber="181">
            
              <span class="hits">250</span>
            

            
              
                <span class="hits" title="else branch hit 250 times">
                  else: 250
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return &quot;Source code not available&quot; unless source_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="183">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      file_path, line_number = source_location</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="250" data-linenumber="184">
            
              <span class="hits">250</span>
            

            
              
                <span class="hits" title="else branch hit 250 times">
                  else: 250
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return &quot;Source file not found&quot; unless File.exist?(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="186">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      lines = File.readlines(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">      # Get constants from the module file first</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="189">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      constants_code = &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="190">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      module_constants = get_module_constants(module_name, method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="250" data-linenumber="192">
            
              <span class="hits">250</span>
            

            
              
                <span class="hits" title="then branch hit 250 times">
                  then: 250
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if module_constants.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="193">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">        module_constants.each do |constant_name|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="194">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">          constant_def = extract_constant_definition(lines, constant_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">          # Strip indentation from each constant separately</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="196">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">          constants_code += strip_consistent_indentation(constant_def) + &quot;\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">      # Get all method implementations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="201">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      methods_code = &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">      # First, get any additional methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="204">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      additional_methods.each do |additional_method|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="62" data-linenumber="205">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 62 times">
                  then: 62
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if module_name.respond_to?(additional_method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="206">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">          additional_obj = module_name.method(additional_method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="207">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">          additional_location = additional_obj.source_location</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="62" data-linenumber="208">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 62 times">
                  then: 62
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          if additional_location &amp;&amp; additional_location[0] == file_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="209">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">            additional_lines = extract_method_lines(lines, additional_location[1] - 1, additional_method)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="210">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">            methods_code += strip_consistent_indentation(additional_lines.join(&quot;&quot;)) + &quot;\n\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">      # Then get the main method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="216">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      method_lines = extract_method_lines(lines, line_number - 1, method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="217">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      methods_code += strip_consistent_indentation(method_lines.join(&quot;&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">      # Now build the final output with headers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="220">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      output = &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="250" data-linenumber="221">
            
              <span class="hits">250</span>
            

            
              
                <span class="hits" title="then branch hit 250 times">
                  then: 250
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if constants_code.strip.length &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="222">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">        output += &quot;# Related Constants:\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="223">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">        output += constants_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="224">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">        output += &quot;\n# Method Implementation:\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="226">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      output += methods_code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="228">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="231">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def get_module_constants(module_name, method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">      # Get all constants defined in the module</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="250" data-linenumber="233">
            
              <span class="hits">250</span>
            

            
              
            

            <code class="ruby">      module_name.constants.select do |const_name|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">        # Only include constants that are hashes (our configuration constants)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="235">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">        module_name.const_get(const_name).is_a?(Hash)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="239">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def extract_constant_definition(lines, constant_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="240">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">      constant_lines = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="241">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">      in_constant = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="242">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">      brace_count = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="244">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">      lines.each_with_index do |line, index|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32721" data-linenumber="245">
            
              <span class="hits">32721</span>
            

            
              
                <span class="hits" title="then branch hit 813 times">
                  then: 813
                </span>
              
                <span class="hits" title="else branch hit 31908 times">
                  else: 31908
                </span>
              
            

            <code class="ruby">        if line.strip.start_with?(&quot;#{constant_name} =&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="246">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">          in_constant = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="247">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">          constant_lines &lt;&lt; line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="248">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">          brace_count += line.count(&quot;{&quot;) - line.count(&quot;}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="249">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">          next</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31908" data-linenumber="252">
            
              <span class="hits">31908</span>
            

            
              
                <span class="hits" title="then branch hit 12899 times">
                  then: 12899
                </span>
              
                <span class="hits" title="else branch hit 19009 times">
                  else: 19009
                </span>
              
            

            <code class="ruby">        if in_constant</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12899" data-linenumber="253">
            
              <span class="hits">12899</span>
            

            
              
            

            <code class="ruby">          constant_lines &lt;&lt; line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12899" data-linenumber="254">
            
              <span class="hits">12899</span>
            

            
              
            

            <code class="ruby">          brace_count += line.count(&quot;{&quot;) - line.count(&quot;}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">          # Check if we&#39;ve closed all braces and reached the end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12899" data-linenumber="257">
            
              <span class="hits">12899</span>
            

            
              
                <span class="hits" title="then branch hit 813 times">
                  then: 813
                </span>
              
                <span class="hits" title="else branch hit 12086 times">
                  else: 12086
                </span>
              
            

            <code class="ruby">          if brace_count &lt;= 0 &amp;&amp; (line.strip.end_with?(&quot;.freeze&quot;) || line.strip == &quot;}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="258">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">            break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="813" data-linenumber="263">
            
              <span class="hits">813</span>
            

            
              
            

            <code class="ruby">      constant_lines.join(&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="266">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def generate_example(calculation_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="248" data-linenumber="267">
            
              <span class="hits">248</span>
            

            
              
            

            <code class="ruby">      metadata = calculation_metadata[calculation_type]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="248" data-linenumber="268">
            
              <span class="hits">248</span>
            

            
              
                <span class="hits" title="else branch hit 248 times">
                  else: 248
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return &quot;No metadata available&quot; unless metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="248" data-linenumber="270">
            
              <span class="hits">248</span>
            

            
              
            

            <code class="ruby">      case calculation_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
                <span class="hits" title="when branch hit 62 times">
                  when: 62
                </span>
              
            

            <code class="ruby">      when :anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="272">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        area = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">        # Create dimensions that result in the example area (assuming square for simplicity)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="274">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        side_length = Math.sqrt(area).round(1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="275">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        height = 3.0 # Standard height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="276">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        result = SafetyStandards::AnchorCalculator.calculate(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby">          length: side_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">          width: side_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">          height: height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">        ).value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="281">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        input_unit = metadata[:input_unit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="282">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        area_input = &quot;#{area}#{input_unit} area&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="283">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        output_unit = metadata[:output_unit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="284">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        &quot;For #{area_input}: #{result} #{output_unit} required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            
              
                <span class="hits" title="when branch hit 62 times">
                  when: 62
                </span>
              
            

            <code class="ruby">      when :slide_runout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="286">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        platform_height = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="287">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        result = SafetyStandards::SlideCalculator.calculate_required_runout(platform_height).value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="288">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        input_unit = metadata[:input_unit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="289">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        platform_desc = &quot;#{platform_height}#{input_unit} platform&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="290">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        output_unit = metadata[:output_unit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="291">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        &quot;For #{platform_desc}: #{result}#{output_unit} runout required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
                <span class="hits" title="when branch hit 62 times">
                  when: 62
                </span>
              
            

            <code class="ruby">      when :wall_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="293">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        example = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="294">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        platform_height = example[:platform_height]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="295">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        user_height = example[:user_height]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="296">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        thresholds = SafetyStandards::SlideCalculator::SLIDE_HEIGHT_THRESHOLDS</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="62" data-linenumber="297">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        case platform_height</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="298">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when 0..thresholds[:no_walls_required]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="299">
            

            
              
            

            <code class="ruby">          requirement = &quot;No containing walls required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="300">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="when branch hit 62 times">
                  when: 62
                </span>
              
            

            <code class="ruby">        when (thresholds[:no_walls_required]..thresholds[:basic_walls])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="301">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">          height_desc = &quot;(equal to user height)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="302">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">          requirement = &quot;Walls must be at least #{user_height}m #{height_desc}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="303">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when (thresholds[:basic_walls]..thresholds[:enhanced_walls])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="304">
            

            
              
            

            <code class="ruby">          multiplier = SafetyStandards::SlideCalculator::WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="305">
            

            
              
            

            <code class="ruby">          wall_height = (user_height * multiplier).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="306">
            

            
              
            

            <code class="ruby">          height_desc = &quot;(#{multiplier} user height)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="307">
            

            
              
            

            <code class="ruby">          requirement = &quot;Walls must be at least #{wall_height}m #{height_desc}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="309">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        input_unit = metadata[:input_unit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="310">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        &quot;For platform height #{platform_height}#{input_unit}, user height #{user_height}#{input_unit}: #{requirement}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
                <span class="hits" title="when branch hit 62 times">
                  when: 62
                </span>
              
            

            <code class="ruby">      when :user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="312">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        example = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="313">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        length = example[:length]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="314">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        width = example[:width]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="315">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        result = SafetyStandards::UserCapacityCalculator.calculate(length, width, nil, 15.0)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="316">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        capacity = result.value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="317">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        area = length * width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="318">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">        &quot;For #{area}m area (#{length}m  #{width}m) with 15m adjustment: &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">          &quot;1.0m users: #{capacity[:users_1000mm]}, &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">          &quot;1.2m users: #{capacity[:users_1200mm]}, &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
            

            <code class="ruby">          &quot;1.5m users: #{capacity[:users_1500mm]}, &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">          &quot;1.8m users: #{capacity[:users_1800mm]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="323">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="324">
            

            
              
            

            <code class="ruby">        &quot;Example not available for #{calculation_type}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="328">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def slide_calculations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="329">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Comprehensive slide safety requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="331">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        containing_wall_heights: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">          under_600mm: &quot;No containing walls required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby">          between_600_3000mm: &quot;Containing walls required of user height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            

            
              
            

            <code class="ruby">          between_3000_6000mm: &quot;Containing walls required 1.25 times user height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            
              
            

            <code class="ruby">          over_6000mm: &quot;Both containing walls AND permanent roof required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            

            
              
            

            <code class="ruby">        runout_requirements: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            

            
              
            

            <code class="ruby">          minimum_length: &quot;50% of highest platform height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            

            
              
            

            <code class="ruby">          absolute_minimum: &quot;300mm in any case&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            
              
            

            <code class="ruby">          maximum_inclination: &quot;Not more than 10&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="341">
            

            
              
            

            <code class="ruby">          stop_wall_addition: &quot;If fitted, adds 50cm to required run-out length&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="342">
            

            
              
            

            <code class="ruby">          wall_height_requirement: &quot;50% of user height on run-out sides&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            
              
            

            <code class="ruby">        safety_factors: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            

            
              
            

            <code class="ruby">          first_metre_gradient: &quot;Special requirements for first metre of slope&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            

            
              
            

            <code class="ruby">          surface_requirements: &quot;Non-slip surface material required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            

            
              
            

            <code class="ruby">          edge_protection: &quot;Rounded edges and smooth transitions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="348">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="352">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def extract_method_lines(lines, start_line, method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="353">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">      method_lines = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="354">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">      current_line = start_line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="355">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">      indent_level = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            
              
            

            <code class="ruby">      # Find the method definition line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="358">
            
              <span class="hits">312</span>
            

            
              
                <span class="hits" title="body branch hit 312 times">
                  body: 312
                </span>
              
            

            <code class="ruby">      while current_line &lt; lines.length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="359">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">        line = lines[current_line]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="312" data-linenumber="360">
            
              <span class="hits">312</span>
            

            
              
                <span class="hits" title="then branch hit 312 times">
                  then: 312
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if line.strip.start_with?(&quot;def #{method_name}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="361">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">          indent_level = line.index(&quot;def&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="362">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">          method_lines &lt;&lt; line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="363">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">          current_line += 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="364">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">          break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="366">
            

            
              
            

            <code class="ruby">        current_line += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="312" data-linenumber="369">
            
              <span class="hits">312</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 312 times">
                  else: 312
                </span>
              
            

            <code class="ruby">      return [&quot;Method definition not found&quot;] if indent_level.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="370">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            
              
            

            <code class="ruby">      # Extract method body until we reach the same or lesser indentation with &#39;end&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="372">
            
              <span class="hits">312</span>
            

            
              
                <span class="hits" title="body branch hit 7095 times">
                  body: 7095
                </span>
              
            

            <code class="ruby">      while current_line &lt; lines.length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7095" data-linenumber="373">
            
              <span class="hits">7095</span>
            

            
              
            

            <code class="ruby">        line = lines[current_line]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7095" data-linenumber="374">
            
              <span class="hits">7095</span>
            

            
              
            

            <code class="ruby">        method_lines &lt;&lt; line</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            

            
              
            

            <code class="ruby">        # Check if we&#39;ve reached the end of the method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7095" data-linenumber="377">
            
              <span class="hits">7095</span>
            

            
              
                <span class="hits" title="then branch hit 312 times">
                  then: 312
                </span>
              
                <span class="hits" title="else branch hit 6783 times">
                  else: 6783
                </span>
              
            

            <code class="ruby">        if line.strip == &quot;end&quot; &amp;&amp; (line.index(/\S/) || 0) &lt;= indent_level</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="378">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">          break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6783" data-linenumber="381">
            
              <span class="hits">6783</span>
            

            
              
            

            <code class="ruby">        current_line += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="382">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="383">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="312" data-linenumber="384">
            
              <span class="hits">312</span>
            

            
              
            

            <code class="ruby">      method_lines</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="386">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="387">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def strip_consistent_indentation(source_code)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1125" data-linenumber="388">
            
              <span class="hits">1125</span>
            

            
              
            

            <code class="ruby">      lines = source_code.split(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            
              
            

            <code class="ruby">      # Find minimum indentation (excluding empty lines)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19927" data-linenumber="391">
            
              <span class="hits">19927</span>
            

            
              
            

            <code class="ruby">      min_indent = lines.reject(&amp;:empty?).map { |line| line.match(/^(\s*)/)[1].length }.min || 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="392">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby">      # Remove minimum indentation from all lines</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1125" data-linenumber="394">
            
              <span class="hits">1125</span>
            

            
              
            

            <code class="ruby">      lines.map { |line|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21119" data-linenumber="395">
            
              <span class="hits">21119</span>
            

            
              
                <span class="hits" title="then branch hit 2317 times">
                  then: 2317
                </span>
              
            

            <code class="ruby">        line.empty? ?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2317" data-linenumber="396">
            
              <span class="hits">2317</span>
            

            
              
                <span class="hits" title="else branch hit 18802 times">
                  else: 18802
                </span>
              
            

            <code class="ruby">        line :</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18802" data-linenumber="397">
            
              <span class="hits">18802</span>
            

            
              
            

            <code class="ruby">        line[min_indent..] || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            

            
              
            

            <code class="ruby">      }.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="401">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f28e57e0679481baea2d8be9e1c8731539f3af36">
  <div class="header">
    <h3>app/services/safety_standards/anchor_calculator.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>38</b> relevant lines.
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SafetyStandards</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module AnchorCalculator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    extend self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Anchor calculation constants from EN 14960-1:2019</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    # Line 450: Each anchor must withstand 1600N force</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    # Lines 441-442: Minimum 6 anchorage points required</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    # Lines 1194-1199: Cw=1.5, =1.24 kg/m, V=11.1 m/s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    # Pre-calculated: 0.5  1.5  1.24  11.1  114</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    ANCHOR_CALCULATION_CONSTANTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      area_coefficient: 114.0,     # Pre-calculated wind force coefficient</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      base_divisor: 1600.0,        # Force per anchor in Newtons (Line 450)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      safety_factor: 1.5,          # Safety factor multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      minimum_anchors: 6           # Minimum required anchors (Lines 441-442)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    # Test examples for anchor calculations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    # Formula: (Area * 114 * 1.5) / 1600, rounded up</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    # EN 14960-1:2019 Lines 441-442: Minimum 6 anchors required</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    ANCHOR_TEST_EXAMPLES = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      # Basic area calculations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      basic: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        small_area: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">          input: 5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">          expected: 1 # (5 * 114 * 1.5) / 1600 = 0.534  1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        medium_area: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">          input: 10,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">          expected: 2 # (10 * 114 * 1.5) / 1600 = 1.069  2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        large_area: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">          input: 25,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">          expected: 3 # (25 * 114 * 1.5) / 1600 = 2.672  3</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      # Invalid inputs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      invalid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">        nil_area: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">          input: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">          expected: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">        zero_area: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">          input: 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">          expected: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">        negative_area: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">          input: -5.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">          expected: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      # Full unit calculations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      units: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">        small_unit: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">          dimensions: {length: 1, width: 1, height: 1},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">          expected_anchors: 6 # Front/back: 1m  1, Sides: 1m  1, Total: (1+1)*2 = 4, Min: 6</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">        standard_unit: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">          dimensions: {length: 5, width: 4, height: 3},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">          expected_anchors: 8 # Front/back: 12m  2, Sides: 15m  2, Total: (2+2)*2 = 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        large_unit: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">          dimensions: {length: 10, width: 8, height: 4},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">          expected_anchors: 18 # Front/back: 32m  4, Sides: 40m  5, Total: (4+5)*2 = 18</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate_required_anchors(area_m2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Annex A (Lines 1175-1210) - Anchor calculation formula</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      # Force = 0.5  Cw    V  A</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      # Where: Cw = 1.5,  = 1.24 kg/m, V = 11.1 m/s (Lines 1194-1199)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      # Number of anchors = Force / 1600N (Line 450 - each anchor withstands 1600N)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="271" data-linenumber="75">
            
              <span class="hits">271</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 265 times">
                  else: 265
                </span>
              
            

            <code class="ruby">      return 0 if area_m2.nil? || area_m2 &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      # Pre-calculated: 0.5  1.5  1.24  11.1  114</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="265" data-linenumber="78">
            
              <span class="hits">265</span>
            

            
              
            

            <code class="ruby">      area_coeff = ANCHOR_CALCULATION_CONSTANTS[:area_coefficient]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="265" data-linenumber="79">
            
              <span class="hits">265</span>
            

            
              
            

            <code class="ruby">      base_div = ANCHOR_CALCULATION_CONSTANTS[:base_divisor]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="265" data-linenumber="80">
            
              <span class="hits">265</span>
            

            
              
            

            <code class="ruby">      safety_mult = ANCHOR_CALCULATION_CONSTANTS[:safety_factor]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="265" data-linenumber="82">
            
              <span class="hits">265</span>
            

            
              
            

            <code class="ruby">      ((area_m2.to_f * area_coeff * safety_mult) / base_div).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate(length:, width:, height:)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Lines 1175-1210 (Annex A) - Calculate exposed surface areas</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="87">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      front_area = (width * height).round(1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="88">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      sides_area = (length * height).round(1)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="90">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      required_front = calculate_required_anchors(front_area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="91">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      required_sides = calculate_required_anchors(sides_area)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Line 1204 - Calculate for each side</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="94">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      total_required = (required_front + required_sides) * 2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Lines 441-442 - &quot;Each inflatable shall have at least six anchorage points&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="97">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      minimum = ANCHOR_CALCULATION_CONSTANTS[:minimum_anchors]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="98">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      total_required = [total_required, minimum].max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="100">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      area_coeff = ANCHOR_CALCULATION_CONSTANTS[:area_coefficient]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="101">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      base_div = ANCHOR_CALCULATION_CONSTANTS[:base_divisor]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="102">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      safety_mult = ANCHOR_CALCULATION_CONSTANTS[:safety_factor]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="104">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      formula_front = &quot;((#{front_area}  #{area_coeff} * #{safety_mult})  &quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="105">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      formula_front += base_div.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="106">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      formula_sides = &quot;((#{sides_area}  #{area_coeff} * #{safety_mult})  &quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="107">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      formula_sides += base_div.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="109">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      calculated_total = (required_front + required_sides) * 2</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      breakdown = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="113">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.anchor.front_back_area_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">          &quot;#{width}m (W)  #{height}m (H) = #{front_area}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.anchor.sides_area_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">          &quot;#{length}m (L)  #{height}m (H) = #{sides_area}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.anchor.front_back_anchors_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">          &quot;#{formula_front} = #{required_front}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.anchor.left_right_anchors_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">          &quot;#{formula_sides} = #{required_sides}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.anchor.total_anchors_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">          &quot;(#{required_front} + #{required_sides})  2 = #{calculated_total}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      # Add minimum requirement note if applicable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="135">
            
              <span class="hits">130</span>
            

            
              
                <span class="hits" title="then branch hit 11 times">
                  then: 11
                </span>
              
                <span class="hits" title="else branch hit 119 times">
                  else: 119
                </span>
              
            

            <code class="ruby">      if calculated_total &lt; minimum</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="136">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        breakdown &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.anchor.en_minimum_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.anchor.minimum_required&quot;, minimum: minimum)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="142">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">      CalculatorResponse.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">        value: total_required,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">        breakdown: breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="149">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def anchor_formula_text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="150">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      area_coeff = ANCHOR_CALCULATION_CONSTANTS[:area_coefficient]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="151">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_div = ANCHOR_CALCULATION_CONSTANTS[:base_divisor]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="152">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      safety_fact = ANCHOR_CALCULATION_CONSTANTS[:safety_factor]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="153">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;((Area  #{area_coeff}  #{safety_fact})  #{base_div})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="156">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def anchor_calculation_description</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="157">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      I18n.t(&quot;safety_standards.calculators.anchor.description&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="33e62f8e30997ea6bb4d0fc30a55fbeb4b572efd">
  <div class="header">
    <h3>app/services/safety_standards/material_validator.rb</h3>
    <h4>
      <span class="yellow">
  88.24%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>17</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SafetyStandards</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module MaterialValidator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    extend self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Material safety standards (EN 14960:2019 &amp; EN 71-3)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    MATERIAL_STANDARDS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      fabric: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">        min_tensile_strength: 1850,    # Newtons minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">        min_tear_strength: 350,        # Newtons minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">        fire_standard: &quot;EN 71-3&quot;       # Fire retardancy standard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      thread: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">        min_tensile_strength: 88,      # Newtons minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        stitch_length_min: 3,          # mm minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">        stitch_length_max: 8           # mm maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      rope: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        min_diameter: 18,              # mm minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">        max_diameter: 45,              # mm maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        max_swing_percentage: 20       # % maximum swing</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      netting: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        max_vertical_mesh: 30,         # mm maximum for &gt;1m height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        max_roof_mesh: 8               # mm maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    # Test examples for material validation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    MATERIAL_TEST_EXAMPLES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      stitch_length: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        valid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">          minimum: 3,      # mm - minimum allowed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">          medium: 5,       # mm - middle of range</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">          maximum: 8       # mm - maximum allowed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        invalid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">          too_short: 2,    # mm - below minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">          too_long: 9,     # mm - above maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">          nil_value: nil   # nil not allowed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      rope_diameter: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">        valid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">          minimum: 18,     # mm - minimum allowed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">          medium: 30,      # mm - middle of range</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">          maximum: 45      # mm - maximum allowed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        invalid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">          too_thin: 15,    # mm - below minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">          too_thick: 50,   # mm - above maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">          nil_value: nil   # nil not allowed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="56">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def valid_stitch_length?(length_mm)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Stitch length must be within specified range to ensure</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      # adequate seam strength while maintaining fabric integrity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="59">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      min_length = MATERIAL_STANDARDS[:thread][:stitch_length_min]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="60">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      max_length = MATERIAL_STANDARDS[:thread][:stitch_length_max]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="61">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      length_mm.present? &amp;&amp; length_mm.between?(min_length, max_length)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="64">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def valid_rope_diameter?(diameter_mm)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Rope diameter range prevents finger entrapment while</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      # ensuring adequate grip and structural strength</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="67">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      min_diameter = MATERIAL_STANDARDS[:rope][:min_diameter]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="68">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      max_diameter = MATERIAL_STANDARDS[:rope][:max_diameter]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="69">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      diameter_mm.present? &amp;&amp; diameter_mm.between?(min_diameter, max_diameter)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="72">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def fabric_tensile_requirement(fabric_standards = MATERIAL_STANDARDS[:fabric])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            

            
              
            

            <code class="ruby">      &quot;#{fabric_standards[:min_tensile_strength]} Newtons minimum&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="76">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def fabric_tear_requirement(fabric_standards = MATERIAL_STANDARDS[:fabric])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            

            
              
            

            <code class="ruby">      &quot;#{fabric_standards[:min_tear_strength]} Newtons minimum&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4888081ecc2918ebfb2191d07c870c8ed9978729">
  <div class="header">
    <h3>app/services/safety_standards/slide_calculator.rb</h3>
    <h4>
      <span class="yellow">
  86.54%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  77.78%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>104</b> relevant lines.
      <span class="green"><b>90</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>36</b> total branches, </span>
          <span class="green"><b>28</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SafetyStandards</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module SlideCalculator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    extend self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Slide safety thresholds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    SLIDE_HEIGHT_THRESHOLDS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">      no_walls_required: 0.6,      # Under 600mm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      basic_walls: 3.0,            # 600mm - 3000mm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      enhanced_walls: 6.0,         # 3000mm - 6000mm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      max_safe_height: 8.0         # Maximum recommended height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    # Slide runout calculation constants (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    RUNOUT_CALCULATION_CONSTANTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      platform_height_ratio: 0.5, # 50% of platform height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      minimum_runout_meters: 0.3,  # Absolute minimum 300mm (0.3m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      stop_wall_addition: 0.5      # 50cm addition when stop-wall fitted (Line 936)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    # Wall height calculation constants (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    WALL_HEIGHT_CONSTANTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      enhanced_height_multiplier: 1.25  # 1.25 multiplier for enhanced walls</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    # Test examples for height requirements validation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    # Format: [platform_height, user_height, containing_wall_height, has_permanent_roof]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    HEIGHT_TEST_EXAMPLES = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      # Valid scenarios</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="29">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      valid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        # No walls required (under 0.6m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        no_walls_required: [0.5, 1.5, 0, false],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        no_walls_required_low: [0.3, 1.5, 0, false],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        # Basic walls (0.6m - 3.0m) - wall height &gt;= user height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">        basic_walls_exact: [1.5, 1.5, 1.5, false],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        basic_walls_exceeds: [2, 2, 2.5, false],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        # Enhanced walls (3.0m - 6.0m) - wall height &gt;= 1.25x user height OR roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">        enhanced_walls: [4, 4, 5, false], # 4 * 1.25 = 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">        enhanced_walls_exact: [5, 5, 6.25, false], # 5 * 1.25 = 6.25</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        enhanced_walls_with_roof: [4, 4, 3, true], # Insufficient walls but has roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        enhanced_walls_roof_alternative: [5, 5, 5, true], # Has roof, walls don&#39;t need to be 1.25x</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">        # Maximum height (6.0m - 8.0m) - wall height &gt;= 1.25x user height AND roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        max_height_with_roof: [7, 7, 8.75, true], # 7 * 1.25 = 8.75 AND has roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">        max_height_exact_with_roof: [6.5, 6.5, 8.125, true] # 6.5 * 1.25 = 8.125 AND has roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      # Invalid scenarios</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      invalid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">        # Nil values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">        nil_user_height: [1, nil, 2, false],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        nil_wall_height: [1, 1.5, nil, false],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">        nil_roof: [1, 1.5, 2, nil],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">        # Insufficient wall heights</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        basic_walls_too_low: [2, 2, 1.8, false],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">        enhanced_walls_too_low: [4, 4, 4.8, false], # Needs 5m or roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">        max_height_too_low: [7, 7, 8, true], # Needs 8.75m even with roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">        max_height_no_roof: [7, 7, 8.75, false], # Has correct walls but needs roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        # Exceeds safe limits (over 8.0m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        exceeds_safe_height: [9, 7, 12, true],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        exceeds_safe_height_high: [10, 7, 15, true]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    # Test examples for runout requirements validation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    # Format: [runout_length, platform_height]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    RUNOUT_TEST_EXAMPLES = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      # Valid scenarios</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="72">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      valid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">        # Runout is 50% of platform height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">        runout_exact: [1, 2],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        runout_half: [0.5, 1],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        # Minimum runout (0.3m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        runout_minimum: [0.3, 0.1] # Platform needs 0.05m but minimum is 0.3m</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      # Invalid scenarios</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      invalid: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">        # Nil values</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        runout_nil: [nil, 2],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        platform_nil: [1.5, nil],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">        # Insufficient runout</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">        runout_too_short: [0.8, 2], # Needs 1m</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">        runout_insufficient: [0.2, 1], # Needs 0.5m</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        # Below minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">        runout_below_min: [0.25, 0.1] # Below 0.3m minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    # Simple calculation method that returns just the numeric value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate_runout_value(platform_height, has_stop_wall: false)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="643" data-linenumber="98">
            
              <span class="hits">643</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 643 times">
                  else: 643
                </span>
              
            

            <code class="ruby">      return 0 if platform_height.nil? || platform_height &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="643" data-linenumber="100">
            
              <span class="hits">643</span>
            

            
              
            

            <code class="ruby">      height_ratio = RUNOUT_CALCULATION_CONSTANTS[:platform_height_ratio]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="643" data-linenumber="101">
            
              <span class="hits">643</span>
            

            
              
            

            <code class="ruby">      minimum_runout = RUNOUT_CALCULATION_CONSTANTS[:minimum_runout_meters]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="643" data-linenumber="102">
            
              <span class="hits">643</span>
            

            
              
            

            <code class="ruby">      stop_wall_add = RUNOUT_CALCULATION_CONSTANTS[:stop_wall_addition]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="643" data-linenumber="104">
            
              <span class="hits">643</span>
            

            
              
            

            <code class="ruby">      calculated_runout = platform_height * height_ratio</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="643" data-linenumber="105">
            
              <span class="hits">643</span>
            

            
              
            

            <code class="ruby">      base_runout = [calculated_runout, minimum_runout].max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="643" data-linenumber="107">
            
              <span class="hits">643</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 638 times">
                  else: 638
                </span>
              
            

            <code class="ruby">      has_stop_wall ? base_runout + stop_wall_add : base_runout</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="110">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate_required_runout(platform_height, has_stop_wall: false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Section 4.2.11 (Lines 930-939) - Runout requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      # Line 934-935: The runout distance must be at least half the height of the slide&#39;s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      # highest platform (measured from ground level), with an absolute minimum of 300mm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      # Line 936: If a stop-wall is installed at the runout&#39;s end, an additional</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      # 50cm must be added to the total runout length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="121" data-linenumber="116">
            
              <span class="hits">121</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 118 times">
                  else: 118
                </span>
              
            

            <code class="ruby">      return CalculatorResponse.new(value: 0, value_suffix: &quot;m&quot;, breakdown: []) if platform_height.nil? || platform_height &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      # Get constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="119">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      height_ratio = RUNOUT_CALCULATION_CONSTANTS[:platform_height_ratio]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="120">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      minimum_runout = RUNOUT_CALCULATION_CONSTANTS[:minimum_runout_meters]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="121">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      stop_wall_add = RUNOUT_CALCULATION_CONSTANTS[:stop_wall_addition]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">      # Calculate values using the shared method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="124">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      calculated_runout = platform_height * height_ratio</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="125">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      base_runout = calculate_runout_value(platform_height, has_stop_wall: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="126">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      final_runout = calculate_runout_value(platform_height, has_stop_wall: has_stop_wall)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      # Build breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      breakdown = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="131">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.runout.calculation_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">          &quot;#{platform_height}m  0.5 = #{calculated_runout}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.runout.minimum_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">          &quot;#{minimum_runout}m (300mm)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">        ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.runout.base_runout_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">          &quot;#{I18n.t(&quot;safety_standards.calculators.runout.maximum_of&quot;)} #{calculated_runout}m #{I18n.t(&quot;safety_standards.calculators.runout.and&quot;)} #{minimum_runout}m = #{base_runout}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      # Add stop-wall if applicable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="145">
            
              <span class="hits">118</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 113 times">
                  else: 113
                </span>
              
            

            <code class="ruby">      if has_stop_wall</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="146">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        breakdown &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">          I18n.t(&quot;safety_standards.calculators.runout.stop_wall_addition_label&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">          &quot;#{base_runout}m + #{stop_wall_add}m = #{final_runout}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="152">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      CalculatorResponse.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">        value: final_runout,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">        breakdown: breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="159">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def meets_height_requirements?(platform_height, user_height, containing_wall_height, has_permanent_roof)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Section 4.2.9 (Lines 854-887) - Containment requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">      # Lines 859-860: Containing walls become mandatory for platforms exceeding 0.6m in height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">      # Lines 861-862: Platforms between 0.6m and 3.0m need walls at least as tall as the maximum user height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">      # Lines 863-864: Platforms between 3.0m and 6.0m require walls at least 1.25 times the maximum user height OR a permanent roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">      # Lines 865-866: Platforms over 6.0m must have both containing walls and a permanent roof structure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="165">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 26 times">
                  else: 26
                </span>
              
            

            <code class="ruby">      return false if platform_height.nil? || user_height.nil? || containing_wall_height.nil? || has_permanent_roof.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="167">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      enhanced_multiplier = WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="169">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      case platform_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when 0..SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="171">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        true # No containing walls required</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="172">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      when (SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]..</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
                <span class="hits" title="when branch hit 7 times">
                  when: 7
                </span>
              
            

            <code class="ruby">            SLIDE_HEIGHT_THRESHOLDS[:basic_walls])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="174">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        containing_wall_height &gt;= user_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="175">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      when (SLIDE_HEIGHT_THRESHOLDS[:basic_walls]..</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">            SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
                <span class="hits" title="when branch hit 11 times">
                  when: 11
                </span>
              
            

            <code class="ruby">        # EITHER walls at 1.25x user height OR permanent roof</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="178">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        has_permanent_roof || containing_wall_height &gt;= (user_height * enhanced_multiplier)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="179">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      when (SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]..</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">            SLIDE_HEIGHT_THRESHOLDS[:max_safe_height])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">        # BOTH containing walls AND permanent roof required</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="182">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        has_permanent_roof &amp;&amp; containing_wall_height &gt;= (user_height * enhanced_multiplier)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="184">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        false # Exceeds safe height limits</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="188">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def meets_runout_requirements?(runout_length, platform_height, has_stop_wall: false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Section 4.2.11 (Lines 930-939) - Runout requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">      # Lines 934-935: The runout area must extend at least half the platform&#39;s height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">      # or 300mm (whichever is greater) to allow users to decelerate safely</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="192">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 32 times">
                  else: 32
                </span>
              
            

            <code class="ruby">      return false if runout_length.nil? || platform_height.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="194">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      required_runout = calculate_runout_value(platform_height, has_stop_wall: has_stop_wall)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="195">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">      runout_length &gt;= required_runout</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="198">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def slide_runout_formula_text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="199">
            

            
              
            

            <code class="ruby">      ratio_constant = RUNOUT_CALCULATION_CONSTANTS[:platform_height_ratio]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            

            
              
            

            <code class="ruby">      height_ratio = (ratio_constant * 100).to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="201">
            

            
              
            

            <code class="ruby">      min_constant = RUNOUT_CALCULATION_CONSTANTS[:minimum_runout_meters]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            

            
              
            

            <code class="ruby">      min_runout = (min_constant * 1000).to_i</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            

            
              
            

            <code class="ruby">      &quot;#{height_ratio}% of platform height, minimum #{min_runout}mm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="206">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate_wall_height_requirements(platform_height, user_height, has_permanent_roof = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Section 4.2.9 (Lines 854-887) - Containment requirements</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="19" data-linenumber="208">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 19 times">
                  else: 19
                </span>
              
            

            <code class="ruby">      return CalculatorResponse.new(value: 0, value_suffix: &quot;m&quot;, breakdown: []) if platform_height.nil? || user_height.nil? || platform_height &lt;= 0 || user_height &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">      # Get requirement details and breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="211">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      requirement_details = get_wall_height_requirement_details(platform_height, user_height, has_permanent_roof)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">      # Extract the required wall height from the details</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="214">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      required_height = extract_required_wall_height(platform_height, user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="216">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      CalculatorResponse.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">        value: required_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">        breakdown: requirement_details[:breakdown]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="223">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def get_wall_height_requirement_details(platform_height, user_height, has_permanent_roof)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="224">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      no_walls_threshold = SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="225">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      basic_threshold = SLIDE_HEIGHT_THRESHOLDS[:basic_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="226">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      enhanced_threshold = SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="227">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      max_threshold = SLIDE_HEIGHT_THRESHOLDS[:max_safe_height]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="228">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      enhanced_multiplier = WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="230">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      case platform_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when 0..no_walls_threshold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="233">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          text: I18n.t(&quot;safety_standards.wall_heights.no_walls_required&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">          breakdown: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.height_range&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.under_600mm&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">            ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.requirement&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.no_walls_required&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="245">
            
              <span class="hits">24</span>
            

            
              
                <span class="hits" title="when branch hit 17 times">
                  when: 17
                </span>
              
            

            <code class="ruby">      when (no_walls_threshold..basic_threshold)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="247">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">          text: I18n.t(&quot;safety_standards.wall_heights.walls_equal_user_height&quot;, height: user_height),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">          breakdown: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.height_range&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.600mm_to_3m&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">            ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.calculation&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.equal_to_user_height&quot;, height: user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="259">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">      when (basic_threshold..enhanced_threshold)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="260">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        required_height = (user_height * enhanced_multiplier).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">        breakdown = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">          [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="263">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.height_range&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.3m_to_6m&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">          ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">          [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.calculation&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">            &quot;#{user_height}m  #{enhanced_multiplier} = #{required_height}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">          ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">          [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.alternative_requirement&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.permanent_roof_alternative&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">        # Add roof status if known</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="277">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">        if !has_permanent_roof.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="278">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">          breakdown &lt;&lt; if has_permanent_roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="280">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.permanent_roof&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.roof_fitted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="283">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="285">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.permanent_roof&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.roof_not_fitted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="292">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">          text: I18n.t(&quot;safety_standards.wall_heights.walls_125_user_height&quot;, height: required_height),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">          breakdown: breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="295">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when (enhanced_threshold..max_threshold)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="296">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        required_height = (user_height * enhanced_multiplier).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">        breakdown = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            
              
            

            <code class="ruby">          [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="299">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.height_range&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.over_6m&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby">          ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            
              
            

            <code class="ruby">          [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.calculation&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">            &quot;#{user_height}m  #{enhanced_multiplier} = #{required_height}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">          ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">          [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.additional_requirement&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby">            I18n.t(&quot;safety_standards.wall_heights.permanent_roof_required&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">        # Add roof status if known</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="313">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">        if !has_permanent_roof.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="314">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          breakdown &lt;&lt; if has_permanent_roof</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="316">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.permanent_roof&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.roof_required_and_fitted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="319">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="321">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.permanent_roof&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.roof_required_but_not_fitted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="328">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          text: I18n.t(&quot;safety_standards.wall_heights.walls_125_plus_roof_required&quot;, height: required_height),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="329">
            

            
              
            

            <code class="ruby">          breakdown: breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="331">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="333">
            

            
              
            

            <code class="ruby">          text: I18n.t(&quot;safety_standards.wall_heights.exceeds_safe_limits&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            

            
              
            

            <code class="ruby">          breakdown: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            
              
            

            <code class="ruby">            [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.status&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            

            
              
            

            <code class="ruby">              I18n.t(&quot;safety_standards.wall_heights.exceeds_safe_limits&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="341">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="342">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="344">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="346">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def extract_required_wall_height(platform_height, user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="347">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      no_walls_threshold = SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="348">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      basic_threshold = SLIDE_HEIGHT_THRESHOLDS[:basic_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="349">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      enhanced_threshold = SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="350">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      enhanced_multiplier = WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="352">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      case platform_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when 0..no_walls_threshold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="354">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        0 # No walls required</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="355">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="when branch hit 13 times">
                  when: 13
                </span>
              
            

            <code class="ruby">      when (no_walls_threshold..basic_threshold)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="356">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">        user_height # Equal to user height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="357">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">      when (basic_threshold..enhanced_threshold), (enhanced_threshold..SLIDE_HEIGHT_THRESHOLDS[:max_safe_height])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="358">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        (user_height * enhanced_multiplier).round(2) # 1.25 user height</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="359">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="360">
            

            
              
            

            <code class="ruby">        0 # Exceeds safe limits</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="361">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="362">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="363">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="364">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    public</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="366">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def requires_permanent_roof?(platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            
              
            

            <code class="ruby">      # EN 14960-1:2019 Section 4.2.9 (Lines 865-866)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            

            
              
            

            <code class="ruby">      # Inflatable structures with platforms higher than 6.0m must be equipped</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            

            
              
            

            <code class="ruby">      # with both containing walls and a permanent roof</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="370">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      threshold = SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="371">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      platform_height.present? &amp;&amp; platform_height &gt; threshold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="374">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def wall_height_requirement</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="375">
            

            
              
            

            <code class="ruby">      multiplier = WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="376">
            

            
              
            

            <code class="ruby">      &quot;Containing walls required #{multiplier} times user height&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="378">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="379">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def slide_calculations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Comprehensive slide safety requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="381">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="382">
            

            
              
            

            <code class="ruby">        containing_wall_heights: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="383">
            

            
              
            

            <code class="ruby">          under_600mm: &quot;No containing walls required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="384">
            

            
              
            

            <code class="ruby">          between_600_3000mm: &quot;Containing walls required of user height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            
              
            

            <code class="ruby">          between_3000_6000mm: wall_height_requirement,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="386">
            

            
              
            

            <code class="ruby">          over_6000mm: &quot;Both containing walls AND permanent roof required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="387">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            

            
              
            

            <code class="ruby">        runout_requirements: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            
              
            

            <code class="ruby">          minimum_length: &quot;50% of highest platform height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            
              
            

            <code class="ruby">          absolute_minimum: &quot;300mm in any case&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="391">
            

            
              
            

            <code class="ruby">          maximum_inclination: &quot;Not more than 10&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="392">
            

            
              
            

            <code class="ruby">          stop_wall_addition: &quot;If fitted, adds 50cm to required run-out length&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby">          wall_height_requirement: &quot;50% of user height on run-out sides&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            

            
              
            

            <code class="ruby">        safety_factors: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="396">
            

            
              
            

            <code class="ruby">          first_metre_gradient: &quot;Special requirements for first metre of slope&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="397">
            

            
              
            

            <code class="ruby">          surface_requirements: &quot;Non-slip surface material required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            

            
              
            

            <code class="ruby">          edge_protection: &quot;Rounded edges and smooth transitions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="401">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="402">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5db4793978e1a59328dcc0fd1c29df4c3fe3d294">
  <div class="header">
    <h3>app/services/safety_standards/user_capacity_calculator.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>49</b> relevant lines.
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>7</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SafetyStandards</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module UserCapacityCalculator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    extend self</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # EN 14960-1:2019 Section 4.3 (Lines 940-961) - Number of users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    # Note: EN 14960 doesn&#39;t specify exact calculation formulas, only factors to consider:</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    # - Height of user (Line 946)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    # - Size of playing area (Line 954)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    # - Type of activity (Line 956)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # The calculation below is industry standard practice, not from EN 14960</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    AREA_DIVISOR = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      1000 =&gt; 1.0,   # 1 user per m for 1.0m height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      1200 =&gt; 1.33,  # 0.75 users per m for 1.2m height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      1500 =&gt; 1.66,  # 0.60 users per m for 1.5m height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      1800 =&gt; 2.0    # 0.5 users per m for 1.8m height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate(length, width, max_user_height = nil, negative_adjustment_area = 0)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="79" data-linenumber="19">
            
              <span class="hits">79</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 77 times">
                  else: 77
                </span>
              
            

            <code class="ruby">      return default_result if length.nil? || width.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="21">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      total_area = (length * width).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="22">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      negative_adjustment_area = negative_adjustment_area.to_f.abs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="23">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      usable_area = [total_area - negative_adjustment_area, 0].max.round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="25">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      breakdown = build_breakdown(length, width, total_area, negative_adjustment_area, usable_area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="26">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      capacities = calculate_capacities(usable_area, max_user_height, breakdown)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="28">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      CalculatorResponse.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        value: capacities,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        breakdown: breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="37">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def build_breakdown(length, width, total_area, negative_adjustment_area, usable_area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="38">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      breakdown = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="39">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      formatted_length = format_number(length)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="40">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      formatted_width = format_number(width)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="41">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      formatted_total = format_number(total_area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="42">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      formatted_usable = format_number(usable_area)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="44">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      breakdown &lt;&lt; [I18n.t(&quot;safety_standards.calculators.user_capacity.total_area&quot;), &quot;#{formatted_length}m  #{formatted_width}m = #{formatted_total}m&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="46">
            
              <span class="hits">77</span>
            

            
              
                <span class="hits" title="then branch hit 73 times">
                  then: 73
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      if negative_adjustment_area &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="73" data-linenumber="47">
            
              <span class="hits">73</span>
            

            
              
            

            <code class="ruby">        formatted_adjustment = format_number(negative_adjustment_area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="73" data-linenumber="48">
            
              <span class="hits">73</span>
            

            
              
            

            <code class="ruby">        breakdown &lt;&lt; [I18n.t(&quot;safety_standards.calculators.user_capacity.obstacles_adjustments&quot;), &quot;- #{formatted_adjustment}m&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="51">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      breakdown &lt;&lt; [I18n.t(&quot;safety_standards.calculators.user_capacity.usable_area&quot;), &quot;#{formatted_usable}m&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="52">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      breakdown &lt;&lt; [I18n.t(&quot;safety_standards.calculators.user_capacity.capacity_calculations&quot;), I18n.t(&quot;safety_standards.calculators.user_capacity.based_on_usable&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="54">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      breakdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate_capacities(usable_area, max_user_height, breakdown)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="58">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      capacities = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="60">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      AREA_DIVISOR.each do |height_mm, divisor|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="308" data-linenumber="61">
            
              <span class="hits">308</span>
            

            
              
            

            <code class="ruby">        height_m = height_mm / 1000.0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="308" data-linenumber="62">
            
              <span class="hits">308</span>
            

            
              
            

            <code class="ruby">        key = :&quot;users_#{height_mm}mm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="308" data-linenumber="64">
            
              <span class="hits">308</span>
            

            
              
                <span class="hits" title="then branch hit 298 times">
                  then: 298
                </span>
              
            

            <code class="ruby">        if max_user_height.nil? || height_m &lt;= max_user_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="65">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">          capacity = (usable_area / divisor).floor</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="66">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">          capacities[key] = capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="67">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">          formatted_area = format_number(usable_area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="68">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">          formatted_divisor = format_number(divisor)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="69">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">          calculation = &quot;#{formatted_area}  #{formatted_divisor} = #{capacity} &quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="298" data-linenumber="70">
            
              <span class="hits">298</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 298 times">
                  else: 298
                </span>
              
            

            <code class="ruby">          calculation += (capacity == 1) ? &quot;user&quot; : &quot;users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="71">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">          breakdown &lt;&lt; [&quot;#{format_number(height_m)}m users&quot;, calculation]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="73">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">          capacities[key] = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="74">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">          breakdown &lt;&lt; [&quot;#{format_number(height_m)}m users&quot;, I18n.t(&quot;safety_standards.calculators.user_capacity.not_allowed&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="78">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">      capacities</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="81">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def default_result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="82">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      CalculatorResponse.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">        value: default_capacity,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        value_suffix: &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        breakdown: [[I18n.t(&quot;safety_standards.errors.invalid_dimensions&quot;), &quot;&quot;]]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="89">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def default_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="90">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        users_1000mm: 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">        users_1200mm: 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        users_1500mm: 0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">        users_1800mm: 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="98">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def format_number(number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">      # Remove trailing zeros after decimal point</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1285" data-linenumber="100">
            
              <span class="hits">1285</span>
            

            
              
            

            <code class="ruby">      formatted = sprintf(&quot;%.1f&quot;, number)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1285" data-linenumber="101">
            
              <span class="hits">1285</span>
            

            
              
            

            <code class="ruby">      formatted.sub(/\.0$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="488f758360b2e391ff12af6b78151188b8529dbc">
  <div class="header">
    <h3>app/services/seed_data_service.rb</h3>
    <h4>
      <span class="green">
  97.09%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  76.92%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>103</b> relevant lines.
      <span class="green"><b>100</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>39</b> total branches, </span>
          <span class="green"><b>30</b> branches covered</span> and
          <span class="red"><b>9</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class SeedDataService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  CASTLE_IMAGE_COUNT = 5</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  UNIT_COUNT = 20</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  INSPECTION_COUNT = 5</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  INSPECTION_INTERVAL_DAYS = 364</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  INSPECTION_OFFSET_RANGE = 0..365</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  INSPECTION_DURATION_RANGE = 1..4</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  HIGH_PASS_RATE = 0.95</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  NORMAL_PASS_RATE = 0.85</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  # Stefan-variant owner names as per existing seeds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  STEFAN_OWNER_NAMES = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    &quot;Stefan&#39;s Bouncers&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    &quot;Steph&#39;s Castles&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    &quot;Steve&#39;s Inflatables&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    &quot;Stefano&#39;s Party Hire&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    &quot;Stef&#39;s Fun Factory&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    &quot;Stefan Family Inflatables&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    &quot;Stephan&#39;s Adventure Co&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    &quot;Estephan Events&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    &quot;Steff&#39;s Soft Play&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  # Load seed helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require Rails.root.join(&quot;lib/test_data_helpers&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  require Rails.root.join(&quot;db/seeds/seed_data&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="29">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def add_seeds_for_user(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="30">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">      raise &quot;User already has seed data&quot; if user.has_seed_data?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="32">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      ActiveRecord::Base.transaction do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="33">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        Rails.logger.info I18n.t(&quot;seed_data.logging.starting_creation&quot;, user_id: user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="34">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        ensure_castle_blobs_exist</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="35">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        Rails.logger.info I18n.t(&quot;seed_data.logging.castle_images_found&quot;, count: @castle_images.size)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="36">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        create_seed_units_for_user(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="37">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">        Rails.logger.info I18n.t(&quot;seed_data.logging.creation_completed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="39">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def delete_seeds_for_user(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="43">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      ActiveRecord::Base.transaction do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">        # Delete inspections first (due to foreign key constraints)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="45">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        user.inspections.seed_data.destroy_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">        # Then delete units</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="47">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        user.units.seed_data.destroy_all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="49">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="52">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def ensure_castle_blobs_exist</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="55">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      @castle_images = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="57">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      (1..CASTLE_IMAGE_COUNT).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="58">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">        filename = &quot;castle-#{i}.jpg&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="59">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">        filepath = Rails.root.join(&quot;app/assets/castles&quot;, filename)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="55" data-linenumber="61">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="else branch hit 55 times">
                  else: 55
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        next unless File.exist?(filepath)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        # Read and cache the file content in memory</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="64">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">        @castle_images &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">          filename: filename,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">          content: File.read(filepath, mode: &quot;rb&quot;) # Read in binary mode for images</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      # If no castle images found, don&#39;t fail - just log</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="11" data-linenumber="71">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">      Rails.logger.warn I18n.t(&quot;seed_data.logging.no_castle_images&quot;) if @castle_images.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="74">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def create_seed_units_for_user(user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      # Mix of unit types similar to existing seeds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      unit_configs = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="77">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        {name: &quot;Medieval Castle Bouncer&quot;, manufacturer: &quot;Airquee Manufacturing Ltd&quot;, width: 4.5, length: 4.5, height: 3.5},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        {name: &quot;Giant Party Castle&quot;, manufacturer: &quot;Bouncy Castle Boys&quot;, width: 9.0, length: 9.0, height: 4.5},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        {name: &quot;Princess Castle with Slide&quot;, manufacturer: &quot;Jump4Joy Inflatables&quot;, width: 5.5, length: 7.0, height: 4.0, has_slide: true},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        {name: &quot;Toddler Soft Play Centre&quot;, manufacturer: &quot;Custom Inflatables UK&quot;, width: 6.0, length: 6.0, height: 2.5, is_totally_enclosed: true},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        {name: &quot;Assault Course Challenge&quot;, manufacturer: &quot;Inflatable World Ltd&quot;, width: 3.0, length: 12.0, height: 3.5, has_slide: true},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">        {name: &quot;Mega Slide Experience&quot;, manufacturer: &quot;Airquee Manufacturing Ltd&quot;, width: 5.0, length: 15.0, height: 7.5, has_slide: true},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">        {name: &quot;Gladiator Duel Platform&quot;, manufacturer: &quot;Happy Hop Europe&quot;, width: 6.0, length: 6.0, height: 1.5},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        {name: &quot;Double Bungee Run&quot;, manufacturer: &quot;Party Castle Manufacturers&quot;, width: 4.0, length: 10.0, height: 2.5}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="87">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      UNIT_COUNT.times do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="88">
            
              <span class="hits">201</span>
            

            
              
            

            <code class="ruby">        config = unit_configs[i % unit_configs.length]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="89">
            
              <span class="hits">201</span>
            

            
              
            

            <code class="ruby">        unit = create_unit_from_config(user, config, i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">        # Make half of units have incomplete most recent inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="91">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">        should_have_incomplete_inspection = i.even?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="92">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">        create_inspections_for_unit(unit, user, config, has_incomplete_recent: should_have_incomplete_inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="96">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def create_unit_from_config(user, config, index)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="97">
            
              <span class="hits">201</span>
            

            
              
            

            <code class="ruby">      unit = user.units.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">        name: &quot;#{config[:name]} ##{index + 1}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">        serial: &quot;SEED-#{Date.current.year}-#{SecureRandom.hex(4).upcase}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">        description: generate_description(config[:name]),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">        manufacturer: config[:manufacturer],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">        model: &quot;Model #{rand(100..999)}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">        owner: STEFAN_OWNER_NAMES.sample,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">        is_seed: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      # Attach random castle image if available</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      # For test environment, skip images as castle files don&#39;t exist</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="200" data-linenumber="109">
            
              <span class="hits">200</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 200 times">
                  else: 200
                </span>
              
            

            <code class="ruby">      if @castle_images.any? &amp;&amp; !Rails.env.test?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            

            
              
            

            <code class="ruby">        castle_image = @castle_images.sample</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">        # Create a new attachment - ActiveStorage will dedupe the blob automatically</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            

            
              
            

            <code class="ruby">        unit.photo.attach(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">          io: StringIO.new(castle_image[:content]),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">          filename: castle_image[:filename],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">          content_type: &quot;image/jpeg&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="119">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">      unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="122">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def generate_description(name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="123">
            
              <span class="hits">201</span>
            

            
              
            

            <code class="ruby">      case name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
                <span class="hits" title="when branch hit 91 times">
                  when: 91
                </span>
              
            

            <code class="ruby">      when /Castle/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="125">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;seed_data.descriptions.traditional_castle&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
                <span class="hits" title="when branch hit 20 times">
                  when: 20
                </span>
              
            

            <code class="ruby">      when /Slide/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="127">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;seed_data.descriptions.combination_slide&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
                <span class="hits" title="when branch hit 30 times">
                  when: 30
                </span>
              
            

            <code class="ruby">      when /Soft Play/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="129">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;seed_data.descriptions.soft_play&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
                <span class="hits" title="when branch hit 20 times">
                  when: 20
                </span>
              
            

            <code class="ruby">      when /Assault Course/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="131">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;seed_data.descriptions.assault_course&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
                <span class="hits" title="when branch hit 20 times">
                  when: 20
                </span>
              
            

            <code class="ruby">      when /Gladiator/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="133">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;seed_data.descriptions.gladiator&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
                <span class="hits" title="when branch hit 20 times">
                  when: 20
                </span>
              
            

            <code class="ruby">      when /Bungee/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="135">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;seed_data.descriptions.bungee_run&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="136">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;seed_data.descriptions.default&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="141">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def create_inspections_for_unit(unit, user, config, has_incomplete_recent: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="142">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">      offset_days = rand(INSPECTION_OFFSET_RANGE)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="200" data-linenumber="144">
            
              <span class="hits">200</span>
            

            
              
            

            <code class="ruby">      INSPECTION_COUNT.times do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="145">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">        create_single_inspection(unit, user, config, offset_days, i, has_incomplete_recent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="149">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def create_single_inspection(unit, user, config, offset_days, index, has_incomplete_recent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="150">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      inspection_date = calculate_inspection_date(offset_days, index)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="151">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      passed = determine_pass_status(index)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="152">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      is_complete = !(index == 0 &amp;&amp; has_incomplete_recent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="154">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      inspection = user.inspections.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">        build_inspection_attributes(unit, user, config, inspection_date, passed, is_complete)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="158">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      create_assessments_for_inspection(inspection, unit, config, passed: passed)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="161">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def calculate_inspection_date(offset_days, index)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="162">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      days_ago = offset_days + (index * INSPECTION_INTERVAL_DAYS)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="163">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      Date.current - days_ago.days</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="166">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def determine_pass_status(index)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="167">
            
              <span class="hits">1000</span>
            

            
              
                <span class="hits" title="then branch hit 200 times">
                  then: 200
                </span>
              
                <span class="hits" title="else branch hit 800 times">
                  else: 800
                </span>
              
            

            <code class="ruby">      (index == 0) ? (rand &lt; HIGH_PASS_RATE) : (rand &lt; NORMAL_PASS_RATE)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="170">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def build_inspection_attributes(unit, user, config, inspection_date, passed, is_complete)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="172">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">        unit: unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">        inspector_company: user.inspection_company,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">        inspection_location: &quot;#{TestDataHelpers.british_address}, #{TestDataHelpers.british_city}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">        inspection_date: inspection_date,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="176">
            
              <span class="hits">1000</span>
            

            
              
                <span class="hits" title="then branch hit 900 times">
                  then: 900
                </span>
              
            

            <code class="ruby">        complete_date: is_complete ?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="900" data-linenumber="177">
            
              <span class="hits">900</span>
            

            
              
                <span class="hits" title="else branch hit 100 times">
                  else: 100
                </span>
              
            

            <code class="ruby">          inspection_date.to_time + rand(INSPECTION_DURATION_RANGE).hours :</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="100" data-linenumber="178">
            
              <span class="hits">100</span>
            

            
              
            

            <code class="ruby">          nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">        unique_report_number: generate_report_number(user.inspection_company, inspection_date),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">        is_seed: true,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="181">
            
              <span class="hits">1000</span>
            

            
              
                <span class="hits" title="then branch hit 900 times">
                  then: 900
                </span>
              
                <span class="hits" title="else branch hit 100 times">
                  else: 100
                </span>
              
            

            <code class="ruby">        passed: is_complete ? passed : nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">        risk_assessment: generate_risk_assessment(passed),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">        # Copy dimensions from config</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">        width: config[:width],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">        length: config[:length],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">        height: config[:height],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">        has_slide: config[:has_slide] || false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">        is_totally_enclosed: config[:is_totally_enclosed] || false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="192">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def generate_report_number(company, date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1000" data-linenumber="193">
            
              <span class="hits">1000</span>
            

            
              
                <span class="hits" title="then branch hit 1000 times">
                  then: 1000
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 1000 times">
                  then: 1000
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 1000 times">
                  then: 1000
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 1000 times">
                  then: 1000
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 1000 times">
                  then: 1000
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      company_prefix = company&amp;.name&amp;.split&amp;.map(&amp;:first)&amp;.join&amp;.upcase || &quot;SEED&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="194">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      &quot;#{company_prefix}-#{date.year}-#{SecureRandom.hex(4).upcase}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="197">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def generate_risk_assessment(passed)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="198">
            
              <span class="hits">1000</span>
            

            
              
                <span class="hits" title="then branch hit 870 times">
                  then: 870
                </span>
              
            

            <code class="ruby">      if passed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="870" data-linenumber="200">
            
              <span class="hits">870</span>
            

            
              
            

            <code class="ruby">          &quot;Unit inspected and found to be in good operational condition. All safety features functioning correctly. Suitable for continued use with standard supervision requirements.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">          &quot;Comprehensive safety assessment completed. Unit meets all EN 14960:2019 requirements. No significant hazards identified. Regular maintenance schedule should be maintained.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">          &quot;Risk assessment indicates low risk profile. All structural elements secure, adequate ventilation present, and safety markings clearly visible. Recommend continued operation with routine checks.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">          &quot;Safety evaluation satisfactory. Anchoring system robust, materials show no signs of degradation. Unit provides safe environment for users within specified age and height limits.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">          &quot;Full risk assessment completed with no critical issues identified. Minor wear noted on high-traffic areas but within acceptable limits. Unit certified safe for public use.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">          &quot;Detailed inspection reveals unit maintains structural integrity. All seams intact, proper inflation pressure maintained. Risk level assessed as minimal with appropriate supervision.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">          &quot;Unit passes comprehensive safety review. Emergency exits clearly marked and functional. Blower system operating within specifications. Low risk rating assigned.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">          &quot;Risk evaluation complete. Unit demonstrates good stability under load conditions. Safety padding adequate where required. Suitable for continued commercial operation.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">        ].sample</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
                <span class="hits" title="else branch hit 130 times">
                  else: 130
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="211">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">          &quot;Risk assessment identifies multiple safety concerns requiring immediate attention. Unit should not be used until repairs completed and re-inspected. High risk rating assigned.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">          &quot;Critical safety deficiencies noted during inspection. Structural integrity compromised in several areas. Unit poses unacceptable risk to users and must be withdrawn from service.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">          &quot;Significant hazards identified including inadequate anchoring and material degradation. Risk level unacceptable for public use. Comprehensive repairs required before recertification.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">          &quot;Safety assessment failed. Multiple non-conformances with EN 14960:2019 identified. Unit presents substantial risk of injury. Recommend immediate decommissioning or major refurbishment.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">          &quot;High risk factors present including compromised seams and insufficient inflation. Unit unsafe for operation. Client advised to cease use pending extensive remedial work.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">          &quot;Risk evaluation reveals dangerous conditions. Emergency exits partially obstructed, significant wear to load-bearing elements. Unit fails safety standards and requires urgent attention.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">          &quot;Assessment indicates elevated risk profile due to equipment failures and material defects. Unit not suitable for use. Full replacement of critical components necessary.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">        ].sample</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="222">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def create_assessments_for_inspection(inspection, unit, config, passed: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="223">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      is_incomplete = inspection.complete_date.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="225">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">      inspection.each_applicable_assessment do |assessment_key, assessment_class, _|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5500" data-linenumber="226">
            
              <span class="hits">5500</span>
            

            
              
            

            <code class="ruby">        assessment_type = assessment_key.to_s.sub(/_assessment$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5500" data-linenumber="228">
            
              <span class="hits">5500</span>
            

            
              
            

            <code class="ruby">        create_assessment(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">          inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">          assessment_key,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">          assessment_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">          passed,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">          is_incomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="238">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def create_assessment(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">      inspection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">      assessment_key,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">      assessment_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">      passed,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">      is_incomplete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5500" data-linenumber="245">
            
              <span class="hits">5500</span>
            

            
              
            

            <code class="ruby">      fields = SeedData.send(&quot;#{assessment_type}_fields&quot;, passed: passed)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5500" data-linenumber="247">
            
              <span class="hits">5500</span>
            

            
              
                <span class="hits" title="then branch hit 1000 times">
                  then: 1000
                </span>
              
                <span class="hits" title="else branch hit 4500 times">
                  else: 4500
                </span>
              
            

            <code class="ruby">      if assessment_key == :user_height_assessment &amp;&amp; inspection.length &amp;&amp; inspection.width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="248">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">        fields[:play_area_length] = inspection.length * 0.8</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1000" data-linenumber="249">
            
              <span class="hits">1000</span>
            

            
              
            

            <code class="ruby">        fields[:play_area_width] = inspection.width * 0.8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5500" data-linenumber="252">
            
              <span class="hits">5500</span>
            

            
              
            

            <code class="ruby">      fields = randomly_remove_fields(fields, is_incomplete)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5500" data-linenumber="253">
            
              <span class="hits">5500</span>
            

            
              
            

            <code class="ruby">      inspection.send(assessment_key).update!(fields)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="256">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def randomly_remove_fields(fields, is_incomplete)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5500" data-linenumber="257">
            
              <span class="hits">5500</span>
            

            
              
                <span class="hits" title="else branch hit 550 times">
                  else: 550
                </span>
              
                <span class="hits" title="then branch hit 4950 times">
                  then: 4950
                </span>
              
            

            <code class="ruby">      return fields unless is_incomplete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="550" data-linenumber="258">
            
              <span class="hits">550</span>
            

            
              
                <span class="hits" title="else branch hit 263 times">
                  else: 263
                </span>
              
                <span class="hits" title="then branch hit 287 times">
                  then: 287
                </span>
              
            

            <code class="ruby">      return fields unless rand(0..1) == 0 # empty 50% of assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4122" data-linenumber="259">
            
              <span class="hits">4122</span>
            

            
              
            

            <code class="ruby">      fields.keys.each { |field| fields[field] = nil }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="263" data-linenumber="260">
            
              <span class="hits">263</span>
            

            
              
            

            <code class="ruby">      fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="492d2f494b91f2dc7a7779b0eeeb15f8ff935212">
  <div class="header">
    <h3>app/services/unit_creation_from_inspection_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>28</b> relevant lines.
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>8</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class UnitCreationFromInspectionService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  attr_reader :errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def initialize(user:, inspection_id:, unit_params:)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="5">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="6">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @inspection_id = inspection_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="7">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @unit_params = unit_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="8">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @errors = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="12">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return false unless validate_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="14">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @unit = @user.units.build(@unit_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="15">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if @unit.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="16">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      @inspection.update!(unit: @unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="17">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  attr_reader :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  attr_reader :unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def error_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="28">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @errors.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="34">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @inspection = @user.inspections.find_by(id: @inspection_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="36">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @errors &lt;&lt; I18n.t(&quot;units.errors.inspection_not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="41">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    if @inspection.unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @errors &lt;&lt; I18n.t(&quot;units.errors.inspection_has_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="46">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3039bdd650f5bad63c330a4968faa679cd8bf294">
  <div class="header">
    <h3>app/services/unit_csv_export_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class UnitCsvExportService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ATTRIBUTES = %w[id name manufacturer serial].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def initialize(units)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="5">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @units = units</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def generate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="9">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    CSV.generate(headers: true) do |csv|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="10">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      csv &lt;&lt; ATTRIBUTES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="12">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      @units.order(created_at: :desc).each do |unit|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="13">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        csv &lt;&lt; ATTRIBUTES.map { |attr| unit.send(attr) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5965243db248679089be6c583c183dc73badfc08">
  <div class="header">
    <h3>lib/code_standards_checker.rb</h3>
    <h4>
      <span class="red">
  24.11%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>141</b> relevant lines.
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>107</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>34</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>34</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Reusable code standards checker for both rake tasks and hooks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class CodeStandardsChecker</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  HARDCODED_STRINGS_ALLOWED_PATHS = %w[/lib/ /seeds/ /spec/ /test/].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def initialize(max_method_lines: 20, max_file_lines: 500, max_line_length: 80)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">    @max_method_lines = max_method_lines</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            

            
              
            

            <code class="ruby">    @max_file_lines = max_file_lines</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">    @max_line_length = max_line_length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_file(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="12">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return [] unless File.exist?(file_path) &amp;&amp; file_path.end_with?(&quot;.rb&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">    relative_path = file_path.sub(Rails.root.join(&quot;&quot;).to_s, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">    file_content = File.read(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">    file_lines = file_content.lines</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">    violations = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">    violations.concat(check_file_length(relative_path, file_lines))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">    violations.concat(check_line_lengths(relative_path, file_lines))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">    violations.concat(check_method_lengths(relative_path, file_path))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">    violations.concat(check_hardcoded_strings(relative_path, file_lines))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">    violations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_multiple_files(file_paths)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">    all_violations = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">    file_paths.each do |file_path|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">      all_violations.concat(check_file(file_path))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">    all_violations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_violations(violations, show_summary: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="36">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot; All files meet code standards!&quot; if violations.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">    output = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">    violations_by_type = violations.group_by { |v| v[:type] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">    output.concat(format_violations_by_type(violations_by_type))</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="42">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    output.concat(format_summary(violations)) if show_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">    output.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_violations_by_type(violations_by_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            

            
              
            

            <code class="ruby">    output = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">    violations_by_type.each do |type, type_violations|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">      type_name = type.to_s.upcase.tr(&quot;_&quot;, &quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">      output &lt;&lt; &quot;#{type_name} VIOLATIONS (#{type_violations.length}):&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="54">
            

            
              
            

            <code class="ruby">      output &lt;&lt; &quot;-&quot; * 50</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">      type_violations.each do |violation|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">        line_ref = violation[:line_number] || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">        output &lt;&lt; &quot;#{violation[:file]}:#{line_ref} #{violation[:message]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">      output &lt;&lt; &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            

            
              
            

            <code class="ruby">    output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_summary(violations)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            
              
            

            <code class="ruby">      &quot;=&quot; * 80,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      &quot;TOTAL: #{violations.length} violations found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="72">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_file_length(relative_path, file_lines)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="73">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return [] unless file_lines.length &gt; @max_file_lines</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    [{</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            

            
              
            

            <code class="ruby">      file: relative_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      type: :file_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      message: &quot;#{file_lines.length} lines (max #{@max_file_lines})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    }]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="82">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_line_lengths(relative_path, file_lines)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            

            
              
            

            <code class="ruby">    violations = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            

            
              
            

            <code class="ruby">    file_lines.each_with_index do |line, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="85">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      next unless line.chomp.length &gt; @max_line_length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            

            
              
            

            <code class="ruby">      violations &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">        file: relative_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">        type: :line_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">        line_number: index + 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        length: line.chomp.length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">        message: build_line_length_message(index + 1, line.chomp.length)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            

            
              
            

            <code class="ruby">    violations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="98">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_method_lengths(relative_path, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            

            
              
            

            <code class="ruby">    methods = extract_methods_from_file(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">    long_methods = methods.select { |m| m[:length] &gt; @max_method_lines }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            

            
              
            

            <code class="ruby">    long_methods.map do |method|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            

            
              
            

            <code class="ruby">        file: relative_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">        type: :method_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">        line_number: method[:start_line],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">        message: build_method_length_message(method)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="112">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_hardcoded_strings(relative_path, file_lines)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="113">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return [] if skip_hardcoded_strings?(relative_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            

            
              
            

            <code class="ruby">    violations = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            

            
              
            

            <code class="ruby">    file_lines.each_with_index do |line, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            

            
              
            

            <code class="ruby">      line_violations = check_line_for_hardcoded_strings(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">        relative_path, line, index + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            

            
              
            

            <code class="ruby">      violations.concat(line_violations)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            

            
              
            

            <code class="ruby">    violations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="125">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def check_line_for_hardcoded_strings(relative_path, line, line_number)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            

            
              
            

            <code class="ruby">    stripped = line.strip</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="127">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return [] if should_skip_line?(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            

            
              
            

            <code class="ruby">    hardcoded_strings = extract_quoted_strings(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            

            
              
            

            <code class="ruby">    hardcoded_strings.filter_map do |string|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="132">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      next unless should_flag_string?(string)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            

            
              
            

            <code class="ruby">        file: relative_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">        type: :hardcoded_string,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">        line_number: line_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">        message: build_hardcoded_string_message(line_number, string)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="143">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def skip_hardcoded_strings?(relative_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            

            
              
            

            <code class="ruby">    allowed_path = HARDCODED_STRINGS_ALLOWED_PATHS.any? do |path|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            

            
              
            

            <code class="ruby">      relative_path.include?(path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            

            
              
            

            <code class="ruby">    allowed_path || relative_path.include?(&quot;seed_data_service.rb&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="150">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def should_skip_line?(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            

            
              
            

            <code class="ruby">    stripped.start_with?(&quot;#&quot;) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">      stripped.match?(/\/.*\//) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">      stripped.include?(&quot;I18n.t&quot;) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">      stripped.include?(&quot;Rails.logger&quot;) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">      stripped.include?(&quot;puts&quot;) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">      stripped.include?(&quot;print&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="159">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def extract_quoted_strings(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="160">
            

            
              
            

            <code class="ruby">    strings = stripped.scan(/&quot;([^&quot;]*)&quot;/).flatten</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            

            
              
            

            <code class="ruby">    strings += stripped.scan(/&#39;([^&#39;]*)&#39;/).flatten</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="162">
            

            
              
            

            <code class="ruby">    strings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="165">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def should_flag_string?(string)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="166">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless string.match?(/\w/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="167">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return false if technical_string?(string)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="168">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return false if string.length &lt; 3</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="169">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return false if string.match?(/^#\{.*\}$/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="171">
            

            
              
            

            <code class="ruby">    string.match?(/[A-Z].*[a-z]/) || string.include?(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="174">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def technical_string?(string)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="175">
            

            
              
            

            <code class="ruby">    string.match?(/^[a-z_]+$/) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">      string.match?(/^[A-Z_]+$/) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">      string.match?(/^[a-z]+\.[a-z]+/) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">      string.match?(/^\//) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">      string.match?(/^[a-z]+_[a-z]+_path$/) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">      string.match?(/^\w+:/)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="183">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_line_length_message(line_number, length)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            

            
              
            

            <code class="ruby">    &quot;Line #{line_number}: #{length} chars (max #{@max_line_length})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="187">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_method_length_message(method)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            

            
              
            

            <code class="ruby">    name = method[:name]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            

            
              
            

            <code class="ruby">    length = method[:length]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="190">
            

            
              
            

            <code class="ruby">    &quot;Method &#39;#{name}&#39; is #{length} lines (max #{@max_method_lines})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="193">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_hardcoded_string_message(line_number, string)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="194">
            

            
              
            

            <code class="ruby">    &quot;Line #{line_number}: Hardcoded string &#39;#{string}&#39; - use I18n.t() instead&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="197">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def extract_methods_from_file(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="198">
            

            
              
            

            <code class="ruby">    content = File.read(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="199">
            

            
              
            

            <code class="ruby">    methods = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            

            
              
            

            <code class="ruby">    parser_state = {current_method: nil, indent_level: 0, method_start_line: 0}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            

            
              
            

            <code class="ruby">    content.lines.each_with_index do |line, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            

            
              
            

            <code class="ruby">      process_line_for_methods(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">        line,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">        index + 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">        methods,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">        parser_state,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">        file_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="212">
            

            
              
            

            <code class="ruby">    finalize_last_method(methods, parser_state, content, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="213">
            

            
              
            

            <code class="ruby">    methods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="216">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def process_line_for_methods(line, line_number, methods, state, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="217">
            

            
              
            

            <code class="ruby">    stripped = line.strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="219">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if method_definition?(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="220">
            

            
              
            

            <code class="ruby">      save_current_method(methods, state, line_number, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="221">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      start_new_method(stripped, line, line_number, state)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="222">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    elsif method_end?(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">      state[:current_method],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">      stripped,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">      line,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">      state[:indent_level]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="227">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="228">
            

            
              
            

            <code class="ruby">      finish_current_method(methods, state, line_number, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="232">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def save_current_method(methods, state, line_number, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="233">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless state[:current_method]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="235">
            

            
              
            

            <code class="ruby">    add_method_to_list(methods, state, line_number, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="238">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def start_new_method(stripped, line, line_number, state)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="239">
            

            
              
            

            <code class="ruby">    state[:current_method] = extract_method_name(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="240">
            

            
              
            

            <code class="ruby">    state[:method_start_line] = line_number</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="241">
            

            
              
            

            <code class="ruby">    state[:indent_level] = line.match(/^(\s*)/)[1].length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="244">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def finish_current_method(methods, state, line_number, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="245">
            

            
              
            

            <code class="ruby">    add_method_to_list(methods, state, line_number, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="246">
            

            
              
            

            <code class="ruby">    state[:current_method] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="249">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def finalize_last_method(methods, state, content, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="250">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless state[:current_method]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="252">
            

            
              
            

            <code class="ruby">    end_line = content.lines.length</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="253">
            

            
              
            

            <code class="ruby">    add_method_to_list(methods, state, end_line, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="256">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def add_method_to_list(methods, state, end_line, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="257">
            

            
              
            

            <code class="ruby">    methods &lt;&lt; build_method_info(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">      state[:current_method], state[:method_start_line], end_line, file_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="262">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def method_definition?(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="263">
            

            
              
            

            <code class="ruby">    /^(private|protected|public\s+)?def\s+/.match?(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="266">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def method_end?(current_method, stripped, line, indent_level)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="267">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless current_method &amp;&amp; !stripped.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="269">
            

            
              
            

            <code class="ruby">    current_indent = line.match(/^(\s*)/)[1].length</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="270">
            

            
              
            

            <code class="ruby">    stripped == &quot;end&quot; &amp;&amp; current_indent &lt;= indent_level</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="273">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def extract_method_name(stripped)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="274">
            

            
              
            

            <code class="ruby">    stripped.match(/def\s+([^\s\(]+)/)[1]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="277">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_method_info(method_name, start_line, end_line, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="279">
            

            
              
            

            <code class="ruby">      name: method_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">      start_line: start_line,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">      end_line: end_line,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">      length: end_line - start_line + 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby">      file: file_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="287">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_final_method_info(method_name, start_line, content, file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="288">
            

            
              
            

            <code class="ruby">    end_line = content.lines.length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="290">
            

            
              
            

            <code class="ruby">      name: method_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">      start_line: start_line,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">      end_line: end_line,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">      length: end_line - start_line + 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby">      file: file_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7943239b8ded17eed3b052ef34630d03948bbd84">
  <div class="header">
    <h3>lib/i18n_usage_tracker.rb</h3>
    <h4>
      <span class="green">
  95.95%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  70.83%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>74</b> relevant lines.
      <span class="green"><b>71</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>24</b> total branches, </span>
          <span class="green"><b>17</b> branches covered</span> and
          <span class="red"><b>7</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Module to track I18n key usage during test runs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module I18nUsageTracker</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    attr_accessor :tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    attr_reader :used_keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="8">
            
              <span class="hits">66</span>
            

            
              
            

            <code class="ruby">      @used_keys = Set.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="9">
            
              <span class="hits">66</span>
            

            
              
            

            <code class="ruby">      @tracking_enabled = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def track_key(key, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="13">
            
              <span class="hits">26</span>
            

            
              
                <span class="hits" title="else branch hit 24 times">
                  else: 24
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">      return unless tracking_enabled &amp;&amp; key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      # Handle both string and symbol keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="16">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      key_string = key.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      # Skip Rails internal keys and error keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="19">
            
              <span class="hits">24</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">      return if key_string.start_with?(&quot;errors.&quot;, &quot;activerecord.&quot;, &quot;activemodel.&quot;, &quot;helpers.&quot;, &quot;number.&quot;, &quot;date.&quot;, &quot;time.&quot;, &quot;support.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      # Track the full key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="22">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      @used_keys &lt;&lt; key_string</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      # Also track parent keys for nested translations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      # e.g., for &quot;users.messages.created&quot;, also track &quot;users.messages&quot; and &quot;users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="26">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      parts = key_string.split(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="27">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      (1...parts.length).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="28">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        parent_key = parts[0...i].join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="11" data-linenumber="29">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 11 times">
                  then: 11
                </span>
              
            

            <code class="ruby">        @used_keys &lt;&lt; parent_key unless parent_key.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      # Track keys used with scope option</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="33">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">      if options[:scope]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="34">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        scope = Array(options[:scope]).join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="35">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        full_key = &quot;#{scope}.#{key_string}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="36">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        @used_keys &lt;&lt; full_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        # Track parent keys for scoped translations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="39">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        full_parts = full_key.split(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="40">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        (1...full_parts.length).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="41">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">          parent_key = full_parts[0...i].join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="42">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
            

            <code class="ruby">          @used_keys &lt;&lt; parent_key unless parent_key.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def all_locale_keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="48">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      @all_locale_keys ||= begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        keys = Set.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">        # Load all locale files</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        locale_files = Rails.root.glob(&quot;config/locales/**/*.yml&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        locale_files.each do |file|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="55">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">          yaml_content = YAML.load_file(file)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">          # Process each locale (en, es, etc.)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="58">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">          yaml_content.each do |locale, content|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="59">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">            extract_keys_from_hash(content, [], keys)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="67">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def unused_keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="68">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      all_locale_keys - used_keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="71">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def usage_report</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="72">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      total_keys = all_locale_keys.size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="73">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      used_count = used_keys.size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="74">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      unused_count = unused_keys.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="77">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        total_keys: total_keys,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        used_keys: used_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        unused_keys: unused_count,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="80">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        usage_percentage: (used_count.to_f / total_keys * 100).round(2),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        unused_key_list: unused_keys.sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="87">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def extract_keys_from_hash(hash, current_path, keys)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="372" data-linenumber="88">
            
              <span class="hits">372</span>
            

            
              
            

            <code class="ruby">      hash.each do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1671" data-linenumber="89">
            
              <span class="hits">1671</span>
            

            
              
            

            <code class="ruby">        new_path = current_path + [key.to_s]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1671" data-linenumber="90">
            
              <span class="hits">1671</span>
            

            
              
            

            <code class="ruby">        full_key = new_path.join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1671" data-linenumber="92">
            
              <span class="hits">1671</span>
            

            
              
                <span class="hits" title="then branch hit 329 times">
                  then: 329
                </span>
              
            

            <code class="ruby">        if value.is_a?(Hash)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="329" data-linenumber="93">
            
              <span class="hits">329</span>
            

            
              
            

            <code class="ruby">          keys &lt;&lt; full_key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="329" data-linenumber="94">
            
              <span class="hits">329</span>
            

            
              
            

            <code class="ruby">          extract_keys_from_hash(value, new_path, keys)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
                <span class="hits" title="else branch hit 1342 times">
                  else: 1342
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1342" data-linenumber="96">
            
              <span class="hits">1342</span>
            

            
              
            

            <code class="ruby">          keys &lt;&lt; full_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  # Reset on initialization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="103">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  reset!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">  # Add at_exit hook to save tracking results if enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="106">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  at_exit do</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="17" data-linenumber="107">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    if tracking_enabled &amp;&amp; used_keys.any?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            

            
              
            

            <code class="ruby">      Rails.root.join(&quot;tmp/i18n_tracking_results.json&quot;).write(used_keys.to_a.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"># Monkey patch I18n.t to track usage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="114">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module I18n</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="115">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="116">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_t, :t</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="117">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_translate, :translate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="119">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41410" data-linenumber="120">
            
              <span class="hits">41410</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 41408 times">
                  else: 41408
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41410" data-linenumber="121">
            
              <span class="hits">41410</span>
            

            
              
            

            <code class="ruby">      original_t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="124">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="59536" data-linenumber="125">
            
              <span class="hits">59536</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 59535 times">
                  else: 59535
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="59536" data-linenumber="126">
            
              <span class="hits">59536</span>
            

            
              
            

            <code class="ruby">      original_translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"># Also track Rails view helpers</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="17" data-linenumber="132">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">if defined?(ActionView::Helpers::TranslationHelper)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="133">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module ActionView::Helpers::TranslationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="134">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_t, :t</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="135">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_translate, :translate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="137">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="50830" data-linenumber="138">
            
              <span class="hits">50830</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 50830 times">
                  else: 50830
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50830" data-linenumber="139">
            
              <span class="hits">50830</span>
            

            
              
            

            <code class="ruby">      original_t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="142">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="143">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            

            
              
            

            <code class="ruby">      original_translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9dae34e93e4b5b2eefdf7753d77b1bba8c1a3fc8">
  <div class="header">
    <h3>lib/rubocop/cop/custom/ternary_line_breaks.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>35</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>35</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">module RuboCop</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  module Cop</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">    module Custom</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">      # Enforces line breaks after ? and : in ternary operators when</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">      # line exceeds 80 characters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      # @example</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      #   # bad (when line &gt; 80 chars)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      #   result = condition == 2 ? long_true_value : long_false_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      #   # good</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      #   result = condition == 2 ?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      #     long_true_value :</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      #     long_false_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      #</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">      class TernaryLineBreaks &lt; Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">        extend AutoCorrector</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">        MSG = &quot;Break ternary operator across multiple lines &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">              &quot;when line exceeds 80 characters&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">        MAX_LINE_LENGTH = 80</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">        def on_if(node)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">          return unless node.ternary?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">          return unless line_too_long?(node)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">          add_offense(node) do |corrector|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">            autocorrect(corrector, node)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">        private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">        def line_too_long?(node)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">          line = processed_source.lines[node.first_line - 1]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">          line.length &gt; MAX_LINE_LENGTH</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">        def autocorrect(corrector, node)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            

            
              
            

            <code class="ruby">          condition = node.condition</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            

            
              
            

            <code class="ruby">          if_branch = node.if_branch</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">          else_branch = node.else_branch</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">          # Get the indentation of the line containing the ternary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">          indent = processed_source.lines[node.first_line - 1][/\A\s*/]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">          nested_indent = &quot;#{indent}  &quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">          # Build the corrected version</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">          corrected = &quot;#{condition.source} ?\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="52">
            

            
              
            

            <code class="ruby">          corrected &lt;&lt; &quot;#{nested_indent}#{if_branch.source} :\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">          corrected &lt;&lt; &quot;#{nested_indent}#{else_branch.source}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">          corrector.replace(node, corrected)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a2706e0ee5f35697bb27488d115c741f3f2d5712">
  <div class="header">
    <h3>lib/test_data_helpers.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Shared test data helpers for generating realistic British data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"># Used by both factories and seeds for non-critical test data generation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module TestDataHelpers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Generate realistic UK mobile numbers (07xxx format)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.british_phone_number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="6">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    &quot;07#{rand(100..999)} #{rand(100..999)} #{rand(1000..9999)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Generate realistic UK postcodes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.british_postcode</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="11">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    prefixes = [&quot;SW&quot;, &quot;SE&quot;, &quot;NW&quot;, &quot;N&quot;, &quot;E&quot;, &quot;W&quot;, &quot;EC&quot;, &quot;WC&quot;, &quot;B&quot;, &quot;M&quot;, &quot;L&quot;, &quot;G&quot;, &quot;EH&quot;, &quot;CF&quot;, &quot;BS&quot;, &quot;OX&quot;, &quot;CB&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="12">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    &quot;#{prefixes.sample}#{rand(1..20)} #{rand(1..9)}#{(&quot;A&quot;..&quot;Z&quot;).to_a.sample}#{(&quot;A&quot;..&quot;Z&quot;).to_a.sample}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  # Generate realistic UK street addresses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.british_address</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1022" data-linenumber="17">
            
              <span class="hits">1022</span>
            

            
              
            

            <code class="ruby">    streets = [&quot;High Street&quot;, &quot;Church Lane&quot;, &quot;Victoria Road&quot;, &quot;King&#39;s Road&quot;, &quot;Queen Street&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      &quot;Park Avenue&quot;, &quot;Station Road&quot;, &quot;London Road&quot;, &quot;Market Square&quot;, &quot;The Green&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1022" data-linenumber="19">
            
              <span class="hits">1022</span>
            

            
              
            

            <code class="ruby">    numbers = (1..200).to_a</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1022" data-linenumber="20">
            
              <span class="hits">1022</span>
            

            
              
            

            <code class="ruby">    &quot;#{numbers.sample} #{streets.sample}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  # Common British cities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.british_city</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1057" data-linenumber="25">
            
              <span class="hits">1057</span>
            

            
              
            

            <code class="ruby">    [&quot;London&quot;, &quot;Birmingham&quot;, &quot;Manchester&quot;, &quot;Leeds&quot;, &quot;Liverpool&quot;, &quot;Newcastle&quot;, &quot;Bristol&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      &quot;Sheffield&quot;, &quot;Nottingham&quot;, &quot;Leicester&quot;, &quot;Oxford&quot;, &quot;Cambridge&quot;, &quot;Brighton&quot;, &quot;Southampton&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      &quot;Edinburgh&quot;, &quot;Glasgow&quot;, &quot;Cardiff&quot;, &quot;Belfast&quot;].sample</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  # Generate a British company name variation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.british_company_name(base_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="32">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    suffixes = [&quot;Ltd&quot;, &quot;UK&quot;, &quot;Services&quot;, &quot;Solutions&quot;, &quot;Group&quot;, &quot;&amp; Co&quot;, &quot;International&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="33">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    &quot;#{base_name} #{suffixes.sample}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  # Generate inspection location</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="37">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="38">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    venues = [&quot;Park&quot;, &quot;Recreation Centre&quot;, &quot;Community Hall&quot;, &quot;School&quot;, &quot;Leisure Centre&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      &quot;Sports Complex&quot;, &quot;Village Hall&quot;, &quot;Town Square&quot;, &quot;Festival Grounds&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="40">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    &quot;#{british_city} #{venues.sample}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
