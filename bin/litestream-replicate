#!/usr/bin/env nix-shell
#! nix-shell -i bash -p envsubst
set -e

# Load .env file if it exists
if [ -f .env ]; then
  export $(cat .env | grep -v '^#' | xargs)
fi

echo "Replicating database to S3..."

LITESTREAM_CONFIG=$(mktemp)
envsubst < config/litestream.yml > "$LITESTREAM_CONFIG"

bundle exec litestream replicate -config "$LITESTREAM_CONFIG"

rm -f "$LITESTREAM_CONFIG"
