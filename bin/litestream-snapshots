#!/usr/bin/env nix-shell
#! nix-shell -i bash -p envsubst
set -e

# Load .env file if it exists
if [ -f .env ]; then
  export $(cat .env | grep -v '^#' | xargs)
fi

echo "Listing Litestream snapshots from S3..."
echo "(Most recent snapshot will be used for restore)"
echo ""

LITESTREAM_CONFIG=$(mktemp)
envsubst < config/litestream.yml > "$LITESTREAM_CONFIG"

bundle exec litestream snapshots -config "$LITESTREAM_CONFIG" storage/development.sqlite3

echo ""
echo "To delete old snapshots, Litestream uses retention policies in config/litestream.yml"
echo "Current retention: 168h (7 days)"
echo "Old snapshots are automatically cleaned up based on retention settings"

rm -f "$LITESTREAM_CONFIG"
